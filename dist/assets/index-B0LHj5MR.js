import{r as e}from"./rolldown-runtime-D7zIpOPY.js";import{a as t,c as n,i as r,l as i,n as a,o,r as s,s as c,t as l,u}from"./charts-tT8kpEU2.js";import{a as d,c as f,i as p,l as m,n as h,o as g,r as _,s as v,t as y,u as b}from"./react-BoJ992QI.js";import{i as x,n as S,t as C}from"./pdf-tools-Del8CS1J.js";import{C as w,E as T,S as E,T as D,_ as O,a as k,b as A,c as j,d as M,f as N,g as P,h as F,i as I,l as L,m as R,n as ee,o as te,p as ne,r as z,s as B,t as V,u as H,v as re,w as ie,x as ae,y as U}from"./firebase-CqgYKuLb.js";import{Ft as oe,Pt as se}from"./vendor-CD5nJpVy.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var ce=e(b()),W=e(u()),le=`/NASASHE-S.A.S/`,ue=le.endsWith(`/`)?le:`${le}/`,G=ue.replace(/^\/+|\/+$/g,``),de=/^(?:[a-z]+:|\/\/)/i;const K=(e=``)=>{if(!e)return``;if(de.test(e))return e;let t=e.replace(/^\/+/,``);return`${ue}${t}`},fe=(e=``)=>{if(!e)return``;if(de.test(e))return e;let t=e.replace(/^\/+/,``);return G&&t.startsWith(`${G}/`)?t.slice(G.length+1):t};var q=e(i());function pe({texto:e,icono:t,to:n}){return(0,q.jsxs)(p,{to:n,className:`header-button`,children:[(0,q.jsx)(`img`,{src:K(t),alt:e,className:`header-button-icon`}),(0,q.jsx)(`span`,{children:e})]})}var J=pe,me=T({apiKey:`AIzaSyBsAP-bhieVtVkPglMBsf5lben2JuUEcf0`,authDomain:`nasashe-chatarreria.firebaseapp.com`,projectId:`nasashe-chatarreria`,storageBucket:`nasashe-chatarreria.firebasestorage.app`,messagingSenderId:`401122117055`,appId:`1:401122117055:web:0b48451b9b4d5291cacd0a`});const Y=L(me,{localCache:N({tabManager:ne()})}),he=E(me);console.log(`¬°Persistencia local activada con el m√©todo moderno! üöÄ`);const ge=[`configuracion`,`consecutivos`],_e={compras:{campo:`compras`,prefijo:`FAC`,pad:5,separador:``},ventas:{campo:`ventas`,prefijo:`FAV`,pad:5,separador:``},gastos:{campo:`gastos`,prefijo:`GAS`,pad:5,separador:``},ventasMenores:{campo:`ventasMenores`,prefijo:`FAVMI`,pad:5,separador:``},remisiones:{campo:`remisiones`,prefijo:`REM`,pad:6,separador:`-`}};var ve=`nasashe_device_id`,ye=`nasashe_device_alias`,be=e=>{let t=String(e||``).slice(0,8).toUpperCase();return t?`EQUIPO-${t}`:`EQUIPO`},xe=e=>String(e||``).trim(),Se=()=>typeof crypto<`u`&&crypto.randomUUID?crypto.randomUUID():`dev-${Date.now()}-${Math.random().toString(16).slice(2,10)}`;const Ce=()=>{if(typeof window>`u`)return`server-device`;let e=localStorage.getItem(ve);if(e)return e;let t=Se();return localStorage.setItem(ve,t),t},we=(e=Ce())=>{if(typeof window>`u`)return be(e);let t=localStorage.getItem(ye);return t&&t.trim()?t.trim():be(e)},Te=(e,t=Ce())=>{let n=xe(e)||be(t);return typeof window<`u`&&localStorage.setItem(ye,n),n},Ee=(e,t,n)=>`${t}__${e}__${n}`,De=(e,t,n)=>k(Y,`consecutivo_bloques`,Ee(e,t,n));var Oe=()=>k(Y,...ge),ke=e=>{let t=Number(e);return Number.isFinite(t)?t:0};const Ae=(e,t)=>{let n=_e[e];if(!n)throw Error(`Modulo de consecutivo no soportado: ${e}`);let r=String(t).padStart(n.pad,`0`),i=n.separador||``;return`${n.prefijo}${i}${r}`},je=async({deviceId:e,deviceAlias:t,modulo:n,blockSize:r=100,actor:i=`SISTEMA`,ownerUid:a})=>{let o=_e[n];if(!o)throw Error(`Modulo de consecutivo no soportado: ${n}`);if(!a||typeof a!=`string`)throw Error(`No se pudo identificar el propietario del bloque (ownerUid).`);let s=xe(t)||be(e),c=Math.max(1,ke(r)||100),l=Oe(),u=De(e,n,a);return F(Y,async t=>{let r=await t.get(l);if(!r.exists())throw Error(`No se encontro el documento 'configuracion/consecutivos'.`);let d=r.data(),f=ke(d?.[o.campo]),p=f+1,m=f+c;return t.update(l,{[o.campo]:m}),t.set(u,{deviceId:e,deviceAlias:s,ownerUid:a,modulo:n,inicio:p,fin:m,siguiente:p,tamano:c,actualizadoEn:V.now(),reservadoEn:V.now(),asignadoPor:i},{merge:!0}),{inicio:p,fin:m,siguiente:p,tamano:c,bloqueRef:u}})};var Me=(0,W.createContext)(),Ne=z(Y,`movimientos_caja`),Pe=k(Y,`configuracion`,`consecutivos`),Fe=()=>typeof window>`u`?!0:navigator.onLine,Ie=()=>sessionStorage.getItem(`baseEstablecida`)===`true`,Le=e=>{let t=Number(e);return Number.isFinite(t)?t:0},Re=e=>{let t=0;return e.forEach(e=>{let n=e.data();if(n?.anulado===!0)return;let r=Le(n?.monto);if(n?.tipo===`ingreso`){t+=Math.abs(r);return}if(n?.tipo===`egreso`){t-=Math.abs(r);return}n?.tipo===`ajuste`&&(t+=r)}),t};function ze({children:e}){let[t,n]=(0,W.useState)(0),[r,i]=(0,W.useState)(0),[a,o]=(0,W.useState)(0),[s,c]=(0,W.useState)({}),[l,u]=(0,W.useState)({}),[d]=(0,W.useState)(Ce),[f,p]=(0,W.useState)(()=>we(Ce())),[m,h]=(0,W.useState)(Ie),[g,_]=(0,W.useState)(null),[v,y]=(0,W.useState)(!0),[b,x]=(0,W.useState)(null),[S,C]=(0,W.useState)(Fe),[T,E]=(0,W.useState)(!1);(0,W.useEffect)(()=>{let e=()=>{},t=()=>{},r=[],a=()=>{r.forEach(e=>e()),r=[]},s=w(he,async s=>{if(_(s),e(),t(),a(),u({}),s)try{let a=k(Y,`usuarios`,s.uid),l=await te(a);l.exists()?x(l.data()):(console.error(`No se encontro el perfil de usuario en Firestore.`),x(null)),e=H(Ne,e=>{let t=Re(e);i(t),Ie()&&n(t)},e=>{console.error(`Error al escuchar movimientos de caja: `,e)}),t=H(Pe,e=>{if(e.exists()){let t=e.data();o(t.compras??0),c(t)}else alert(`Error de configuracion: no se encontro el documento 'consecutivos'.`)},e=>{console.error(`Error al escuchar consecutivos: `,e)}),r=Object.keys(_e).map(e=>H(De(d,e,s.uid),t=>{let n=t.exists()?t.data():null,r=String(n?.deviceAlias||``).trim(),i=we(d);r&&r!==i&&(p(r),Te(r,d)),u(t=>({...t,[e]:n}))},t=>{console.error(`Error al escuchar bloque de consecutivo (${e}): `,t)}))}catch(e){console.error(`Error al cargar datos iniciales: `,e)}else n(0),i(0),h(!1),x(null),u({}),sessionStorage.removeItem(`baseEstablecida`);y(!1)});return()=>{s(),e(),t(),a()}},[d]),(0,W.useEffect)(()=>{if(typeof window>`u`)return;let e=async()=>{if(navigator.onLine){E(!0);try{await re(Y)}catch(e){console.error(`No se pudo confirmar la sincronizacion offline:`,e)}finally{E(!1)}}},t=()=>{C(!0),e()},n=()=>{C(!1),E(!1)};return window.addEventListener(`online`,t),window.addEventListener(`offline`,n),navigator.onLine&&e(),()=>{window.removeEventListener(`online`,t),window.removeEventListener(`offline`,n)}},[]);let D=()=>b?.nombre||g?.displayName||g?.email||`SISTEMA`,A=e=>{let t=Te(e,d);return p(t),t},j=e=>{let t=l?.[e];if(!t)return null;let n=Number(t.inicio),r=Number(t.fin),i=Number(t.siguiente);return!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(i)?null:{...t,inicio:n,fin:r,siguiente:i}},M=async({modulo:e,targetDeviceId:t=d,targetOwnerUid:n=g?.uid,targetDeviceAlias:r=f,blockSize:i=100})=>{if(!_e[e])throw Error(`Modulo no soportado para consecutivos: ${e}`);if(!S)throw Error(`Sin internet para reservar un nuevo bloque de consecutivos.`);if(!n)throw Error(`No hay un usuario autenticado para reservar bloque.`);let a=await je({deviceId:t,deviceAlias:r,ownerUid:n,modulo:e,blockSize:i,actor:D()});return t===d&&n===g?.uid&&u(i=>({...i,[e]:{...i?.[e]||{},inicio:a.inicio,fin:a.fin,siguiente:a.siguiente,tamano:a.tamano,deviceId:t,deviceAlias:r,ownerUid:n,modulo:e}})),a},N=async e=>{if(!_e[e])throw Error(`Modulo no soportado para consecutivos: ${e}`);let t=g?.uid;if(!t)throw Error(`No hay usuario autenticado para generar consecutivos.`);let n=j(e);if(!n||n.ownerUid!==t||n.siguiente>n.fin){let r=await M({modulo:e,targetOwnerUid:t});n={inicio:r.inicio,fin:r.fin,siguiente:r.siguiente,ownerUid:t}}if(!n||n.siguiente>n.fin)throw Error(`No hay consecutivos disponibles para este modulo.`);let r=n.siguiente;return{numero:r,consecutivo:Ae(e,r),bloqueRef:De(d,e,t)}},P=async({tipo:e,monto:t,descripcion:n=``,referencia:r=null})=>{let i=Number(t);if(!Number.isFinite(i))throw Error(`El monto del movimiento no es valido.`);if((e===`ingreso`||e===`egreso`)&&i<=0)throw Error(`El monto debe ser mayor que cero.`);if(e===`ajuste`&&i===0)throw Error(`El ajuste no puede ser cero.`);let a={tipo:e,monto:e===`ajuste`?i:Math.abs(i),descripcion:n.trim(),fecha:V.now(),usuario:D(),anulado:!1};r?.coleccion&&r?.id&&(a.referencia=r),await ee(Ne,a)},F={base:t,baseGuardada:r,baseEstablecida:m,establecerBase:async(e,t={})=>{let{registrarMovimiento:i=!0}=t,a=Number(e);if(!Number.isFinite(a)||a<0){alert(`Ingresa un monto valido de base.`);return}try{if(i){let e=a-r;e!==0&&await P({tipo:`ajuste`,monto:e,descripcion:`Ajuste manual de base de caja`})}n(a),h(!0),sessionStorage.setItem(`baseEstablecida`,`true`)}catch(e){console.error(`Error al establecer la base:`,e),alert(`No se pudo establecer la base: ${e.message}`)}},restarDeLaBase:async(e,n=`Salida manual de caja`)=>{let r=Number(e);if(!Number.isFinite(r)||r<=0){alert(`El monto a restar debe ser mayor que cero.`);return}if(r>t){alert(`El monto a restar supera la base actual.`);return}try{await P({tipo:`egreso`,monto:r,descripcion:n})}catch(e){console.error(`Error al restar de la base:`,e),alert(`No se pudo restar de la base: ${e.message}`)}},sumarALaBase:async(e,t=`Ingreso manual de caja`)=>{let n=Number(e);if(!Number.isFinite(n)||n<=0){alert(`El monto a agregar debe ser mayor que cero.`);return}try{await P({tipo:`ingreso`,monto:n,descripcion:t})}catch(e){console.error(`Error al sumar a la base:`,e),alert(`No se pudo agregar a la base: ${e.message}`)}},registrarMovimientoCaja:P,anularMovimientoCaja:async(e,t=``)=>{if(!e)throw Error(`Debe indicar el ID del movimiento a anular.`);let n=k(Y,`movimientos_caja`,e);await O(n,{anulado:!0,motivoAnulacion:t.trim()||`Sin motivo`,fechaAnulacion:V.now(),usuarioAnulacion:D()})},currentUser:g,loadingAuth:v,userProfile:b,setBase:n,consecutivos:a,consecutivosData:s,bloquesConsecutivos:l,deviceId:d,deviceAlias:f,obtenerConsecutivoParaModulo:N,reservarBloqueParaModulo:M,actualizarAliasDispositivo:A,isOnline:S,isSyncing:T};return v?null:(0,q.jsx)(Me.Provider,{value:F,children:e})}function X(){let e=(0,W.useContext)(Me);if(!e)throw Error(`useCaja debe ser usado dentro de un CajaProvider`);return e}function Be(){let{userProfile:e}=X(),t=e?.rol===`admin`;return(0,q.jsxs)(`header`,{className:`header-principal`,children:[(0,q.jsxs)(p,{to:`/`,className:`header-logo-link`,children:[(0,q.jsx)(`img`,{src:K(`/logo.png`),alt:`Logo Nasashe`,className:`header-logo-img`}),(0,q.jsxs)(`div`,{className:`header-logo`,children:[`NASASHE`,(0,q.jsx)(`span`,{children:`CHATARRERIA`})]})]}),(0,q.jsxs)(`nav`,{className:`header-nav`,children:[t&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(J,{texto:`Art√≠culos`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,q.jsx)(J,{texto:`Proveedores`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,q.jsx)(J,{texto:`Ventas`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,q.jsx)(J,{texto:`Remisiones`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,q.jsx)(J,{texto:`Usuarios`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,q.jsx)(J,{texto:`Configuraci√≥n`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,q.jsx)(J,{texto:`Reportes`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,q.jsx)(J,{texto:`Compras`,icono:`/icons/Compras.png`,to:`/compras`}),(0,q.jsx)(J,{texto:`Gastos`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,q.jsx)(J,{texto:`Venta Menor`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var Ve=Be;function He(){let{base:e,userProfile:t,sumarALaBase:n}=X(),r=new Date().toLocaleDateString(),i=e<3e5,a=async()=>{if(window.confirm(`¬øEst√°s seguro de que deseas cerrar sesi√≥n?`))try{await D(he)}catch(e){console.error(`Error al cerrar sesi√≥n: `,e),alert(`Error al cerrar sesi√≥n.`)}},o=t?t.nombre:`Cargando...`;return(0,q.jsxs)(`footer`,{className:`footer-principal`,children:[(0,q.jsxs)(`div`,{className:`footer-user`,children:[`Usuario: **`,o,`** |`,(0,q.jsx)(`a`,{href:`#`,onClick:a,style:{color:`black`,marginLeft:`40px`,textDecoration:`underline`,cursor:`pointer`},children:`Salir`})]}),(0,q.jsxs)(`div`,{className:`footer-base`,children:[(0,q.jsxs)(`div`,{className:`base-valor`,children:[`Base en Caja: $`,e.toLocaleString(`es-CO`)]}),i&&(0,q.jsx)(`div`,{className:`base-alerta`,children:`‚ö†Ô∏è Base por debajo de $300.000. Agrega m√°s base.`})]}),(0,q.jsxs)(`div`,{className:`footer-actions`,children:[(0,q.jsx)(`button`,{type:`button`,className:`btn-agregar-base`,onClick:async()=>{let e=window.prompt(`¬øCu√°nto deseas agregar a la base?`,`0`);if(e===null)return;let t=e.replace(/[^0-9.,-]/g,``).replace(`,`,`.`),r=Number(t);if(Number.isNaN(r)||r<=0){alert(`Ingresa un monto v√°lido mayor que cero.`);return}let i=window.prompt(`Descripci√≥n del ingreso manual:`,`Ingreso manual de caja`)||`Ingreso manual de caja`;await n(r,i)},children:`A√±adir base`}),(0,q.jsx)(`div`,{className:`footer-fecha`,children:r})]})]})}var Ue=He;function We({baseAnterior:e,onContinuar:t,onNuevaBase:n}){let[r,i]=(0,W.useState)(!1),[a,o]=(0,W.useState)(``);return(0,q.jsx)(`div`,{className:`modal-overlay`,children:(0,q.jsxs)(`div`,{className:`modal-content`,children:[(0,q.jsx)(`h2`,{children:`Bienvenido`}),(0,q.jsx)(`p`,{children:`¬øDesea continuar con la base en caja anterior?`}),(0,q.jsxs)(`div`,{className:`base-anterior`,children:[`$`,e.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`div`,{className:`modal-actions`,children:[(0,q.jsx)(`button`,{className:`btn-continuar`,onClick:()=>t(e),children:`S√≠, continuar`}),(0,q.jsx)(`button`,{className:`btn-nueva`,onClick:()=>i(!0),children:`No, ingresar nueva base`})]}),r&&(0,q.jsxs)(`form`,{onSubmit:e=>{e.preventDefault();let t=Number(a);t>0?n(t):alert(`Por favor, ingrese un monto v√°lido.`)},className:`nueva-base-form`,children:[(0,q.jsx)(`label`,{htmlFor:`nuevaBase`,children:`Monto de la nueva base:`}),(0,q.jsx)(`input`,{id:`nuevaBase`,type:`number`,placeholder:`0`,value:a,onChange:e=>o(e.target.value),autoFocus:!0}),(0,q.jsx)(`button`,{type:`submit`,className:`btn-continuar`,children:`Guardar Nueva Base`})]})]})})}var Ge=We;function Ke(){let{currentUser:e,baseEstablecida:t,baseGuardada:n,establecerBase:r,isOnline:i,isSyncing:a}=X();return e?e&&!t?(0,q.jsx)(Ge,{baseAnterior:n,onContinuar:e=>r(e,{registrarMovimiento:!1}),onNuevaBase:e=>r(e,{registrarMovimiento:!0})}):(0,q.jsxs)(`div`,{className:`app-container`,children:[(0,q.jsx)(Ve,{}),(0,q.jsx)(`div`,{style:{padding:`8px 12px`,fontSize:`14px`,fontWeight:600,textAlign:`center`,color:`#fff`,backgroundColor:i?`#2f855a`:`#c53030`},children:i?a?`Conectado. Sincronizando cambios pendientes...`:`Conectado.`:`Sin internet. Trabajando en modo offline; se sincronizara al reconectar.`}),(0,q.jsx)(`main`,{className:`main-content`,children:(0,q.jsx)(g,{})}),(0,q.jsx)(Ue,{})]}):(0,q.jsx)(d,{to:`/login`,replace:!0})}var qe=Ke;function Je({titulo:e,descripcion:t,icono:n,to:r}){return(0,q.jsxs)(p,{to:r,className:`module-button`,children:[(0,q.jsx)(`img`,{src:K(n),alt:e,className:`module-icon`}),(0,q.jsxs)(`div`,{className:`module-text`,children:[(0,q.jsx)(`h3`,{children:e}),(0,q.jsx)(`p`,{children:t})]})]})}var Z=Je;function Ye(){let{userProfile:e}=X(),t=e?.rol===`admin`;return(0,q.jsxs)(`div`,{className:`dashboard-container`,children:[(0,q.jsx)(`h1`,{className:`dashboard-title`,children:`Bienvenido(a) a NASASHE. ¬°Haz clic en alg√∫n m√≥dulo para empezar!`}),(0,q.jsxs)(`div`,{className:`dashboard-grid`,children:[t&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(Z,{titulo:`Art√≠culos`,descripcion:`Gestionar inventario, precios y categor√≠as.`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,q.jsx)(Z,{titulo:`Proveedores`,descripcion:`Administrar lista de proveedores y cuentas.`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,q.jsx)(Z,{titulo:`Ventas`,descripcion:`Crear facturas de venta a proveedores.`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,q.jsx)(Z,{titulo:`Remisiones`,descripcion:`Emitir remisiones y generar PDF firmado.`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,q.jsx)(Z,{titulo:`Usuarios`,descripcion:`Gestionar cuentas de empleados.`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,q.jsx)(Z,{titulo:`Configuraci√≥n`,descripcion:`Restablecer consecutivos y ajustes generales.`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,q.jsx)(Z,{titulo:`Reportes`,descripcion:`Ver res√∫menes de ventas, caja e inventario.`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,q.jsx)(Z,{titulo:`Compras`,descripcion:`Registrar compras a recicladores.`,icono:`/icons/Compras.png`,to:`/compras`}),(0,q.jsx)(Z,{titulo:`Gastos`,descripcion:`Registrar salidas de efectivo (ej. comida).`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,q.jsx)(Z,{titulo:`Venta Menor`,descripcion:`Registrar ventas a particulares (ej. tubos).`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var Xe=Ye,Ze=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),Qe=async()=>{for(let e of[`@tauri-apps/plugin-dialog`,`@tauri-apps/api/dialog`]){let t=await x(()=>import(e),[]).catch(()=>null);if(t?.message)return t.message}return null};async function Q(e,t={}){if(Ze()){let n=await Qe();if(n)return n(e,t)}if(t?.title){alert(`${t.title}: ${e}`);return}alert(e)}var $e=`ACERO.jpg,ALUMINIO.jpg,ANTIMONIO.jpg,ARCHIVO.jpg,BATERIA_1_GRUPO.jpg,BATERIA_2_GRUPO.jpg,BATERIA_3_GRUPO.jpg,BATERIA_4_GRUPO.jpg,BATERIA_5_GRUPO.jpg,BATERIA_7_GRUPO.jpg,BATERIA_8_GRUPO.jpg,BATERIA_PEQUE√ëA.jpg,BRONCE.jpg,CANASTA.jpg,CARTON.jpg,COBRE.jpg,COBRE_CABLE.jpg,HIERRO.jpg,OTRO.jpg,PASTA.jpg,PERFIL.jpg,PET.jpg,PLAQUETA_1.jpg,PLAQUETA_2.jpg,PLAQUETA_3.jpg,PLAQUETA_BAJA.jpg,PLAQUETA_CELULAR.jpg,PLAQUETA_DECO.jpg,PLOMO.jpg,POTE.jpg,POTE_DE_ALUMINIO.jpg,RADIADOR_ALUMINIO.jpg,RADIADOR_BRONCE.jpg,RADIADOR_COBRE.jpg,RADIADOR_MIXTO.jpg,SCARP_LIMPIO.jpg,SCARP_SUCIO.jpg,SILLA.jpg,TANQUE.jpg,TANQUE_METALICO.jpg,VOLUMEN_HIERRO.jpg`.split(`,`);function et(){let[e,t]=(0,W.useState)(!0),[n,r]=(0,W.useState)([]),[i,a]=(0,W.useState)(``),[o,s]=(0,W.useState)(``),[c,l]=(0,W.useState)(``),[u,d]=(0,W.useState)(``),[f,p]=(0,W.useState)(``),[m,h]=(0,W.useState)(null),[g,_]=(0,W.useState)({nombre:``,precioCompra:``,precioVenta:``,stock:``,imagenUrl:``}),v=async()=>{t(!0);try{let e=(await B(z(Y,`articulos`))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,W.useEffect)(()=>{v()},[]);let y=async e=>{e.preventDefault();let t=Number(o),n=Number(c),r=Number(u);if(!i||t<=0||n<=0){await Q(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await ee(z(Y,`articulos`),{nombre:i.toUpperCase(),precioCompra:t,precioVenta:n,stock:r||0,imagenUrl:fe(f)||``}),a(``),s(``),l(``),d(``),p(``),await v()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},b=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este art√≠culo?`))try{let t=k(Y,`articulos`,e);await I(t),await v()}catch(e){console.error(`Error al eliminar el documento: `,e)}},x=e=>{let{name:t,value:n}=e.target,r=n;t===`nombre`?r=n.toUpperCase():(t===`precioCompra`||t===`precioVenta`||t===`stock`)&&(r=n.replace(/[^0-9]/g,``)),_(e=>({...e,[t]:r}))},S=e=>{h(e.id),_({nombre:e.nombre,precioCompra:e.precioCompra,precioVenta:e.precioVenta,stock:e.stock,imagenUrl:fe(e.imagenUrl||``)})},C=()=>{h(null)},w=async e=>{e.preventDefault();let t=k(Y,`articulos`,m),n={nombre:g.nombre.toUpperCase(),precioCompra:Number(g.precioCompra),precioVenta:Number(g.precioVenta),stock:Number(g.stock)||0,imagenUrl:fe(g.imagenUrl)||``};if(!n.nombre||n.precioCompra<=0||n.precioVenta<=0){await Q(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await O(t,n),h(null),await v()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,q.jsxs)(`div`,{className:`pagina-articulos`,children:[(0,q.jsx)(`h1`,{children:`M√≥dulo de Art√≠culos`}),(0,q.jsx)(`p`,{children:`Aqu√≠ puedes gestionar tu inventario.`}),(0,q.jsxs)(`div`,{className:`form-container`,children:[(0,q.jsx)(`h2`,{children:`A√±adir Nuevo Art√≠culo`}),(0,q.jsxs)(`form`,{onSubmit:y,children:[(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,q.jsx)(`input`,{id:`nuevoNombre`,type:`text`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoPrecioCompra`,children:`Precio Compra:`}),(0,q.jsx)(`input`,{id:`nuevoPrecioCompra`,type:`text`,value:o,onChange:e=>s(e.target.value.replace(/[^0-9]/g,``))})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoPrecioVenta`,children:`Precio Venta:`}),(0,q.jsx)(`input`,{id:`nuevoPrecioVenta`,type:`text`,value:c,onChange:e=>l(e.target.value.replace(/[^0-9]/g,``))})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoStock`,children:`Stock:`}),(0,q.jsx)(`input`,{id:`nuevoStock`,type:`text`,value:u,onChange:e=>d(e.target.value.replace(/[^0-9]/g,``))})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevaImagenUrl`,children:`Imagen:`}),(0,q.jsxs)(`select`,{id:`nuevaImagenUrl`,value:f,onChange:e=>p(e.target.value),children:[(0,q.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),$e.map(e=>(0,q.jsx)(`option`,{value:`icons/${e}`,children:e},e))]})]}),(0,q.jsx)(`button`,{type:`submit`,children:`Guardar Art√≠culo`})]})]}),(0,q.jsx)(`h2`,{children:`Inventario Actual en Firebase`}),e?(0,q.jsx)(`p`,{children:`Cargando...`}):(0,q.jsxs)(`table`,{className:`articulos-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{className:`articulo-imagen-header`,children:`Imagen`}),(0,q.jsx)(`th`,{children:`Nombre`}),(0,q.jsx)(`th`,{children:`Precio Compra`}),(0,q.jsx)(`th`,{children:`Precio Venta`}),(0,q.jsx)(`th`,{children:`Stock`}),(0,q.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:n.map(e=>(0,q.jsx)(`tr`,{className:m===e.id?`edit-row`:``,children:m===e.id?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`td`,{className:`articulo-imagen-cell`,children:(0,q.jsxs)(`select`,{name:`imagenUrl`,value:g.imagenUrl,onChange:x,children:[(0,q.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),$e.map(e=>(0,q.jsx)(`option`,{value:`icons/${e}`,children:e},e))]})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`nombre`,value:g.nombre,onChange:x})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`precioCompra`,value:g.precioCompra,onChange:x})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`precioVenta`,value:g.precioVenta,onChange:x})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`stock`,value:g.stock,onChange:x})}),(0,q.jsxs)(`td`,{className:`acciones-cell`,children:[(0,q.jsx)(`button`,{onClick:w,className:`btn-guardar`,children:`Guardar`}),(0,q.jsx)(`button`,{type:`button`,onClick:C,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`td`,{className:`articulo-imagen-cell`,children:e.imagenUrl&&(0,q.jsx)(`img`,{src:K(e.imagenUrl),alt:e.nombre})}),(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`td`,{children:[`$`,e.precioVenta.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)}),(0,q.jsxs)(`td`,{className:`acciones-cell`,children:[(0,q.jsx)(`button`,{onClick:()=>S(e),className:`btn-editar`,children:`Editar`}),(0,q.jsx)(`button`,{onClick:()=>b(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var tt=et;function nt(){let[e,t]=(0,W.useState)(!0),[n,r]=(0,W.useState)([]),[i,a]=(0,W.useState)(``),[o,s]=(0,W.useState)(``),[c,l]=(0,W.useState)(``),[u,d]=(0,W.useState)(``),[f,p]=(0,W.useState)(``),[m,h]=(0,W.useState)(``),[g,_]=(0,W.useState)(null),[v,y]=(0,W.useState)({nombre:``,telefono:``,email:``,nit:``,direccion:``,material:``}),b=async()=>{t(!0);try{let e=(await B(z(Y,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,W.useEffect)(()=>{b()},[]);let x=async e=>{if(e.preventDefault(),!i||!u){alert(`Por favor, completa el Nombre y el NIT.`);return}try{await ee(z(Y,`proveedores`),{nombre:i.toUpperCase(),telefono:o,email:c,nit:u,direccion:f,material:m.toUpperCase()}),a(``),s(``),l(``),d(``),p(``),h(``),await b()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},S=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este proveedor?`))try{let t=k(Y,`proveedores`,e);await I(t),await b()}catch(e){console.error(`Error al eliminar el documento: `,e)}},C=e=>{let{name:t,value:n}=e.target,r=n;(t===`nombre`||t===`material`)&&(r=n.toUpperCase()),y(e=>({...e,[t]:r}))},w=e=>{_(e.id),y({nombre:e.nombre,telefono:e.telefono,email:e.email,nit:e.nit,direccion:e.direccion,material:e.material})},T=()=>{_(null)},E=async e=>{e.preventDefault();let t=k(Y,`proveedores`,g);if(!v.nombre||!v.nit){alert(`Por favor, completa el Nombre y el NIT.`);return}let n={nombre:v.nombre.toUpperCase(),telefono:v.telefono,email:v.email,nit:v.nit,direccion:v.direccion,material:v.material.toUpperCase()};try{await O(t,n),_(null),await b()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,q.jsxs)(`div`,{className:`pagina-proveedores`,children:[(0,q.jsx)(`h1`,{children:`M√≥dulo de Proveedores`}),(0,q.jsxs)(`div`,{className:`form-container`,children:[(0,q.jsx)(`h2`,{children:`A√±adir Nuevo Proveedor`}),(0,q.jsxs)(`form`,{onSubmit:x,children:[(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,q.jsx)(`input`,{id:`nuevoNombre`,type:`text`,name:`nombre`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoNit`,children:`NIT:`}),(0,q.jsx)(`input`,{id:`nuevoNit`,type:`text`,name:`nit`,value:u,onChange:e=>d(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoTelefono`,children:`Tel√©fono:`}),(0,q.jsx)(`input`,{id:`nuevoTelefono`,type:`text`,name:`telefono`,value:o,onChange:e=>s(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoEmail`,children:`Email:`}),(0,q.jsx)(`input`,{id:`nuevoEmail`,type:`email`,name:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoDireccion`,children:`Direcci√≥n:`}),(0,q.jsx)(`input`,{id:`nuevoDireccion`,type:`text`,name:`direccion`,value:f,onChange:e=>p(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{htmlFor:`nuevoMaterial`,children:`Material:`}),(0,q.jsx)(`input`,{id:`nuevoMaterial`,type:`text`,name:`material`,value:m,onChange:e=>h(e.target.value.toUpperCase())})]}),(0,q.jsx)(`button`,{type:`submit`,children:`Guardar Proveedor`})]})]}),(0,q.jsx)(`h2`,{children:`Lista de Proveedores`}),e?(0,q.jsx)(`p`,{children:`Cargando...`}):(0,q.jsxs)(`table`,{className:`proveedores-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Nombre`}),(0,q.jsx)(`th`,{children:`NIT`}),(0,q.jsx)(`th`,{children:`Tel√©fono`}),(0,q.jsx)(`th`,{children:`Email`}),(0,q.jsx)(`th`,{children:`Direcci√≥n`}),(0,q.jsx)(`th`,{children:`Material`}),(0,q.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:n.map(e=>(0,q.jsx)(`tr`,{className:g===e.id?`edit-row`:``,children:g===e.id?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`nombre`,value:v.nombre,onChange:C})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`nit`,value:v.nit,onChange:C})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`telefono`,value:v.telefono,onChange:C})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`email`,name:`email`,value:v.email,onChange:C})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`direccion`,value:v.direccion,onChange:C})}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`input`,{type:`text`,name:`material`,value:v.material,onChange:C})}),(0,q.jsxs)(`td`,{className:`acciones-cell`,children:[(0,q.jsx)(`button`,{onClick:E,className:`btn-guardar`,children:`Guardar`}),(0,q.jsx)(`button`,{type:`button`,onClick:T,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{children:e.nit}),(0,q.jsx)(`td`,{children:e.telefono}),(0,q.jsx)(`td`,{children:e.email}),(0,q.jsx)(`td`,{children:e.direccion}),(0,q.jsx)(`td`,{children:e.material}),(0,q.jsxs)(`td`,{className:`acciones-cell`,children:[(0,q.jsx)(`button`,{onClick:()=>w(e),className:`btn-editar`,children:`Editar`}),(0,q.jsx)(`button`,{onClick:()=>S(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var rt=nt;const it=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e.reciclador||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE COMPRA`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Compra
`,a+=`Fecha: ${n}\n`,a+=`Facturado por: ${t?.nombre||`SISTEMA`}\n`,a+=`Reciclador: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioCompra.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,a+=i(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,a+=i(`¬° Gracias por su venta !`,45)+`
`,a},at=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.proveedor?.nombre||``).toString().trim()||`N/A`,i=(e?.proveedor?.nit||``).toString().trim()||`N/A`,a=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},o=a(`TICKET DE VENTA`,45)+`
`;return o+=a(`RECICLADORA NASASHE S.A.S`,45)+`
`,o+=a(`901907763-3`,45)+`
`,o+=a(`Calle 98#9B-35`,45)+`
`,o+=a(`Barranquilla - Atlantico`,45)+`
`,o+=a(`605-000-0000`,45)+`
`,o+=`-`.repeat(45)+`
`,o+=`Factura: ${e.consecutivo}\n`,o+=`Actividad: Venta
`,o+=`Fecha: ${n}\n`,o+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,o+=`Cliente: ${r}\n`,o+=`NIT: ${i}\n`,o+=`-`.repeat(45)+`
`,o+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,o+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioVenta.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);o+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),o+=`-`.repeat(45)+`
`,o+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,o+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`-`.repeat(45)+`
`,o+=a(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,o+=a(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,o+=a(`¬° Gracias por su compra !`,45)+`
`,o},ot=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.cliente||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE VENTA MENOR`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Venta Menor
`,a+=`Fecha: ${n}\n`,a+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,a+=`Cliente: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Descripci√≥n`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.descripcion.length>18?e.descripcion.substring(0,18):e.descripcion,n=e.cantidad.toString(),r=e.precio.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`¬° Gracias por su compra !`,45)+`
`,a},st=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`COMPROBANTE DE SALIDA`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=r(`901907763-3`,45)+`
`,i+=r(`Calle 98#9B-35`,45)+`
`,i+=r(`Barranquilla - Atlantico`,45)+`
`,i+=r(`605-000-0000`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Comprobante: ${e.consecutivo}\n`,i+=`Actividad: Gasto / Egreso
`,i+=`Fecha: ${n}\n`,i+=`Registrado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`

`,i+=`Concepto: ${e.concepto}\n`,i+=`Descripci√≥n: ${e.descripcion}\n\n`,i+=`-`.repeat(45)+`
`,i+=`Total:`.padEnd(10)+`${e.monto.toLocaleString(`es-CO`)}`.padStart(35)+`
`,i+=`-`.repeat(45)+`

`,i+=`__________________________________
`,i+=r(`Firma Autorizado`,34)+`

`,i+=`__________________________________
`,i+=r(`Firma Recibido`,34)+`
`,i},ct=({titulo:e,textoTicket:t})=>{if(typeof window>`u`||typeof document>`u`)return!1;try{let n=document.createElement(`iframe`);n.style.position=`fixed`,n.style.right=`0`,n.style.bottom=`0`,n.style.width=`0`,n.style.height=`0`,n.style.border=`0`,n.style.visibility=`hidden`,n.setAttribute(`aria-hidden`,`true`),n.tabIndex=-1,document.body.appendChild(n);let r=n.contentWindow,i=r?.document;if(!r||!i)return document.body.removeChild(n),!1;let a=!1,o=()=>{n.parentNode&&n.parentNode.removeChild(n)},s=()=>{r.removeEventListener(`afterprint`,s),o()};return n.onload=()=>{r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error al intentar imprimir el ticket en el iframe:`,e),r.removeEventListener(`afterprint`,s),o()}},i.open(),i.write(`<!DOCTYPE html><html><head><title>${e}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${t}</pre></body></html>`),i.close(),setTimeout(()=>{if(!(a||!n.isConnected)){r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error en impresi√≥n de respaldo del ticket:`,e),o()}setTimeout(()=>{!a&&n.isConnected&&o()},1500)}},500),!0}catch(e){return console.error(`No se pudo preparar la impresi√≥n del ticket en el navegador:`,e),!1}};var lt=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,ut=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function dt(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,W.useState)(!0),[a,o]=(0,W.useState)(!1),[s,c]=(0,W.useState)([]),[l,u]=(0,W.useState)(``),[d,f]=(0,W.useState)(``),[p,m]=(0,W.useState)(``),[h,g]=(0,W.useState)(``),[_,v]=(0,W.useState)(``),[y,b]=(0,W.useState)(``),[x,S]=(0,W.useState)([]),[C,w]=(0,W.useState)(0),[T,E]=(0,W.useState)(null),[D,O]=(0,W.useState)(null);(0,W.useEffect)(()=>{i(!0);let e=z(Y,`articulos`),t=H(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));c(t),i(!1),console.log(`¬°Art√≠culos cargados y cacheados con onSnapshot!`)},e=>{console.error(`Error al cargar art√≠culos con onSnapshot: `,e),i(!1)});return()=>{console.log(`Limpiando listener de Art√≠culos.`),t()}},[]),(0,W.useEffect)(()=>{let e=0;x.forEach(t=>{e+=t.subtotal}),w(e)},[x]);let M=e=>{let t=e.target.value;if(f(t),t!==`otros`&&(m(``),g(``)),t===`otros`){b(`/icons/OTRO.jpg`);return}if(t){let e=s.find(e=>e.id===t);e&&e.imagenUrl?b(e.imagenUrl):b(``)}else b(``)},N=()=>{if(!d||!_||Number(_)<=0){alert(`Seleccione un art√≠culo y una cantidad (peso) v√°lida.`);return}if(d===`otros`){let e=p.trim().toUpperCase(),t=Number(h),n=Number(_);if(!e||!t||t<=0){alert(`Ingrese un nombre y un precio de compra v√°lido para el material.`);return}let r=n*t;S(i=>[...i,{localId:Date.now(),articuloId:null,nombre:e,cantidad:n,precioCompra:t,subtotal:r,esManual:!0}]),f(``),m(``),g(``),v(``),b(``);return}let e=s.find(e=>e.id===d);if(!e){alert(`Error: Art√≠culo no encontrado.`);return}let t=Number(_),n=t*e.precioCompra;x.find(t=>t.articuloId===e.id)?S(r=>r.map(r=>r.articuloId===e.id?{...r,cantidad:r.cantidad+t,subtotal:r.subtotal+n}:r)):S(r=>[...r,{localId:Date.now(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioCompra:e.precioCompra,subtotal:n}]),f(``),v(``),b(``)},P=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&S(x.filter(t=>t.localId!==e))},F=e=>{O(t=>t===e?null:e)},I=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=n*e.precioCompra;return{...e,cantidad:n,subtotal:t}}return e}))},L=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=e.cantidad*n;return{...e,precioCompra:n,subtotal:t}}return e}))},R=async()=>{if(x.length===0){alert(`No hay art√≠culos en la compra.`);return}o(!0);let r=null;try{let i=t,{consecutivo:a,bloqueRef:o}=await n(`compras`);if(C>i)throw Error(`¬°Error! Fondos insuficientes. Base: $${i.toLocaleString(`es-CO`)}`);let c=l.trim().toUpperCase(),d={consecutivo:a,reciclador:c||`N/A`,items:x,total:C,fecha:V.now(),usuario:e?.nombre||`SISTEMA`};r=d;let f=A(Y),p=k(z(Y,`compras`)),m=k(z(Y,`movimientos_caja`));f.set(p,d),f.update(o,{siguiente:j(1),actualizadoEn:V.now()}),f.set(m,{tipo:`egreso`,monto:C,descripcion:`Compra ${a} - ${c||`N/A`}`,fecha:V.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`compras`,id:p.id,consecutivo:a}}),x.forEach(e=>{if(e.esManual)return;if(!s.find(t=>t.id===e.articuloId))throw Error(`Art√≠culo ${e.nombre} no encontrado en cach√©.`);let t=k(Y,`articulos`,e.articuloId);f.update(t,{stock:j(e.cantidad)})}),await f.commit(),E(r),u(``),S([])}catch(e){console.error(`Error al guardar la compra: `,e),alert(`Error al guardar: ${e.message}`)}o(!1)},ee=t=>{let n=it(t,e);ct({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return r?(0,q.jsx)(`p`,{children:`Cargando Art√≠culos...`}):(0,q.jsxs)(`div`,{className:`pagina-compras`,children:[(0,q.jsx)(`h1`,{children:`Registrar Nueva Compra (a Reciclador)`}),(0,q.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,q.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`layout-compras`,children:[(0,q.jsxs)(`div`,{className:`formulario-compra`,children:[(0,q.jsx)(`h2`,{children:`Datos de la Compra`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`reciclador`,children:`Nombre Reciclador (Opcional):`}),(0,q.jsx)(`input`,{id:`reciclador`,type:`text`,value:l,onChange:e=>u(e.target.value.toUpperCase()),disabled:T})]}),(0,q.jsx)(`hr`,{}),(0,q.jsx)(`h3`,{children:`A√±adir Art√≠culos`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`articulo`,children:`Art√≠culo:`}),(0,q.jsxs)(`select`,{id:`articulo`,value:d,onChange:M,disabled:T,children:[(0,q.jsx)(`option`,{value:``,children:`-- Seleccione un Art√≠culo --`}),(0,q.jsx)(`option`,{value:`otros`,children:`Otros (ingreso manual)`}),s.map(e=>(0,q.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioCompra,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),d===`otros`&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`nombreManual`,children:`Nombre del material:`}),(0,q.jsx)(`input`,{id:`nombreManual`,type:`text`,value:p,onChange:e=>m(e.target.value.toUpperCase()),disabled:T})]}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`precioManual`,children:`Precio compra:`}),(0,q.jsx)(`input`,{id:`precioManual`,type:`number`,value:h,onChange:e=>g(e.target.value),disabled:T})]})]}),(0,q.jsx)(`div`,{className:`imagen-preview-container`,children:y?(0,q.jsx)(`img`,{src:K(y),alt:`Vista previa del material`}):(0,q.jsx)(`span`,{style:{color:`#888`},children:`Imagen del material`})}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,q.jsx)(`input`,{id:`cantidad`,type:`number`,value:_,onChange:e=>v(e.target.value),disabled:T})]}),(0,q.jsx)(`button`,{type:`button`,onClick:N,className:`btn-anadir-item`,disabled:T,children:`A√±adir Item a la Compra`})]}),(0,q.jsxs)(`div`,{className:`pre-factura`,children:[(0,q.jsx)(`h2`,{children:`Items de la Compra`}),(0,q.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Art√≠culo`}),(0,q.jsx)(`th`,{children:`Cant.`}),(0,q.jsx)(`th`,{children:`Precio`}),(0,q.jsx)(`th`,{children:`Subtotal`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:(T?T.items:x).length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`A√±ade art√≠culos...`})}):(T?T.items:x).map((e,t)=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{children:D===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>I(t,e.localId),autoFocus:!0,style:{width:`70px`,padding:`3px`}}):(Number(e.cantidad)||0).toFixed(2)}),(0,q.jsx)(`td`,{children:D===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.precioCompra,onChange:t=>L(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioCompra}`}),(0,q.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,q.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>F(e.localId),disabled:T,children:D===e.localId?`Listo`:`Editar`}),(0,q.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>P(e.localId),disabled:T,children:`Anular`})]})]},t))})]}),(0,q.jsxs)(`div`,{className:`total-compra`,children:[`Total: $`,(T?T.total:C).toLocaleString(`es-CO`)]}),(0,q.jsx)(`div`,{className:`botones-accion`,children:T?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`p`,{className:`compra-exitosa`,children:[`¬°Compra `,T.consecutivo,` guardada!`]}),(0,q.jsx)(`button`,{type:`button`,onClick:async()=>{if(T)if(!lt())ee(T);else{localStorage.setItem(`ticketData`,JSON.stringify(T)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`compra`);let t=`ticket-compra-${T.consecutivo.replace(/\s/g,`-`)}`;new se(t,{url:`/imprimir`,title:`Ticket ${T.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),ee(T)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{if(!T)return;let t=it(T,e);ut(t,T.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{S([]),w(0),u(``),E(null),f(``),m(``),g(``),v(``),b(``)},className:`btn-nueva-compra`,children:`Registrar Nueva Compra`})]}):(0,q.jsx)(`button`,{type:`button`,onClick:R,className:`btn-guardar-compra`,disabled:a||x.length===0,children:a?`Guardando...`:`Guardar Compra`})})]})]})]})}var ft=dt,pt=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,mt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function ht(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,W.useState)(!0),[a,o]=(0,W.useState)(!1),[s,c]=(0,W.useState)([]),[l,u]=(0,W.useState)([]),[d,f]=(0,W.useState)(``),[p,m]=(0,W.useState)(``),[h,g]=(0,W.useState)(``),[_,v]=(0,W.useState)([]),[y,b]=(0,W.useState)(0),[x,S]=(0,W.useState)(null),[C,w]=(0,W.useState)(null),T=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,E=async()=>{i(!0);try{let e=(await B(z(Y,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));c(e);let t=(await B(z(Y,`articulos`))).docs.map(e=>({id:e.id,...e.data()}));u(t)}catch(e){console.error(`Error al cargar datos: `,e)}i(!1)};(0,W.useEffect)(()=>{E()},[]),(0,W.useEffect)(()=>{let e=0;_.forEach(t=>{e+=t.subtotal}),b(e)},[_]);let D=()=>{if(!p||!h||Number(h)<=0){alert(`Seleccione un art√É¬≠culo y una cantidad (peso) v√É¬°lida.`);return}let e=l.find(e=>e.id===p);if(!e){alert(`Error: Art√É¬≠culo no encontrado.`);return}let t=Number(h),n=e.stock||0,r=_.find(t=>t.articuloId===e.id),i=r?r.cantidad:0;if(t+i>n){alert(`√Ç¬°No hay stock suficiente! Stock actual: ${n}, Quieres vender: ${t+i}`);return}let a=t*e.precioVenta;v(r?n=>n.map(n=>n.articuloId===e.id?{...n,cantidad:n.cantidad+t,subtotal:n.subtotal+a}:n):n=>[...n,{localId:T(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioVenta:e.precioVenta,subtotal:a}]),m(``),g(``)},O=e=>{window.confirm(`√Ç¬øDesea eliminar este item de la prefactura?`)&&(v(t=>t.filter(t=>t.localId!==e)),w(t=>t===e?null:t))},M=e=>{w(t=>t===e?null:e)},N=(e,t)=>{let n=Number(e.target.value);n<=0||v(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precioVenta}:e))},P=(e,t)=>{let n=Number(e.target.value);n<=0||v(e=>e.map(e=>e.localId===t?{...e,precioVenta:n,subtotal:n*e.cantidad}:e))},F=async()=>{if(_.length===0){alert(`No hay art√É¬≠culos en la venta.`);return}if(!d){alert(`Debe seleccionar un Proveedor (Cliente de Venta).`);return}o(!0);let t=null;try{let r=k(z(Y,`ventas`)),i=s.find(e=>e.id===d),{consecutivo:a,bloqueRef:o}=await n(`ventas`),c={consecutivo:a,proveedor:{id:i.id,nombre:i.nombre,nit:i.nit},items:_,total:y,fecha:V.now(),usuario:e?.nombre||`SISTEMA`};t=c,_.forEach(e=>{let t=l.find(t=>t.id===e.articuloId);if(!t)throw Error(`Articulo ${e.nombre} no encontrado en cache.`);let n=Number(t.stock)||0;if(e.cantidad>n)throw Error(`Stock insuficiente para ${e.nombre}`)});let u=A(Y);u.set(r,c),u.update(o,{siguiente:j(1),actualizadoEn:V.now()}),_.forEach(e=>{let t=k(Y,`articulos`,e.articuloId);u.update(t,{stock:j(-e.cantidad)})}),await u.commit(),await E(),S(t),f(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}o(!1)},I=t=>{let n=at(t,e);ct({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√É¬≥n del ticket en el navegador. Verifica la configuraci√É¬≥n de impresi√É¬≥n e int√É¬©ntalo nuevamente.`)};return r?(0,q.jsx)(`p`,{children:`Cargando datos maestros...`}):(0,q.jsxs)(`div`,{className:`pagina-ventas`,children:[(0,q.jsx)(`h1`,{children:`Registrar Nueva Venta (a Proveedor)`}),(0,q.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,q.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`layout-ventas`,children:[(0,q.jsxs)(`div`,{className:`formulario-venta`,children:[(0,q.jsx)(`h2`,{children:`Datos de la Venta`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`proveedor`,children:`Cliente (Proveedor al que Vendes):`}),(0,q.jsxs)(`select`,{id:`proveedor`,value:d,onChange:e=>f(e.target.value),disabled:x,children:[(0,q.jsx)(`option`,{value:``,children:`-- Seleccione un Cliente --`}),s.map(e=>(0,q.jsxs)(`option`,{value:e.id,children:[e.nombre,` (`,e.nit,`)`]},e.id))]})]}),(0,q.jsx)(`hr`,{}),(0,q.jsx)(`h3`,{children:`A√É¬±adir Art√É¬≠culos`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`articulo`,children:`Art√É¬≠culo:`}),(0,q.jsxs)(`select`,{id:`articulo`,value:p,onChange:e=>m(e.target.value),disabled:x,children:[(0,q.jsx)(`option`,{value:``,children:`-- Seleccione un Art√É¬≠culo --`}),l.map(e=>(0,q.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioVenta,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,q.jsx)(`input`,{id:`cantidad`,type:`number`,value:h,onChange:e=>g(e.target.value),disabled:x})]}),(0,q.jsx)(`button`,{type:`button`,onClick:D,className:`btn-anadir-item-venta`,disabled:x,children:`A√É¬±adir Item a la Venta`})]}),(0,q.jsxs)(`div`,{className:`pre-factura`,children:[(0,q.jsx)(`h2`,{children:`Items de la Venta`}),(0,q.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Art√É¬≠culo`}),(0,q.jsx)(`th`,{children:`Cant.`}),(0,q.jsx)(`th`,{children:`Precio Venta`}),(0,q.jsx)(`th`,{children:`Subtotal`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:(x?x.items:_).length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√É¬±ade art√É¬≠culos...`})}):(x?x.items:_).map((e,t)=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{children:C===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>N(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,q.jsx)(`td`,{children:C===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.precioVenta,onChange:t=>P(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioVenta}`}),(0,q.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,q.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>M(e.localId),disabled:x,children:C===e.localId?`Listo`:`Editar`}),(0,q.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>O(e.localId),disabled:x,children:`Anular`})]})]},e.localId||t))})]}),(0,q.jsxs)(`div`,{className:`total-venta`,children:[`Total: $`,(x?x.total:y).toLocaleString(`es-CO`)]}),(0,q.jsx)(`div`,{className:`botones-accion`,children:x?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`p`,{className:`venta-exitosa`,children:[`√Ç¬°Venta `,x.consecutivo,` guardada!`]}),(0,q.jsx)(`button`,{type:`button`,onClick:async()=>{if(x)if(!pt())I(x);else{localStorage.setItem(`ticketData`,JSON.stringify(x)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`venta`);let t=`ticket-venta-${x.consecutivo.replace(/\s/g,`-`)}`;new se(t,{url:`/imprimir`,title:`Ticket ${x.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√É¬≥n:`,e),I(x)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{if(!x||pt())return;let t=at(x,e);mt(t,x.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{v([]),b(0),f(``),S(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,q.jsx)(`button`,{type:`button`,onClick:F,className:`btn-guardar-venta`,disabled:a||_.length===0,children:a?`Guardando...`:`Guardar Venta`})})]})]})]})}var gt=ht,_t=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,vt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function yt(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,W.useState)(!1),[a,o]=(0,W.useState)(``),[s,c]=(0,W.useState)(``),[l,u]=(0,W.useState)(null),d=async()=>{let r=Number(s),l=a.trim();if(!l||r<=0){alert(`Debe ingresar una descripci√≥n y un monto v√°lido.`);return}if(r>t){alert(`Error: el monto del gasto no puede superar la base en caja.`);return}i(!0);try{let t=k(z(Y,`gastos`)),i=null,{consecutivo:a,bloqueRef:s}=await n(`gastos`),d={consecutivo:a,descripcion:l,monto:r,fecha:V.now(),usuario:e?.nombre||`SISTEMA`};i=d;let f=A(Y),p=k(z(Y,`movimientos_caja`));f.set(t,d),f.update(s,{siguiente:j(1),actualizadoEn:V.now()}),f.set(p,{tipo:`egreso`,monto:r,descripcion:`Gasto ${a} - ${l}`,fecha:V.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`gastos`,id:t.id,consecutivo:a}}),await f.commit(),u(i),o(``),c(``)}catch(e){console.error(`Error al guardar el gasto: `,e),alert(`Error al guardar: ${e.message}`)}i(!1)},f=t=>{let n=st(t,e);ct({titulo:`Comprobante ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del comprobante en el navegador.`)},p=async()=>{if(l)if(!_t())f(l),h();else{localStorage.setItem(`ticketData`,JSON.stringify(l)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`gasto`);let t=`ticket-gasto-${l.consecutivo.replace(/\s/g,`-`)}`,n=new se(t,{url:`/imprimir`,title:`Comprobante ${l.consecutivo}`,width:310,height:600});n.once(`tauri://created`,()=>{m()}),n.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),f(l),h()})}},m=()=>{l&&h()},h=()=>{if(l&&!_t()){let t=st(l,e);vt(t,l.consecutivo)}o(``),c(``),u(null)};return(0,q.jsxs)(`div`,{className:`pagina-gastos`,children:[(0,q.jsx)(`h1`,{children:`Registro de Gasto (Salida de Caja)`}),(0,q.jsxs)(`div`,{children:[`Base actual: `,(0,q.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`layout-gastos`,children:[(0,q.jsxs)(`div`,{className:`formulario-gasto`,children:[(0,q.jsx)(`h2`,{children:`Datos del Gasto`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`descripcion`,children:`Descripci√≥n:`}),(0,q.jsx)(`textarea`,{id:`descripcion`,rows:`4`,value:a,onChange:e=>o(e.target.value),disabled:!!l})]}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`monto`,children:`Monto ($):`}),(0,q.jsx)(`input`,{id:`monto`,type:`number`,value:s,onChange:e=>c(e.target.value),disabled:!!l})]})]}),(0,q.jsxs)(`div`,{className:`vista-previa-gasto`,children:[(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`h2`,{children:`Resumen de Salida`}),(0,q.jsxs)(`div`,{className:`resumen-gasto`,children:[(0,q.jsxs)(`div`,{children:[`Descripci√≥n: `,l?l.descripcion:a]}),(0,q.jsxs)(`div`,{className:`monto`,children:[`- $`,(l?l.monto:Number(s||0)).toLocaleString(`es-CO`)]})]})]}),(0,q.jsx)(`div`,{className:`botones-accion`,children:l?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`p`,{className:`gasto-exitoso`,children:[`Gasto `,l.consecutivo,` guardado.`]}),(0,q.jsx)(`button`,{type:`button`,onClick:p,className:`btn-imprimir-ticket`,children:`Imprimir Comprobante (SALIDA)`}),(0,q.jsx)(`button`,{type:`button`,onClick:m,className:`btn-nuevo-gasto`,children:`Registrar Nuevo Gasto (y Descargar TXT)`})]}):(0,q.jsx)(`button`,{type:`button`,onClick:d,className:`btn-guardar-gasto`,disabled:r||!a||!s,children:r?`Guardando...`:`Guardar Gasto`})})]})]})]})}var bt=yt;r.register(s,t,a,c,n,o);function xt({chartData:e,titulo:t,useLogScale:n=!1}){return(0,q.jsx)(l,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:`top`},title:{display:!0,text:t,font:{size:18}}},scales:{x:{ticks:{autoSkip:!1,maxRotation:45}},y:{type:n?`logarithmic`:`linear`,beginAtZero:!n,min:n?.1:void 0,title:{display:!0,text:n?`Escala logar√≠tmica (kg/und)`:`Cantidad (kg/und)`},ticks:n?{callback:e=>Number(e).toLocaleString(`es-CO`)}:{precision:0}}}},data:e})}var St=xt,Ct=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),wt=()=>new Date().toISOString().split(`T`)[0],$=e=>{let t=e.split(`-`);return new Date(t[0],t[1]-1,t[2])},Tt=(e,t)=>{let n=new Date().toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`REPORTE DE INVENTARIO`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Fecha: ${n}\n`,i+=`Generado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`
`,i+=`Material`.padEnd(30)+`Stock (kg/und)`.padStart(15)+`
`,i+=`-`.repeat(45)+`
`,e.forEach(e=>{let t=e.nombre.length>29?e.nombre.substring(0,29):e.nombre,n=(Number(e.stock)||0).toFixed(2);i+=t.padEnd(30)+n.padStart(15)+`
`}),i+=`-`.repeat(45)+`
`,i+=`Total de Art√≠culos: ${e.length}\n`,i+=`-`.repeat(45)+`
`,i};function Et(){let{base:e,userProfile:t}=X(),[n,r]=(0,W.useState)(`cierre`),[i,a]=(0,W.useState)(!1),[o,s]=(0,W.useState)(wt),[c,l]=(0,W.useState)(0),[u,d]=(0,W.useState)(0),[f,p]=(0,W.useState)(0),[m,h]=(0,W.useState)(wt),[g,_]=(0,W.useState)(wt),[v,y]=(0,W.useState)([]),[b,x]=(0,W.useState)([]),[w,T]=(0,W.useState)([]),[E,D]=(0,W.useState)([]),[O,k]=(0,W.useState)([]),[A,j]=(0,W.useState)(wt),[N,P]=(0,W.useState)(wt),[F,I]=(0,W.useState)(``),[L,ee]=(0,W.useState)(wt),[te,ne]=(0,W.useState)(wt),[H,re]=(0,W.useState)(`todos`),[ie,ae]=(0,W.useState)(``),[oe,ce]=(0,W.useState)([]),[le,ue]=(0,W.useState)({ingresos:0,egresos:0,ajustes:0,saldo:0}),[G,de]=(0,W.useState)([]),[K,fe]=(0,W.useState)(!1);(0,W.useRef)(null);let[pe,J]=(0,W.useState)(null),[me,he]=(0,W.useState)(!1),ge=async()=>{a(!0);let e=$(o),t=new Date(e.setHours(0,0,0,0)),n=new Date(e.setHours(23,59,59,999)),r=V.fromDate(t),i=V.fromDate(n),s=0,c=0,u=0;try{let e=R(z(Y,`compras`),U(`fecha`,`>=`,r),U(`fecha`,`<=`,i));(await B(e)).forEach(e=>s+=e.data().total);let t=R(z(Y,`gastos`),U(`fecha`,`>=`,r),U(`fecha`,`<=`,i));(await B(t)).forEach(e=>c+=e.data().monto);let n=R(z(Y,`ventasMenores`),U(`fecha`,`>=`,r),U(`fecha`,`<=`,i));(await B(n)).forEach(e=>u+=e.data().total)}catch(e){console.error(`Error al generar el reporte: `,e),await Q(`Error al generar el reporte.`,{title:`Nasashe sas`,type:`error`})}l(s),d(c),p(u),a(!1)},_e=c+u,ve=e+_e-f,ye=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i=[];try{let e=R(z(Y,`compras`),U(`fecha`,`>=`,n),U(`fecha`,`<=`,r),M(`fecha`,`desc`));(await B(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),y(i)}catch(e){console.error(`Error al buscar historial: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`warning`})}a(!1)},be=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i=[];try{let e=R(z(Y,`ventas`),U(`fecha`,`>=`,n),U(`fecha`,`<=`,r),M(`fecha`,`desc`));(await B(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),x(i)}catch(e){console.error(`Error al buscar historial de ventas: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},xe=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i=[];try{let e=R(z(Y,`ventasMenores`),U(`fecha`,`>=`,n),U(`fecha`,`<=`,r),M(`fecha`,`desc`));(await B(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),T(i)}catch(e){console.error(`Error al buscar historial de ventas menores: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},Se=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i=[];try{let e=R(z(Y,`gastos`),U(`fecha`,`>=`,n),U(`fecha`,`<=`,r),M(`fecha`,`desc`));(await B(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),D(i)}catch(e){console.error(`Error al buscar historial de gastos: `,e),alert(`Error al buscar historial.`)}a(!1)},Ce=async()=>{a(!0);let e=F.trim().toUpperCase(),t=new Date($(A).setHours(0,0,0,0)),n=new Date($(N).setHours(23,59,59,999)),r=V.fromDate(t),i=V.fromDate(n);try{let t;if(e){let n=R(z(Y,`remisiones`),U(`consecutivo`,`==`,e));t=await B(n)}else{let e=R(z(Y,`remisiones`),U(`fecha`,`>=`,r),U(`fecha`,`<=`,i),M(`fecha`,`desc`));t=await B(e)}let n=t.docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}});k(n)}catch(e){console.error(`Error al buscar historial de remisiones: `,e),alert(`Error al buscar remisiones.`)}a(!1)},we=async()=>{a(!0);try{let e=new Date($(L).setHours(0,0,0,0)),t=new Date($(te).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i=[U(`fecha`,`>=`,n),U(`fecha`,`<=`,r),M(`fecha`,`desc`)];H!==`todos`&&i.unshift(U(`tipo`,`==`,H));let a=R(z(Y,`movimientos_caja`),...i),o=(await B(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}}),s=ie.trim().toUpperCase();s&&(o=o.filter(e=>String(e.usuario||``).toUpperCase().includes(s)));let c=0,l=0,u=0;o.forEach(e=>{if(e.anulado)return;let t=Number(e.monto)||0;e.tipo===`ingreso`&&(c+=Math.abs(t)),e.tipo===`egreso`&&(l+=Math.abs(t)),e.tipo===`ajuste`&&(u+=t)}),ce(o),ue({ingresos:c,egresos:l,ajustes:u,saldo:c-l+u})}catch(e){console.error(`Error al buscar libro de caja: `,e),await Q(`No se pudo cargar el libro de caja.`,{title:`Nasashe sas`,type:`error`})}a(!1)},Te=(e,t)=>{let n=document.createElement(`iframe`);n.style.position=`absolute`,n.style.width=`0`,n.style.height=`0`,n.style.border=`none`,document.body.appendChild(n);let r=n.contentWindow.document;r.open(),r.write(`<!DOCTYPE html><html><head><title>${t}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${e}</pre></body></html>`),r.close();let i=()=>{n.contentWindow.focus(),n.contentWindow.print(),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3)};window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,0)},Ee=e=>{let n=it(e,t);Te(n,`Ticket ${e.consecutivo}`)},De=e=>{let n=at(e,t);Te(n,`Ticket ${e.consecutivo}`)},Oe=e=>{let n=ot(e,t);Te(n,`Ticket ${e.consecutivo}`)},ke=e=>{let n=st(e,t);Te(n,`Comprobante ${e.consecutivo}`)},Ae=e=>e?e instanceof Date?e.toLocaleString(`es-CO`):new Date(e).toLocaleString(`es-CO`):``,je=async e=>{let t=new S({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√ìN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino?.nombre||`N/D`}`,12,r),t.text(`Direcci√≥n: ${e.destino?.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino?.nit||`N/D`}`,12,r),t.text(`Tel√©fono: ${e.destino?.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√≥n: ${Ae(e.fecha)}`,12,r),r+=6,t.text(`Conductor: ${e.conductor?.nombre||`N/D`}`,12,r),t.text(`C√©dula: ${e.conductor?.cedula||`N/D`}`,n/2,r),r+=6,t.text(`Direcci√≥n: ${e.conductor?.direccion||`N/D`}`,12,r),r+=6,t.text(`V√≠nculo: ${e.conductor?.vinculo||`N/D`}`,12,r),t.text(`Placa: ${e.conductor?.placa||`N/D`}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor?.celular||`N/D`}`,12,r),r+=6,e.observaciones&&(t.text(`Observaciones: ${e.observaciones}`,12,r),r+=6),C(t,{startY:r+4,head:[[`√çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:(e.items||[]).map((e,t)=>[(t+1).toString(),e.nombre,(e.cantidad??0).toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t},Me=async e=>{try{let t=(await je(e)).output(`bloburl`);window.open(t,`_blank`)}catch(e){console.error(`Error al reimprimir la remisi√≥n:`,e),alert(`No se pudo generar el PDF de la remisi√≥n.`)}},Ne=async(e,n)=>{if(!n)return;let r=()=>{switch(e){case`compra`:return Ee(n);case`venta`:return De(n);case`ventaMenor`:return Oe(n);case`gasto`:return ke(n);case`inventario`:return Ie(n);default:console.warn(`Tipo de ticket no soportado para impresi√≥n en navegador: ${e}`)}};if(!Ct()){r();return}try{localStorage.setItem(`ticketData`,JSON.stringify(n)),localStorage.setItem(`ticketUser`,JSON.stringify(t)),localStorage.setItem(`ticketType`,e)}catch(e){console.error(`Error al preparar datos para impresi√≥n:`,e),r();return}let i=(e=>(e?String(e):`${Date.now()}`).replace(/\s/g,`-`))(n.consecutivo),a=`ticket-${e}-${i}`,o=`Impresi√≥n de ticket`;e===`gasto`?o=`Comprobante ${n.consecutivo||``}`.trim():e===`inventario`?o=`Reporte de Inventario`:n.consecutivo&&(o=`Ticket ${n.consecutivo}`);let s=new se(a,{url:`/imprimir`,title:o,width:310,height:600,resizable:!0,decorations:!0});s.once(`tauri://created`,()=>{console.log(`Ventana de impresi√≥n creada`)}),s.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),r()})},Pe=async()=>{fe(!0);let e=[];try{let t=R(z(Y,`articulos`),M(`nombre`,`asc`));(await B(t)).forEach(t=>{e.push({id:t.id,...t.data()})}),de(e)}catch(e){console.error(`Error al cargar inventario: `,e),await Q(`Error al cargar inventario.`)}fe(!1)},Fe=async()=>{if(G.length===0){await Q(`No hay datos de inventario para exportar.`,{title:`Nasashe sas`,type:`warning`});return}let e=new S;e.text(`Reporte de Inventario Actual`,14,15),e.setFontSize(10),e.text(`Generado por: ${t?.nombre||`SISTEMA`}`,14,20),e.text(`Fecha: ${new Date().toLocaleDateString(`es-CO`)}`,14,25);let n=[`Nombre`,`Precio Compra ($)`,`Stock Actual (kg/und)`],r=[];G.forEach(e=>{let t=Number(e?.precioCompra??0),n=Number(e?.stock??0),i=[e?.nombre||`Sin nombre`,t.toLocaleString(`es-CO`),n.toLocaleString(`es-CO`)];r.push(i)}),C(e,{head:[n],body:r,startY:30});let i=new Date().toISOString().split(`T`)[0];try{e.save(`Reporte_Inventario_${i}.pdf`),await Q(`Su archivo se export√≥ con √©xito en la carpeta de descargas.`,{title:`Nasashe sas`,type:`info`})}catch(e){console.error(`Error al exportar el inventario a PDF:`,e),await Q(`Ocurri√≥ un error al exportar el PDF. Por favor, int√©ntalo de nuevo.`,{title:`Nasashe sas`,type:`error`})}},Ie=async e=>{let n=Array.isArray(e?.items)&&e.items.length>0?e.items:G;if(!n||n.length===0){await Q(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`warning`});return}let r=`<!DOCTYPE html><html><head><title>Reporte Inventario</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${Tt(n,t)}</pre></body></html>`,i=document.createElement(`iframe`);i.style.position=`fixed`,i.style.right=`0`,i.style.bottom=`0`,i.style.width=`0`,i.style.height=`0`,i.style.border=`0`,document.body.appendChild(i);let a=()=>{setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};i.onload=()=>{let e=i.contentWindow;e?(e.focus(),e.print(),e.onafterprint=a,setTimeout(a,5e3)):a()},i.srcdoc=r};return(0,q.jsxs)(`div`,{className:`pagina-reportes`,children:[(0,q.jsx)(`h1`,{children:`M√≥dulo de Reportes`}),(0,q.jsxs)(`div`,{className:`tabs-container`,children:[(0,q.jsx)(`button`,{className:`tab-button ${n===`cierre`?`active`:``}`,onClick:()=>r(`cierre`),children:`Cierre de Caja`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`historialCompras`?`active`:``}`,onClick:()=>r(`historialCompras`),children:`Hist. Compras`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`historialVentas`?`active`:``}`,onClick:()=>r(`historialVentas`),children:`Hist. Ventas`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`historialVentasMenores`?`active`:``}`,onClick:()=>r(`historialVentasMenores`),children:`Hist. Ventas Menores`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`historialGastos`?`active`:``}`,onClick:()=>r(`historialGastos`),children:`Hist. Gastos`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`libroCaja`?`active`:``}`,onClick:()=>r(`libroCaja`),children:`Libro de Caja`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`historialRemisiones`?`active`:``}`,onClick:()=>r(`historialRemisiones`),children:`Hist. Remisiones`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`inventario`?`active`:``}`,onClick:()=>r(`inventario`),children:`Inventario`}),(0,q.jsx)(`button`,{className:`tab-button ${n===`analisis`?`active`:``}`,onClick:()=>r(`analisis`),children:`An√°lisis de Materiales`})]}),(0,q.jsxs)(`div`,{className:`tab-content`,children:[n===`cierre`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-cierre`,children:`Seleccione la fecha:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-cierre`,value:o,onChange:e=>s(e.target.value)}),(0,q.jsx)(`button`,{onClick:ge,className:`btn-generar`,disabled:i,children:i?`Calculando...`:`Generar Cierre`})]}),(0,q.jsxs)(`h2`,{children:[`Resumen del D√≠a (`,o,`)`]}),(0,q.jsxs)(`div`,{className:`reporte-grid`,children:[(0,q.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,q.jsx)(`h3`,{children:`(+) Total Ventas Menores`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,f.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,q.jsx)(`h3`,{children:`(-) Total Compras`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,c.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,q.jsx)(`h3`,{children:`(-) Total Gastos`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,u.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,q.jsx)(`h3`,{children:`(=) Efectivo Actual en Caja`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,e.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,q.jsx)(`h3`,{children:`(=) Base Inicial (Calculada)`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,ve.toLocaleString(`es-CO`)]})]})]})]}),n===`historialCompras`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,q.jsx)(`button`,{onClick:ye,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Compras`})]}),(0,q.jsx)(`h2`,{children:`Historial de Compras`}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Consecutivo`}),(0,q.jsx)(`th`,{children:`Reciclador`}),(0,q.jsx)(`th`,{children:`Total`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):v.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron compras.`})}):v.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,q.jsx)(`td`,{children:e.consecutivo}),(0,q.jsx)(`td`,{children:e.reciclador}),(0,q.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{onClick:()=>Ne(`compra`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentas`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,q.jsx)(`button`,{onClick:be,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas`})]}),(0,q.jsx)(`h2`,{children:`Historial de Ventas (a Proveedores)`}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Consecutivo`}),(0,q.jsx)(`th`,{children:`Cliente (Proveedor)`}),(0,q.jsx)(`th`,{children:`Total`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):b.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):b.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,q.jsx)(`td`,{children:e.consecutivo}),(0,q.jsx)(`td`,{children:e.proveedor.nombre}),(0,q.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{onClick:()=>Ne(`venta`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentasMenores`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.g.value)}),(0,q.jsx)(`button`,{onClick:xe,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas Menores`})]}),(0,q.jsx)(`h2`,{children:`Historial de Ventas Menores (a Particulares)`}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Consecutivo`}),(0,q.jsx)(`th`,{children:`Cliente`}),(0,q.jsx)(`th`,{children:`Total`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):w.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):w.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,q.jsx)(`td`,{children:e.consecutivo}),(0,q.jsx)(`td`,{children:e.cliente}),(0,q.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{onClick:()=>Ne(`ventaMenor`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialGastos`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,q.jsx)(`button`,{onClick:Se,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Gastos`})]}),(0,q.jsx)(`h2`,{children:`Historial de Gastos`}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Consecutivo`}),(0,q.jsx)(`th`,{children:`Concepto`}),(0,q.jsx)(`th`,{children:`Descripci√≥n`}),(0,q.jsx)(`th`,{children:`Monto`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):E.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron gastos.`})}):E.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,q.jsx)(`td`,{children:e.consecutivo}),(0,q.jsx)(`td`,{children:e.concepto}),(0,q.jsx)(`td`,{children:e.descripcion}),(0,q.jsxs)(`td`,{children:[`$`,e.monto.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{onClick:()=>Ne(`gasto`,e,t),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`libroCaja`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`caja-fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`caja-fecha-inicio`,value:L,onChange:e=>ee(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`caja-fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`caja-fecha-fin`,value:te,onChange:e=>ne(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`caja-tipo`,children:`Tipo:`}),(0,q.jsxs)(`select`,{id:`caja-tipo`,value:H,onChange:e=>re(e.target.value),children:[(0,q.jsx)(`option`,{value:`todos`,children:`Todos`}),(0,q.jsx)(`option`,{value:`ingreso`,children:`Ingreso`}),(0,q.jsx)(`option`,{value:`egreso`,children:`Egreso`}),(0,q.jsx)(`option`,{value:`ajuste`,children:`Ajuste`})]}),(0,q.jsx)(`label`,{htmlFor:`caja-usuario`,children:`Usuario:`}),(0,q.jsx)(`input`,{id:`caja-usuario`,type:`text`,placeholder:`Filtro por usuario`,value:ie,onChange:e=>ae(e.target.value)}),(0,q.jsx)(`button`,{onClick:we,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Movimientos`})]}),(0,q.jsx)(`h2`,{children:`Libro de Caja`}),(0,q.jsxs)(`div`,{className:`reporte-grid`,children:[(0,q.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,q.jsx)(`h3`,{children:`(+) Ingresos`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,le.ingresos.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,q.jsx)(`h3`,{children:`(-) Egresos`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,le.egresos.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,q.jsx)(`h3`,{children:`(+/-) Ajustes`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,le.ajustes.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,q.jsx)(`h3`,{children:`(=) Saldo Calculado`}),(0,q.jsxs)(`div`,{className:`monto`,children:[`$`,le.saldo.toLocaleString(`es-CO`)]})]})]}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Tipo`}),(0,q.jsx)(`th`,{children:`Descripci√≥n`}),(0,q.jsx)(`th`,{children:`Usuario`}),(0,q.jsx)(`th`,{children:`Estado`}),(0,q.jsx)(`th`,{children:`Monto`}),(0,q.jsx)(`th`,{children:`Referencia`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`Buscando...`})}):oe.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`No se encontraron movimientos.`})}):oe.map(e=>{let t=Number(e.monto)||0,n=e.tipo===`egreso`?`-`:`+`,r=e.tipo===`egreso`?`card-egresos`:`card-ingresos`,i=e.referencia?.consecutivo||e.referencia?.id||`N/A`;return(0,q.jsxs)(`tr`,{style:e.anulado?{opacity:.55,textDecoration:`line-through`}:void 0,children:[(0,q.jsx)(`td`,{children:e.fecha?.toLocaleString(`es-CO`)}),(0,q.jsx)(`td`,{children:String(e.tipo||``).toUpperCase()}),(0,q.jsx)(`td`,{children:e.descripcion||`Sin descripci√≥n`}),(0,q.jsx)(`td`,{children:e.usuario||`N/A`}),(0,q.jsx)(`td`,{children:e.anulado?`ANULADO`:`ACTIVO`}),(0,q.jsxs)(`td`,{className:r,children:[n,` $`,Math.abs(t).toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:i})]},e.id)})})]})]}),n===`historialRemisiones`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`remision-fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`remision-fecha-inicio`,value:A,onChange:e=>j(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`remision-fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`remision-fecha-fin`,value:N,onChange:e=>P(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`remision-consecutivo`,children:`Consecutivo (opcional)`}),(0,q.jsx)(`input`,{id:`remision-consecutivo`,type:`text`,placeholder:`REM-000001`,value:F,onChange:e=>I(e.target.value)}),(0,q.jsx)(`button`,{onClick:Ce,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Remisiones`})]}),(0,q.jsx)(`h2`,{children:`Historial de Remisiones`}),(0,q.jsxs)(`table`,{className:`historial-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Fecha`}),(0,q.jsx)(`th`,{children:`Consecutivo`}),(0,q.jsx)(`th`,{children:`Destino`}),(0,q.jsx)(`th`,{children:`Conductor`}),(0,q.jsx)(`th`,{children:`Items`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:i?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):O.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron remisiones.`})}):O.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:Ae(e.fecha)}),(0,q.jsx)(`td`,{children:e.consecutivo}),(0,q.jsx)(`td`,{children:e.destino?.nombre||`N/D`}),(0,q.jsx)(`td`,{children:e.conductor?.nombre||`N/D`}),(0,q.jsx)(`td`,{children:Array.isArray(e.items)?e.items.length:0}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{onClick:()=>Me(e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`analisis`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`inventario-header`,children:[(0,q.jsx)(`h2`,{children:`Reporte de Inventario Actual`}),(0,q.jsxs)(`div`,{className:`inventario-header-botones`,children:[(0,q.jsx)(`button`,{onClick:Pe,className:`btn-generar`,disabled:K,children:K?`Cargando...`:`Cargar Inventario`}),(0,q.jsx)(`button`,{onClick:Fe,className:`btn-exportar-pdf`,disabled:G.length===0,children:`Exportar a PDF`}),(0,q.jsx)(`button`,{onClick:async()=>{if(G.length===0){await Q(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`error`});return}let e={items:G.map(({id:e,nombre:t,stock:n,precioCompra:r})=>({id:e,nombre:t,stock:n,precioCompra:r})),fechaGeneracion:new Date().toISOString()};try{await Ne(`inventario`,e)}catch(t){console.error(`Error al preparar la impresi√≥n del inventario:`,t),Ie(e)}},className:`btn-imprimir-inventario`,disabled:G.length===0,children:`Imprimir`})]})]}),(0,q.jsxs)(`table`,{className:`inventario-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Nombre`}),(0,q.jsx)(`th`,{children:`Precio Compra`}),(0,q.jsx)(`th`,{children:`Stock Actual (kg/und)`})]})}),(0,q.jsx)(`tbody`,{children:K?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`Cargando...`})}):G.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`No se encontr√≥ inventario.`})}):G.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,q.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})]}),n===`analisis`&&(0,q.jsxs)(`div`,{children:[(0,q.jsxs)(`div`,{className:`reporte-controles`,children:[(0,q.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,q.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,q.jsxs)(`label`,{className:`checkbox-inline`,style:{display:`flex`,alignItems:`center`,gap:`8px`},children:[(0,q.jsx)(`input`,{type:`checkbox`,checked:me,onChange:e=>he(e.target.checked)}),`Usar escala logar√≠tmica`]}),(0,q.jsx)(`button`,{onClick:async()=>{a(!0),J(null);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=V.fromDate(e),r=V.fromDate(t),i={};try{let e=R(z(Y,`compras`),U(`fecha`,`>=`,n),U(`fecha`,`<=`,r));(await B(e)).forEach(e=>{e.data().items.forEach(e=>{i[e.nombre]=(i[e.nombre]||0)+e.cantidad})});let t=Object.keys(i),a=Object.values(i);t.length===0?J({labels:[],datasets:[]}):J({labels:t,datasets:[{label:`Total Comprado (kg/und)`,data:a,backgroundColor:`rgba(220, 53, 69, 0.6)`,borderColor:`rgba(220, 53, 69, 1)`,borderWidth:1,minBarLength:8}]})}catch(e){console.error(`Error al generar an√°lisis: `,e),await Q(`Error al generar an√°lisis.`,{title:`Error de an√°lisis`,type:`error`})}a(!1)},className:`btn-generar`,disabled:i,children:i?`Generando...`:`Generar An√°lisis`})]}),(0,q.jsx)(`h2`,{children:`An√°lisis de Materiales Comprados (por Cantidad)`}),(0,q.jsx)(`div`,{className:`chart-container`,children:i?(0,q.jsx)(`p`,{children:`Generando gr√°fica...`}):pe?pe.labels.length>0?(0,q.jsx)(St,{chartData:pe,titulo:`Materiales Comprados (${m} a ${g})`,useLogScale:me}):(0,q.jsx)(`p`,{children:`No se encontraron datos de compras para este rango de fechas.`}):(0,q.jsx)(`p`,{children:`Seleccione un rango de fechas y haga clic en "Generar An√°lisis" para ver la gr√°fica.`})})]})]})]})}var Dt=Et,Ot=e=>String(e||``).trim().toUpperCase(),kt=e=>String(e||``).trim().toLowerCase();async function At(e){let t=e.trim();if(!t)throw Error(`Usuario no encontrado.`);let n=z(Y,`usuarios`),r=Ot(t),i=await B(R(n,U(`nombre`,`==`,r)));if(!i.empty){let e=i.docs[0].data()?.email;if(e)return e}let a=(await B(n)).docs.map(e=>e.data()).find(e=>[e?.nombre,e?.nombreUsuario,e?.username,e?.usuario].map(Ot).includes(r))?.email;if(a)return a;if(t.includes(`@`))return kt(t);throw Error(`Usuario no encontrado.`)}function jt(){let[e,t]=(0,W.useState)(``),[n,r]=(0,W.useState)(``),[i,a]=(0,W.useState)(null),[o,s]=(0,W.useState)(!1),c=m();return(0,q.jsx)(`div`,{className:`login-page-container`,children:(0,q.jsxs)(`div`,{className:`login-box`,children:[(0,q.jsx)(`h1`,{children:`Iniciar Sesi√≥n`}),(0,q.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),a(null),s(!0);try{let t=await At(e);await ie(he,t,n),c(`/`)}catch(e){e?.code===`permission-denied`||e?.code===`firestore/permission-denied`?a(`No hay permiso para leer usuarios en Firestore.`):e?.message===`Usuario no encontrado.`?a(`Nombre de usuario incorrecto.`):e?.code===`auth/invalid-credential`||e?.code===`auth/wrong-password`?a(`Contrase√±a incorrecta.`):e?.code===`auth/user-not-found`?a(`Usuario no existe en Authentication.`):a(`Error al iniciar sesi√≥n. Intente de nuevo.`),console.error(e)}finally{s(!1)}},className:`login-form`,children:[(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`nombre-usuario`,children:`Nombre de Usuario:`}),(0,q.jsx)(`input`,{id:`nombre-usuario`,type:`text`,value:e,onChange:e=>t(e.target.value),required:!0})]}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`password`,children:`Contrase√±a:`}),(0,q.jsx)(`input`,{id:`password`,type:`password`,value:n,onChange:e=>r(e.target.value),required:!0})]}),(0,q.jsx)(`button`,{type:`submit`,className:`login-btn`,disabled:o,children:o?`Ingresando...`:`Ingresar`}),i&&(0,q.jsx)(`p`,{className:`login-error`,children:i})]})]})})}var Mt=jt,Nt=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,Pt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function Ft(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,W.useState)(!1),[a,o]=(0,W.useState)(``),[s,c]=(0,W.useState)(``),[l,u]=(0,W.useState)(``),[d,f]=(0,W.useState)(``),[p,m]=(0,W.useState)([]),[h,g]=(0,W.useState)(0),[_,v]=(0,W.useState)(null),[y,b]=(0,W.useState)(null),x=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`;(0,W.useEffect)(()=>{let e=p.reduce((e,t)=>e+t.subtotal,0);g(e)},[p]);let S=()=>{let e=Number(l),t=Number(d);if(!s||e<=0||t<=0){alert(`Complete Material, Cantidad y Precio.`);return}let n=e*t;m(r=>[...r,{id:new Date().getTime(),localId:x(),descripcion:s.toUpperCase(),cantidad:e,precio:t,subtotal:n}]),c(``),u(``),f(``)},C=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&(m(t=>t.filter(t=>t.localId!==e)),b(t=>t===e?null:t))},w=e=>{b(t=>t===e?null:e)},T=(e,t)=>{let n=Number(e.target.value);n<=0||m(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precio}:e))},E=(e,t)=>{let n=Number(e.target.value);n<=0||m(e=>e.map(e=>e.localId===t?{...e,precio:n,subtotal:n*e.cantidad}:e))},D=async()=>{if(p.length===0){alert(`No hay art√≠culos en la venta.`);return}i(!0);let t=null;try{let r=k(z(Y,`ventasMenores`)),{consecutivo:i,bloqueRef:s}=await n(`ventasMenores`),c=a.trim().toUpperCase(),l={consecutivo:i,cliente:c||`N/A`,items:p,total:h,fecha:V.now(),usuario:e?.nombre||`SISTEMA`};t=l;let u=A(Y),d=k(z(Y,`movimientos_caja`));u.set(r,l),u.update(s,{siguiente:j(1),actualizadoEn:V.now()}),u.set(d,{tipo:`ingreso`,monto:h,descripcion:`Venta menor ${i} - ${c||`N/A`}`,fecha:V.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`ventasMenores`,id:r.id,consecutivo:i}}),await u.commit(),v(t),o(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}i(!1)},O=t=>{let n=ot(t,e);ct({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return(0,q.jsxs)(`div`,{className:`pagina-ventas-menores`,children:[(0,q.jsx)(`h1`,{children:`Registro de Venta Menor (a Particular)`}),(0,q.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,q.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`layout-ventas-menores`,children:[(0,q.jsxs)(`div`,{className:`formulario-venta-menor`,children:[(0,q.jsx)(`h2`,{children:`Datos de la Venta`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`cliente`,children:`Nombre Cliente (Opcional):`}),(0,q.jsx)(`input`,{id:`cliente`,type:`text`,value:a,onChange:e=>o(e.target.value.toUpperCase()),disabled:_})]}),(0,q.jsx)(`hr`,{}),(0,q.jsx)(`h3`,{children:`Material`}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`itemDescripcion`,children:`Descripci√≥n:`}),(0,q.jsx)(`input`,{id:`itemDescripcion`,type:`text`,value:s,onChange:e=>c(e.target.value.toUpperCase()),disabled:_})]}),(0,q.jsxs)(`div`,{className:`form-manual-item`,children:[(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`itemCantidad`,children:`Cantidad:`}),(0,q.jsx)(`input`,{id:`itemCantidad`,type:`number`,value:l,onChange:e=>u(e.target.value),disabled:_})]}),(0,q.jsxs)(`div`,{className:`form-grupo`,children:[(0,q.jsx)(`label`,{htmlFor:`itemPrecio`,children:`Precio x (Und o Kg):`}),(0,q.jsx)(`input`,{id:`itemPrecio`,type:`number`,value:d,onChange:e=>f(e.target.value),disabled:_})]})]}),(0,q.jsx)(`button`,{type:`button`,onClick:S,className:`btn-anadir-item-menor`,disabled:_,children:`+ A√±adir Item`})]}),(0,q.jsxs)(`div`,{className:`pre-factura`,children:[(0,q.jsx)(`h2`,{children:`Items de la Venta`}),(0,q.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Descripci√≥n`}),(0,q.jsx)(`th`,{children:`Cant.`}),(0,q.jsx)(`th`,{children:`Precio`}),(0,q.jsx)(`th`,{children:`Subtotal`}),(0,q.jsx)(`th`,{children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:(_?_.items:p).length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√±ade art√≠culos manuales...`})}):(_?_.items:p).map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.descripcion}),(0,q.jsx)(`td`,{children:y===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>T(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,q.jsx)(`td`,{children:y===e.localId?(0,q.jsx)(`input`,{type:`number`,value:e.precio,onChange:t=>E(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precio}`}),(0,q.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,q.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>w(e.localId),disabled:_,children:y===e.localId?`Listo`:`Editar`}),(0,q.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>C(e.localId),disabled:_,children:`Anular`})]})]},e.localId||e.id))})]}),(0,q.jsxs)(`div`,{className:`total-venta-menor`,children:[`Total: $`,(_?_.total:h).toLocaleString(`es-CO`)]}),(0,q.jsx)(`div`,{className:`botones-accion`,children:_?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`p`,{className:`venta-exitosa`,children:[`¬°Venta `,_.consecutivo,` guardada!`]}),(0,q.jsx)(`button`,{type:`button`,onClick:async()=>{if(_)if(!Nt())O(_);else{localStorage.setItem(`ticketData`,JSON.stringify(_)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`ventaMenor`);let t=`ticket-venta-menor-${_.consecutivo.replace(/\s/g,`-`)}`;new se(t,{url:`/imprimir`,title:`Ticket ${_.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),O(_)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{if(!_||Nt())return;let t=ot(_,e);Pt(t,_.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{m([]),g(0),o(``),v(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,q.jsx)(`button`,{type:`button`,onClick:D,className:`btn-guardar-venta-menor`,disabled:r||p.length===0,children:r?`Guardando...`:`Guardar Venta`})})]})]})]})}var It=Ft;function Lt(){let[e,t]=(0,W.useState)(!0),[n,r]=(0,W.useState)([]),[i,a]=(0,W.useState)(!1),[o,s]=(0,W.useState)(``),[c,l]=(0,W.useState)(``),[u,d]=(0,W.useState)(``),[f,p]=(0,W.useState)(`empleado`),m=async()=>{t(!0);try{let e=(await B(z(Y,`usuarios`))).docs.map(e=>({id:e.id,...e.data()}));r(e)}catch(e){console.error(`Error al traer usuarios: `,e)}t(!1)};(0,W.useEffect)(()=>{m()},[]);let h=async e=>{if(e.preventDefault(),!o||!c||!u){alert(`Complete todos los campos.`);return}a(!0);try{let e=o.trim(),t=c.trim().toLowerCase(),n=(await ae(he,t,u)).user.uid;await P(k(Y,`usuarios`,n),{nombre:e.toUpperCase(),nombreNormalizado:e.toUpperCase(),email:t,rol:f}),alert(`Usuario ${e.toUpperCase()} creado!`),s(``),l(``),d(``),p(`empleado`),await m()}catch(e){console.error(`Error al crear usuario: `,e),e.code===`auth/email-already-in-use`?alert(`Error: Este correo electr√≥nico ya est√° en uso.`):alert(`Error al crear el usuario. Verifique la consola.`)}a(!1)},g=async(e,t)=>{if(window.confirm(`¬øSeguro que deseas eliminar a ${t}? Esta acci√≥n no se puede deshacer.`))try{await I(k(Y,`usuarios`,e)),alert(`Usuario ${t} eliminado.`),await m()}catch(e){console.error(`Error al eliminar usuario: `,e)}};return(0,q.jsxs)(`div`,{className:`pagina-usuarios`,children:[(0,q.jsx)(`h1`,{children:`Gesti√≥n de Usuarios`}),(0,q.jsx)(`p`,{children:`Aqu√≠ puedes crear y administrar las cuentas de los empleados.`}),(0,q.jsxs)(`div`,{className:`form-container`,children:[(0,q.jsx)(`h2`,{children:`A√±adir Nuevo Usuario`}),(0,q.jsxs)(`form`,{onSubmit:h,children:[(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{children:`Nombre (para Login):`}),(0,q.jsx)(`input`,{type:`text`,value:o,onChange:e=>s(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{children:`Email (real):`}),(0,q.jsx)(`input`,{type:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{children:`Contrase√±a:`}),(0,q.jsx)(`input`,{type:`password`,value:u,onChange:e=>d(e.target.value)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`label`,{children:`Rol:`}),(0,q.jsxs)(`select`,{value:f,onChange:e=>p(e.target.value),children:[(0,q.jsx)(`option`,{value:`empleado`,children:`Empleado`}),(0,q.jsx)(`option`,{value:`admin`,children:`Administrador`})]})]}),(0,q.jsx)(`button`,{type:`submit`,disabled:i,children:i?`Creando...`:`Crear Usuario`})]})]}),(0,q.jsx)(`h2`,{children:`Lista de Usuarios`}),e?(0,q.jsx)(`p`,{children:`Cargando...`}):(0,q.jsxs)(`table`,{className:`usuarios-table`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Nombre`}),(0,q.jsx)(`th`,{children:`Email`}),(0,q.jsx)(`th`,{children:`Rol`}),(0,q.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,q.jsx)(`tbody`,{children:n.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{children:e.email}),(0,q.jsx)(`td`,{children:e.rol}),(0,q.jsx)(`td`,{className:`acciones-cell`,children:e.rol!==`admin`&&(0,q.jsx)(`button`,{onClick:()=>g(e.id,e.nombre),className:`btn-borrar`,children:`Borrar`})})]},e.id))})]})]})}var Rt=Lt,zt=e=>`REM-${String(e).padStart(6,`0`)}`,Bt=e=>{let t=Number(e);return Number.isNaN(t)?0:t},Vt=()=>typeof crypto<`u`&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Ht=async e=>{let t=await(await fetch(e)).blob();return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})};function Ut(){let{userProfile:e,consecutivosData:t,bloquesConsecutivos:n,obtenerConsecutivoParaModulo:r}=X(),i=e?.rol===`admin`,[a,o]=(0,W.useState)([]),[s,c]=(0,W.useState)([]),[l,u]=(0,W.useState)(``),[d,f]=(0,W.useState)({nombre:``,nit:``,direccion:``,telefono:``}),[p,m]=(0,W.useState)({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),[h,g]=(0,W.useState)({articuloId:``,cantidad:``,modoCantidad:`manual`}),[_,v]=(0,W.useState)([]),[y,b]=(0,W.useState)(``),[x,w]=(0,W.useState)(!1),[T,E]=(0,W.useState)(null),[D,O]=(0,W.useState)(``),M=(0,W.useMemo)(()=>{let e=n?.remisiones,r=Number(e?.siguiente),i=Number(e?.fin);return Number.isFinite(r)&&Number.isFinite(i)&&r<=i?r:(t?.remisiones??0)+1},[n,t]);(0,W.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([B(z(Y,`proveedores`)),B(z(Y,`articulos`))]),n=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre)),r=t.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));o(n),c(r)}catch(e){console.error(`Error al cargar datos para la remisi√É¬≥n:`,e)}})()},[]);let N=e=>{let t=e.target.value;u(t);let n=a.find(e=>e.id===t);n&&f({nombre:n.nombre||``,nit:n.nit||``,direccion:n.direccion||``,telefono:n.telefono||``})},P=e=>{let{name:t,value:n}=e.target;m(e=>({...e,[t]:t===`vinculo`?n:n.toUpperCase()}))},F=e=>{let t=e.target.value,n=s.find(e=>e.id===t);g(e=>({...e,articuloId:t,cantidad:n&&e.modoCantidad===`stock`?n.stock||0:``}))},I=e=>{let t=s.find(e=>e.id===h.articuloId);g(n=>({...n,modoCantidad:e,cantidad:e===`stock`&&t?t.stock||0:``}))},L=()=>{if(!h.articuloId){alert(`Selecciona un material antes de agregarlo.`);return}let e=s.find(e=>e.id===h.articuloId);if(!e){alert(`No se pudo identificar el material.`);return}let t=h.modoCantidad===`stock`?e.stock||0:Bt(h.cantidad);if(t<=0){alert(`Ingresa una cantidad v√É¬°lida.`);return}if(t>(e.stock||0)){alert(`La cantidad supera el stock disponible (${e.stock||0}).`);return}v(n=>[...n,{localId:Vt(),articuloId:e.id,nombre:e.nombre,cantidad:t,modoCantidad:h.modoCantidad}]),g({articuloId:``,cantidad:``,modoCantidad:`manual`})},R=e=>{v(t=>t.filter(t=>t.localId!==e))},ee=()=>i?l?_.length===0?(alert(`Agrega al menos un material a la remisi√É¬≥n.`),!1):!p.nombre||!p.cedula||!p.placa?(alert(`Completa los datos del conductor (nombre, c√É¬©dula y placa son obligatorios).`),!1):!0:(alert(`Selecciona un destino (proveedor).`),!1):(alert(`Solo los administradores pueden crear remisiones.`),!1),te=async e=>{let t=new S({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;try{let e=await Ht(encodeURI(K(`logo con fondo.png`)));t.addImage(e,`PNG`,12,r,40,20)}catch(e){console.warn(`No se pudo cargar el logo para el PDF:`,e)}t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√É‚ÄúN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino.nombre}`,12,r),t.text(`Direcci√É¬≥n: ${e.destino.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino.nit||`N/D`}`,12,r),t.text(`Tel√É¬©fono: ${e.destino.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√É¬≥n: ${new Date(e.fecha.toDate()).toLocaleString()}`,12,r),r+=6,t.text(`Conductor: ${e.conductor.nombre}`,12,r),t.text(`C√É¬©dula: ${e.conductor.cedula}`,n/2,r),r+=6,t.text(`Direcci√É¬≥n: ${e.conductor.direccion||`N/D`}`,12,r),r+=6,t.text(`V√É¬≠nculo: ${e.conductor.vinculo}`,12,r),t.text(`Placa: ${e.conductor.placa}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor.celular||`N/D`}`,12,r),r+=6,y&&(t.text(`Observaciones: ${y}`,12,r),r+=6),C(t,{startY:r+4,head:[[`√É¬çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:e.items.map((e,t)=>[(t+1).toString(),e.nombre,e.cantidad.toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√É¬°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t};return i?(0,q.jsxs)(`div`,{className:`remisiones-container`,children:[(0,q.jsxs)(`div`,{className:`remisiones-encabezado`,children:[(0,q.jsxs)(`div`,{className:`remisiones-encabezado-textos`,children:[(0,q.jsx)(`h1`,{children:`Remisiones`}),(0,q.jsx)(`p`,{children:`Genera y guarda remisiones con consecutivo y descarga el PDF listo para impresi√É¬≥n.`}),(0,q.jsxs)(`p`,{className:`remisiones-consecutivo`,children:[`Pr√É¬≥ximo consecutivo: `,(0,q.jsx)(`strong`,{children:zt(M)})]})]}),(0,q.jsx)(`img`,{src:K(`logo con fondo.png`),alt:`Logo Nasashe`,className:`remisiones-logo`})]}),(0,q.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,q.jsx)(`h2`,{children:`Destino`}),(0,q.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,q.jsxs)(`label`,{children:[`Destino (proveedor)`,(0,q.jsxs)(`select`,{value:l,onChange:N,children:[(0,q.jsx)(`option`,{value:``,children:`Seleccione...`}),a.map(e=>(0,q.jsx)(`option`,{value:e.id,children:e.nombre},e.id))]})]}),(0,q.jsxs)(`label`,{children:[`NIT / CC`,(0,q.jsx)(`input`,{type:`text`,value:d.nit,readOnly:!0})]}),(0,q.jsxs)(`label`,{children:[`Direcci√É¬≥n`,(0,q.jsx)(`input`,{type:`text`,value:d.direccion,readOnly:!0})]}),(0,q.jsxs)(`label`,{children:[`Tel√É¬©fono`,(0,q.jsx)(`input`,{type:`text`,value:d.telefono,readOnly:!0})]})]})]}),(0,q.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,q.jsx)(`h2`,{children:`Datos del conductor`}),(0,q.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,q.jsxs)(`label`,{children:[`Nombre`,(0,q.jsx)(`input`,{name:`nombre`,value:p.nombre,onChange:P})]}),(0,q.jsxs)(`label`,{children:[`C√É¬©dula`,(0,q.jsx)(`input`,{name:`cedula`,value:p.cedula,onChange:P})]}),(0,q.jsxs)(`label`,{children:[`Direcci√É¬≥n de residencia`,(0,q.jsx)(`input`,{name:`direccion`,value:p.direccion,onChange:P})]}),(0,q.jsxs)(`label`,{children:[`Placa veh√É¬≠culo`,(0,q.jsx)(`input`,{name:`placa`,value:p.placa,onChange:P})]}),(0,q.jsxs)(`label`,{children:[`Celular`,(0,q.jsx)(`input`,{name:`celular`,value:p.celular,onChange:P})]}),(0,q.jsxs)(`div`,{className:`remisiones-vinculo`,children:[(0,q.jsx)(`span`,{children:`V√É¬≠nculo con la raz√É¬≥n social`}),(0,q.jsxs)(`label`,{className:`remisiones-check`,children:[(0,q.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`CONTRATISTA DE FLETE`,checked:p.vinculo===`CONTRATISTA DE FLETE`,onChange:P}),`Contr. Flete`]}),(0,q.jsxs)(`label`,{className:`remisiones-check`,children:[(0,q.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`EMPLEADO`,checked:p.vinculo===`EMPLEADO`,onChange:P}),`Empleado`]})]})]})]}),(0,q.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,q.jsx)(`h2`,{children:`Materiales`}),(0,q.jsxs)(`div`,{className:`remisiones-articulos`,children:[(0,q.jsxs)(`label`,{children:[`Material`,(0,q.jsxs)(`select`,{value:h.articuloId,onChange:F,children:[(0,q.jsx)(`option`,{value:``,children:`Seleccione...`}),s.map(e=>(0,q.jsxs)(`option`,{value:e.id,children:[e.nombre,` (stock: `,e.stock||0,` Kg)`]},e.id))]})]}),(0,q.jsxs)(`div`,{className:`remisiones-cantidad-opciones`,children:[(0,q.jsx)(`span`,{children:`Cantidad`}),(0,q.jsxs)(`div`,{className:`remisiones-radios`,children:[(0,q.jsxs)(`label`,{children:[(0,q.jsx)(`input`,{type:`radio`,checked:h.modoCantidad===`stock`,onChange:()=>I(`stock`)}),`Usar stock disponible`]}),(0,q.jsxs)(`label`,{children:[(0,q.jsx)(`input`,{type:`radio`,checked:h.modoCantidad===`manual`,onChange:()=>I(`manual`)}),`Ingresar manualmente`]})]}),h.modoCantidad===`manual`&&(0,q.jsx)(`input`,{type:`number`,min:`0`,value:h.cantidad,onChange:e=>g(t=>({...t,cantidad:e.target.value})),placeholder:`Cantidad en Kg`})]}),(0,q.jsx)(`button`,{type:`button`,className:`remisiones-add`,onClick:L,children:`A√É¬±adir material`})]}),_.length>0&&(0,q.jsxs)(`table`,{className:`remisiones-tabla`,children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`#`}),(0,q.jsx)(`th`,{children:`Material`}),(0,q.jsx)(`th`,{children:`Cantidad (Kg)`}),(0,q.jsx)(`th`,{})]})}),(0,q.jsx)(`tbody`,{children:_.map((e,t)=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:t+1}),(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{children:e.cantidad}),(0,q.jsx)(`td`,{children:(0,q.jsx)(`button`,{type:`button`,className:`remisiones-delete`,onClick:()=>R(e.localId),children:`Quitar`})})]},e.localId))})]})]}),(0,q.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,q.jsx)(`h2`,{children:`Observaciones`}),(0,q.jsx)(`textarea`,{value:y,onChange:e=>b(e.target.value.toUpperCase()),placeholder:`Datos adicionales, sellos, etc.`,rows:3})]}),(0,q.jsxs)(`div`,{className:`remisiones-acciones`,children:[(0,q.jsx)(`button`,{type:`button`,onClick:async()=>{if(!ee())return;w(!0);let t=a.find(e=>e.id===l);try{let n=k(z(Y,`remisiones`)),i=null,{consecutivo:a,bloqueRef:o}=await r(`remisiones`),c=_.map(e=>{let t=s.find(t=>t.id===e.articuloId);if(!t)throw Error(`No se encontro el articulo ${e.nombre} en cache.`);let n=Number(t.stock)||0;if(e.cantidad>n)throw Error(`El material ${e.nombre} no tiene stock suficiente.`);return e}),l={consecutivo:a,destino:{id:t.id,nombre:t.nombre,nit:t.nit||``,direccion:t.direccion||``,telefono:t.telefono||``},conductor:p,items:c,observaciones:y,fecha:V.now(),creadoPor:e?.nombre||`SISTEMA`};i=l;let d=A(Y);d.set(n,l),d.update(o,{siguiente:j(1),actualizadoEn:V.now()}),c.forEach(e=>{let t=k(Y,`articulos`,e.articuloId);d.update(t,{stock:j(-e.cantidad)})}),await d.commit();let h=await te(i);E(h),O(i.consecutivo),v([]),b(``),u(``),f({nombre:``,nit:``,direccion:``,telefono:``}),m({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),g({articuloId:``,cantidad:``,modoCantidad:`manual`});let x=h.output(`bloburl`);window.open(x,`_blank`)}catch(e){console.error(`Error al guardar la remisi√É¬≥n:`,e),alert(e.message||`No se pudo guardar la remisi√É¬≥n.`)}w(!1)},disabled:x,children:x?`Guardando...`:`Guardar y generar PDF`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{if(T){let e=T.output(`bloburl`),t=document.createElement(`iframe`);t.style.display=`none`,t.src=e,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print()}}},disabled:!T,children:`Imprimir √É¬∫ltima remisi√É¬≥n`}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>{T&&D&&T.save(`${D}.pdf`)},disabled:!T,children:`Descargar PDF`})]})]}):(0,q.jsxs)(`div`,{className:`remisiones-container`,children:[(0,q.jsx)(`h1`,{children:`Remisiones`}),(0,q.jsx)(`p`,{className:`remisiones-alerta`,children:`Solo los administradores pueden gestionar las remisiones.`})]})}var Wt=Ut,Gt=e(y()),Kt=e=>{if(!e)return new Date;if(e instanceof Date)return e;if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?new Date:t}return typeof e==`object`&&typeof e.toDate==`function`?e.toDate():new Date};function qt({compraData:e,usuario:t}){if(!e)return null;let n=Kt(e.fecha).toLocaleString(`es-CO`);return e.consecutivo,(0,q.jsxs)(`div`,{className:`ticket-container`,children:[(0,q.jsxs)(`div`,{className:`ticket-header`,children:[(0,q.jsx)(`h3`,{children:`TICKET DE COMPRA`}),(0,q.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,q.jsx)(`p`,{children:`901907763-3`}),(0,q.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,q.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,q.jsx)(`p`,{children:`605-000-0000`})]}),(0,q.jsxs)(`div`,{className:`ticket-info`,children:[(0,q.jsxs)(`p`,{children:[`Factura: `,e.consecutivo]}),(0,q.jsx)(`p`,{children:`Actividad: Compra`}),(0,q.jsxs)(`p`,{children:[`Fecha: `,n]}),(0,q.jsxs)(`p`,{children:[`Facturado por: `,t?.nombre||`USUARIO`]})]}),(0,q.jsx)(`div`,{className:`ticket-barcode`,children:(0,q.jsx)(Gt.default,{value:e.consecutivo.replace(/\D/g,``),format:`CODE128`,displayValue:!1,margin:0})}),(0,q.jsx)(`div`,{className:`ticket-items`,children:(0,q.jsxs)(`table`,{children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,q.jsx)(`th`,{className:`col-cant`,children:`Cant`}),(0,q.jsx)(`th`,{className:`col-prec`,children:`Prec`}),(0,q.jsx)(`th`,{className:`col-tot`,children:`Total`})]})}),(0,q.jsx)(`tbody`,{children:e.items.map((e,t)=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.nombre}),(0,q.jsx)(`td`,{className:`col-cant`,children:(Number(e.cantidad)||0).toFixed(2)}),(0,q.jsxs)(`td`,{className:`col-prec`,children:[`$`,e.precioCompra]}),(0,q.jsxs)(`td`,{className:`col-tot`,children:[`$`,e.subtotal.toLocaleString(`es-CO`)]})]},t))})]})}),(0,q.jsxs)(`div`,{className:`ticket-totales`,children:[(0,q.jsxs)(`div`,{className:`total-row`,children:[(0,q.jsx)(`span`,{children:`Subtotal:`}),(0,q.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]}),(0,q.jsxs)(`div`,{className:`total-row`,children:[(0,q.jsx)(`span`,{children:`IVA (0%):`}),(0,q.jsx)(`span`,{children:`$0`})]}),(0,q.jsxs)(`div`,{className:`total-row final`,children:[(0,q.jsx)(`span`,{children:`Total:`}),(0,q.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]})]}),(0,q.jsxs)(`div`,{className:`ticket-footer`,children:[(0,q.jsx)(`p`,{children:`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`}),(0,q.jsx)(`p`,{children:`¬° Gracias por su venta !`})]})]})}var Jt=qt;function Yt({inventarioData:e,usuario:t}){if(!e||!Array.isArray(e.items)||e.items.length===0)return(0,q.jsx)(`div`,{className:`ticket-container`,children:(0,q.jsxs)(`div`,{className:`ticket-header`,children:[(0,q.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,q.jsx)(`p`,{children:`No hay art√≠culos para mostrar.`})]})});let n=e.fechaGeneracion?new Date(e.fechaGeneracion):new Date,r=e.items.length;return(0,q.jsxs)(`div`,{className:`ticket-container`,children:[(0,q.jsxs)(`div`,{className:`ticket-header`,children:[(0,q.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,q.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,q.jsx)(`p`,{children:`901907763-3`}),(0,q.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,q.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,q.jsx)(`p`,{children:`605-000-0000`})]}),(0,q.jsxs)(`div`,{className:`ticket-info`,children:[(0,q.jsxs)(`p`,{children:[`Fecha: `,n.toLocaleString(`es-CO`)]}),(0,q.jsxs)(`p`,{children:[`Generado por: `,t?.nombre||`USUARIO`]})]}),(0,q.jsx)(`div`,{className:`ticket-items`,children:(0,q.jsxs)(`table`,{children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,q.jsx)(`th`,{className:`col-tot`,children:`Stock (kg/und)`})]})}),(0,q.jsx)(`tbody`,{children:e.items.map(e=>(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{className:`col-mat`,children:e.nombre}),(0,q.jsx)(`td`,{className:`col-tot`,children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})}),(0,q.jsx)(`div`,{className:`ticket-totales`,children:(0,q.jsxs)(`div`,{className:`total-row final`,children:[(0,q.jsx)(`span`,{children:`Total de art√≠culos:`}),(0,q.jsx)(`span`,{children:r})]})}),(0,q.jsx)(`div`,{className:`ticket-footer`,children:(0,q.jsx)(`p`,{children:`Inventario generado autom√°ticamente.`})})]})}var Xt=Yt,Zt=(e,t)=>typeof t==`object`&&t&&`seconds`in t&&`nanoseconds`in t?new Date(t.seconds*1e3+t.nanoseconds/1e6):e===`fecha`&&typeof t==`string`&&t.includes(`T`)&&t.endsWith(`Z`)?new Date(t):t;function Qt(){let[e,t]=(0,W.useState)(null);if((0,W.useEffect)(()=>{try{let e=localStorage.getItem(`ticketData`),n=localStorage.getItem(`ticketUser`),r=localStorage.getItem(`ticketType`);if(e&&n&&r){let i=JSON.parse(e,Zt),a=JSON.parse(n);t({data:i,user:a,type:r}),localStorage.removeItem(`ticketData`),localStorage.removeItem(`ticketUser`),localStorage.removeItem(`ticketType`)}else console.error(`No se encontraron datos de impresi√≥n en localStorage.`)}catch(e){console.error(`Error al leer datos de impresi√≥n:`,e)}},[]),(0,W.useEffect)(()=>{if(e){let e=setTimeout(()=>{let e=()=>{try{window.__TAURI__?oe().close():window.close()}catch(e){console.warn(`No se pudo cerrar la ventana de impresi√≥n autom√°ticamente:`,e)}};window.onafterprint=e,window.print(),window.onfocus=()=>setTimeout(e,500)},100);return()=>clearTimeout(e)}},[e]),!e)return(0,q.jsx)(`div`,{style:{fontFamily:`monospace`,padding:`10px`},children:`Cargando ticket...`});switch(e.type){case`compra`:return(0,q.jsx)(Jt,{compraData:e.data,usuario:e.user});case`inventario`:return(0,q.jsx)(Xt,{inventarioData:e.data,usuario:e.user});default:return(0,q.jsx)(`div`,{children:`Error: Tipo de ticket no reconocido.`})}}var $t=Qt,en=k(Y,`configuracion`,`consecutivos`),tn=e=>{let t=Number(e);return Number.isNaN(t)||t<0?0:t},nn=(e,t=100)=>{let n=Number(e);return!Number.isFinite(n)||n<=0?t:Math.floor(n)};function rn(){let{userProfile:e,currentUser:t,deviceId:n,deviceAlias:r,reservarBloqueParaModulo:i,actualizarAliasDispositivo:a}=X(),o=e?.rol===`admin`,[s,c]=(0,W.useState)({compras:``,ventas:``,gastos:``,ventasMenores:``,remisiones:``}),[l,u]=(0,W.useState)(!0),[d,f]=(0,W.useState)(!1),[p,m]=(0,W.useState)(``),[h,g]=(0,W.useState)([]),[_,v]=(0,W.useState)(!0),[y,b]=(0,W.useState)(``),[x,S]=(0,W.useState)(!1),[C,w]=(0,W.useState)([]),[T,E]=(0,W.useState)(!0),[D,k]=(0,W.useState)({deviceId:``,deviceAlias:``,ownerUid:``,modulo:`ventas`,tamano:`100`}),A=(0,W.useMemo)(()=>Object.keys(_e),[]),j=(0,W.useMemo)(()=>Object.fromEntries(C.map(e=>[e.id,e])),[C]);(0,W.useEffect)(()=>{(async()=>{u(!0);try{let e=await te(en);if(e.exists()){let t=e.data();c({compras:(t.compras??0).toString(),ventas:(t.ventas??0).toString(),gastos:(t.gastos??0).toString(),ventasMenores:(t.ventasMenores??0).toString(),remisiones:(t.remisiones??0).toString()})}else m(`No se encontro el documento de consecutivos en la base de datos.`)}catch(e){console.error(`Error al cargar consecutivos:`,e),m(`No se pudieron cargar los consecutivos. Intenta nuevamente.`)}u(!1)})()},[]),(0,W.useEffect)(()=>{n&&k(e=>e.deviceId&&e.ownerUid&&e.deviceAlias?e:{...e,deviceId:e.deviceId||n,deviceAlias:e.deviceAlias||r||``,ownerUid:e.ownerUid||t?.uid||``})},[n,r,t?.uid]),(0,W.useEffect)(()=>{if(!o)return;let e=z(Y,`consecutivo_bloques`),t=H(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{let n=String(e.modulo||``).localeCompare(String(t.modulo||``));if(n!==0)return n;let r=String(e.deviceId||``).localeCompare(String(t.deviceId||``));return r===0?String(e.ownerUid||``).localeCompare(String(t.ownerUid||``)):r});g(t),v(!1)},e=>{console.error(`Error al escuchar bloques de consecutivos:`,e),v(!1)});return()=>t()},[o]),(0,W.useEffect)(()=>{if(!o)return;let e=z(Y,`usuarios`),t=H(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>String(e.nombre||e.email||e.id).localeCompare(String(t.nombre||t.email||t.id)));w(t),E(!1)},e=>{console.error(`Error al cargar usuarios para selector de bloques:`,e),E(!1)});return()=>t()},[o]);let M=e=>{let{name:t,value:n}=e.target;/^\d*$/.test(n)&&c(e=>({...e,[t]:n}))},N=async e=>{if(e.preventDefault(),!o){alert(`Solo un administrador puede modificar los consecutivos.`);return}let t={compras:tn(s.compras),ventas:tn(s.ventas),gastos:tn(s.gastos),ventasMenores:tn(s.ventasMenores),remisiones:tn(s.remisiones)};f(!0),m(``);try{await O(en,t),c({compras:t.compras.toString(),ventas:t.ventas.toString(),gastos:t.gastos.toString(),ventasMenores:t.ventasMenores.toString(),remisiones:t.remisiones.toString()}),m(`Consecutivos globales actualizados.`)}catch(e){console.error(`Error al actualizar consecutivos:`,e),m(`No se pudieron actualizar los consecutivos. Intentalo de nuevo.`)}f(!1)},P=e=>{let{name:t,value:n}=e.target;t===`tamano`&&!/^\d*$/.test(n)||k(e=>({...e,[t]:n}))},F=async()=>{if(D.modulo){S(!0),b(``);try{let e=nn(D.tamano),t=a(D.deviceAlias);await i({modulo:D.modulo,targetDeviceAlias:t,blockSize:e}),b(`Bloque reservado para este dispositivo (${t}) en ${D.modulo}.`)}catch(e){console.error(`Error al reservar bloque para dispositivo actual:`,e),b(e.message||`No se pudo reservar el bloque.`)}S(!1)}},I=async t=>{t.preventDefault();let n=String(D.deviceId||``).trim();if(!n){b(`Debes escribir un deviceId para reservar el bloque.`);return}let r=String(D.deviceAlias||``).trim();if(!r){b(`Debes escribir un alias para identificar el dispositivo.`);return}let i=String(D.ownerUid||``).trim();if(!i){b(`Debes seleccionar el usuario propietario del bloque.`);return}if(!A.includes(D.modulo)){b(`Modulo invalido para reservar bloque.`);return}S(!0),b(``);try{let t=nn(D.tamano),a=j[i],o=a?.nombre||a?.email||i;await je({deviceId:n,deviceAlias:r,ownerUid:i,modulo:D.modulo,blockSize:t,actor:e?.nombre||`ADMIN`}),b(`Bloque reservado: ${D.modulo} para ${r} (usuario ${o}, tamano ${t}).`)}catch(e){console.error(`Error al reservar bloque manual:`,e),b(e.message||`No se pudo reservar el bloque manualmente.`)}S(!1)},L=(e,t,n)=>{let r=tn(s[e]);return(0,q.jsxs)(`div`,{className:`configuracion-campo`,children:[(0,q.jsx)(`label`,{htmlFor:e,children:t}),(0,q.jsxs)(`div`,{className:`configuracion-input-row`,children:[(0,q.jsx)(`div`,{className:`configuracion-prefijo`,children:n}),(0,q.jsx)(`input`,{id:e,name:e,type:`text`,inputMode:`numeric`,pattern:`[0-9]*`,value:s[e],onChange:M,placeholder:`Ultimo consecutivo reservado`})]}),(0,q.jsxs)(`p`,{className:`configuracion-hint`,children:[`Siguiente valor global reservado: `,(0,q.jsx)(`strong`,{children:`${n}-${(r+1).toString().padStart(6,`0`)}`})]})]},e)},R=e=>{let t=Number(e?.inicio??0),n=Number(e?.fin??0),r=Number(e?.siguiente??0),i=Math.max(n-r+1,0);return{inicio:t,fin:n,siguiente:r,disponibles:i}};return e?o?(0,q.jsxs)(`div`,{className:`configuracion-container`,children:[(0,q.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,q.jsx)(`p`,{className:`configuracion-descripcion`,children:`Los consecutivos globales ahora reservan rangos para bloques por usuario y dispositivo. En la misma PC, cada usuario mantiene su propio bloque y puede operar offline.`}),l?(0,q.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos...`}):(0,q.jsxs)(`form`,{className:`configuracion-form`,onSubmit:N,children:[(0,q.jsxs)(`div`,{className:`configuracion-grid`,children:[L(`ventas`,`Factura de venta a proveedor`,`FAV`),L(`ventasMenores`,`Factura de venta menor`,`FAVMI`),L(`compras`,`Factura de compra`,`FAC`),L(`gastos`,`Comprobante de gasto`,`GAS`),L(`remisiones`,`Remisiones`,`REM`)]}),(0,q.jsx)(`button`,{type:`submit`,className:`configuracion-boton`,disabled:d,children:d?`Guardando...`:`Actualizar consecutivos globales`}),p&&(0,q.jsx)(`p`,{className:`configuracion-estado`,children:p})]}),(0,q.jsx)(`hr`,{style:{margin:`24px 0`}}),(0,q.jsxs)(`section`,{children:[(0,q.jsx)(`h2`,{children:`Bloques por dispositivo`}),(0,q.jsxs)(`p`,{children:[`Dispositivo actual: `,(0,q.jsx)(`strong`,{children:r}),` (`,n,`)`]}),(0,q.jsxs)(`form`,{onSubmit:I,style:{display:`grid`,gap:`8px`,maxWidth:`720px`},children:[(0,q.jsx)(`label`,{htmlFor:`bloqueDeviceAlias`,children:`Alias del dispositivo`}),(0,q.jsx)(`input`,{id:`bloqueDeviceAlias`,name:`deviceAlias`,type:`text`,value:D.deviceAlias,onChange:P,placeholder:`Ej: CAJA PRINCIPAL`}),(0,q.jsx)(`label`,{htmlFor:`bloqueDeviceId`,children:`Device ID`}),(0,q.jsx)(`input`,{id:`bloqueDeviceId`,name:`deviceId`,type:`text`,value:D.deviceId,onChange:P,placeholder:`ID del dispositivo destino`}),(0,q.jsx)(`label`,{htmlFor:`bloqueOwnerUid`,children:`Usuario propietario`}),(0,q.jsxs)(`select`,{id:`bloqueOwnerUid`,name:`ownerUid`,value:D.ownerUid,onChange:P,children:[(0,q.jsx)(`option`,{value:``,children:T?`Cargando usuarios...`:`-- Selecciona un usuario --`}),C.map(e=>(0,q.jsx)(`option`,{value:e.id,children:e.nombre||e.email||e.id},e.id))]}),(0,q.jsx)(`label`,{htmlFor:`bloqueModulo`,children:`Modulo`}),(0,q.jsx)(`select`,{id:`bloqueModulo`,name:`modulo`,value:D.modulo,onChange:P,children:A.map(e=>(0,q.jsx)(`option`,{value:e,children:e},e))}),(0,q.jsx)(`label`,{htmlFor:`bloqueTamano`,children:`Tamano del bloque`}),(0,q.jsx)(`input`,{id:`bloqueTamano`,name:`tamano`,type:`text`,inputMode:`numeric`,value:D.tamano,onChange:P}),(0,q.jsxs)(`div`,{style:{display:`flex`,gap:`8px`,flexWrap:`wrap`},children:[(0,q.jsx)(`button`,{type:`button`,onClick:F,disabled:x,children:x?`Reservando...`:`Reservar para este dispositivo`}),(0,q.jsx)(`button`,{type:`submit`,disabled:x,children:x?`Reservando...`:`Reservar/Reasignar manualmente`})]})]}),y&&(0,q.jsx)(`p`,{className:`configuracion-estado`,children:y}),_?(0,q.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando bloques...`}):(0,q.jsx)(`div`,{style:{overflowX:`auto`,marginTop:`12px`},children:(0,q.jsxs)(`table`,{className:`configuracion-tabla-bloques`,style:{width:`100%`,borderCollapse:`collapse`},children:[(0,q.jsx)(`thead`,{children:(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`th`,{children:`Modulo`}),(0,q.jsx)(`th`,{children:`Alias`}),(0,q.jsx)(`th`,{children:`Device ID`}),(0,q.jsx)(`th`,{children:`Usuario propietario`}),(0,q.jsx)(`th`,{children:`Inicio`}),(0,q.jsx)(`th`,{children:`Fin`}),(0,q.jsx)(`th`,{children:`Siguiente`}),(0,q.jsx)(`th`,{children:`Disponibles`}),(0,q.jsx)(`th`,{children:`Tamano`}),(0,q.jsx)(`th`,{children:`Asignado por`})]})}),(0,q.jsx)(`tbody`,{children:h.length===0?(0,q.jsx)(`tr`,{children:(0,q.jsx)(`td`,{colSpan:`10`,style:{textAlign:`center`},children:`No hay bloques asignados.`})}):h.map(e=>{let t=R(e);return(0,q.jsxs)(`tr`,{children:[(0,q.jsx)(`td`,{children:e.modulo||`N/A`}),(0,q.jsx)(`td`,{children:e.deviceAlias||`N/A`}),(0,q.jsx)(`td`,{children:e.deviceId||`N/A`}),(0,q.jsx)(`td`,{children:j[e.ownerUid]?`${j[e.ownerUid].nombre||j[e.ownerUid].email||e.ownerUid} (${e.ownerUid})`:e.ownerUid||`N/A`}),(0,q.jsx)(`td`,{children:t.inicio}),(0,q.jsx)(`td`,{children:t.fin}),(0,q.jsx)(`td`,{children:t.siguiente}),(0,q.jsx)(`td`,{children:t.disponibles}),(0,q.jsx)(`td`,{children:e.tamano||`-`}),(0,q.jsx)(`td`,{children:e.asignadoPor||`SISTEMA`})]},e.id)})})]})})]})]}):(0,q.jsxs)(`div`,{className:`configuracion-container`,children:[(0,q.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,q.jsx)(`p`,{className:`configuracion-alerta`,children:`Solo los administradores pueden gestionar consecutivos y bloques.`})]}):(0,q.jsxs)(`div`,{className:`configuracion-container`,children:[(0,q.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,q.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos de usuario...`})]})}var an=rn;function on(){return(0,q.jsxs)(f,{children:[(0,q.jsxs)(v,{element:(0,q.jsx)(g,{}),children:[(0,q.jsx)(v,{path:`/login`,element:(0,q.jsx)(Mt,{})}),(0,q.jsx)(v,{path:`/imprimir`,element:(0,q.jsx)($t,{})})]}),(0,q.jsxs)(v,{element:(0,q.jsx)(qe,{}),children:[(0,q.jsx)(v,{path:`/`,element:(0,q.jsx)(Xe,{})}),(0,q.jsx)(v,{path:`/articulos`,element:(0,q.jsx)(tt,{})}),(0,q.jsx)(v,{path:`/proveedores`,element:(0,q.jsx)(rt,{})}),(0,q.jsx)(v,{path:`/compras`,element:(0,q.jsx)(ft,{})}),(0,q.jsx)(v,{path:`/ventas`,element:(0,q.jsx)(gt,{})}),(0,q.jsx)(v,{path:`/gastos`,element:(0,q.jsx)(bt,{})}),(0,q.jsx)(v,{path:`/reportes`,element:(0,q.jsx)(Dt,{})}),(0,q.jsx)(v,{path:`/ventas-menores`,element:(0,q.jsx)(It,{})}),(0,q.jsx)(v,{path:`/usuarios`,element:(0,q.jsx)(Rt,{})}),(0,q.jsx)(v,{path:`/remisiones`,element:(0,q.jsx)(Wt,{})}),(0,q.jsx)(v,{path:`/configuracion`,element:(0,q.jsx)(an,{})})]})]})}var sn=on;const cn=typeof window<`u`&&(`__TAURI__`in window||`__TAURI_INTERNALS__`in window);var ln=`/NASASHE-S.A.S/`,un=ln.startsWith(`/`)&&ln!==`/`?ln.replace(/\/$/,``):void 0,dn=cn?_:h,fn=cn?{}:{basename:un};ce.createRoot(document.getElementById(`root`)).render((0,q.jsx)(W.StrictMode,{children:(0,q.jsx)(ze,{children:(0,q.jsx)(dn,{...fn,children:(0,q.jsx)(sn,{})})})}));