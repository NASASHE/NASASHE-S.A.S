import{r as e}from"./rolldown-runtime-D7zIpOPY.js";import{a as t,c as n,i as r,l as i,n as a,o,r as s,s as c,t as l,u}from"./charts-tT8kpEU2.js";import{a as d,c as f,i as p,l as m,n as h,o as g,r as _,s as v,t as y,u as b}from"./react-BoJ992QI.js";import{i as x,n as S,t as C}from"./pdf-tools-Del8CS1J.js";import{C as w,E as T,S as E,T as D,_ as O,a as k,b as A,c as j,d as M,f as ee,g as N,h as te,i as P,l as ne,m as F,n as I,o as re,p as ie,r as L,s as R,t as z,u as B,v as ae,w as oe,x as se,y as V}from"./firebase-CqgYKuLb.js";import{Ft as ce,Pt as le}from"./vendor-CD5nJpVy.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var ue=e(b()),H=e(u()),U=`/NASASHE-S.A.S/`,de=U.endsWith(`/`)?U:`${U}/`,W=de.replace(/^\/+|\/+$/g,``),fe=/^(?:[a-z]+:|\/\/)/i;const G=(e=``)=>{if(!e)return``;if(fe.test(e))return e;let t=e.replace(/^\/+/,``);return`${de}${t}`},pe=(e=``)=>{if(!e)return``;if(fe.test(e))return e;let t=e.replace(/^\/+/,``);return W&&t.startsWith(`${W}/`)?t.slice(W.length+1):t};var K=e(i());function me({texto:e,icono:t,to:n}){return(0,K.jsxs)(p,{to:n,className:`header-button`,children:[(0,K.jsx)(`img`,{src:G(t),alt:e,className:`header-button-icon`}),(0,K.jsx)(`span`,{children:e})]})}var q=me,he=T({apiKey:`AIzaSyBsAP-bhieVtVkPglMBsf5lben2JuUEcf0`,authDomain:`nasashe-chatarreria.firebaseapp.com`,projectId:`nasashe-chatarreria`,storageBucket:`nasashe-chatarreria.firebasestorage.app`,messagingSenderId:`401122117055`,appId:`1:401122117055:web:0b48451b9b4d5291cacd0a`});const J=ne(he,{localCache:ee({tabManager:ie()})}),ge=E(he);console.log(`¬°Persistencia local activada con el m√©todo moderno! üöÄ`);const _e=[`configuracion`,`consecutivos`],Y={compras:{campo:`compras`,prefijo:`FAC`,pad:5,separador:``},ventas:{campo:`ventas`,prefijo:`FAV`,pad:5,separador:``},gastos:{campo:`gastos`,prefijo:`GAS`,pad:5,separador:``},ventasMenores:{campo:`ventasMenores`,prefijo:`FAVMI`,pad:5,separador:``},remisiones:{campo:`remisiones`,prefijo:`REM`,pad:6,separador:`-`}};var ve=`nasashe_device_id`,ye=()=>typeof crypto<`u`&&crypto.randomUUID?crypto.randomUUID():`dev-${Date.now()}-${Math.random().toString(16).slice(2,10)}`;const be=()=>{if(typeof window>`u`)return`server-device`;let e=localStorage.getItem(ve);if(e)return e;let t=ye();return localStorage.setItem(ve,t),t},xe=(e,t)=>`${t}__${e}`,Se=(e,t)=>k(J,`consecutivo_bloques`,xe(e,t));var Ce=()=>k(J,..._e),we=e=>{let t=Number(e);return Number.isFinite(t)?t:0};const Te=(e,t)=>{let n=Y[e];if(!n)throw Error(`Modulo de consecutivo no soportado: ${e}`);let r=String(t).padStart(n.pad,`0`),i=n.separador||``;return`${n.prefijo}${i}${r}`},Ee=async({deviceId:e,modulo:t,blockSize:n=100,actor:r=`SISTEMA`,ownerUid:i})=>{let a=Y[t];if(!a)throw Error(`Modulo de consecutivo no soportado: ${t}`);if(!i||typeof i!=`string`)throw Error(`No se pudo identificar el propietario del bloque (ownerUid).`);let o=Math.max(1,we(n)||100),s=Ce(),c=Se(e,t);return te(J,async n=>{let l=await n.get(s);if(!l.exists())throw Error(`No se encontro el documento 'configuracion/consecutivos'.`);let u=l.data(),d=we(u?.[a.campo]),f=d+1,p=d+o;return n.update(s,{[a.campo]:p}),n.set(c,{deviceId:e,ownerUid:i,modulo:t,inicio:f,fin:p,siguiente:f,tamano:o,actualizadoEn:z.now(),reservadoEn:z.now(),asignadoPor:r},{merge:!0}),{inicio:f,fin:p,siguiente:f,tamano:o,bloqueRef:c}})};var De=(0,H.createContext)(),Oe=L(J,`movimientos_caja`),ke=k(J,`configuracion`,`consecutivos`),Ae=()=>typeof window>`u`?!0:navigator.onLine,je=()=>sessionStorage.getItem(`baseEstablecida`)===`true`,Me=e=>{let t=Number(e);return Number.isFinite(t)?t:0},Ne=e=>{let t=0;return e.forEach(e=>{let n=e.data();if(n?.anulado===!0)return;let r=Me(n?.monto);if(n?.tipo===`ingreso`){t+=Math.abs(r);return}if(n?.tipo===`egreso`){t-=Math.abs(r);return}n?.tipo===`ajuste`&&(t+=r)}),t};function Pe({children:e}){let[t,n]=(0,H.useState)(0),[r,i]=(0,H.useState)(0),[a,o]=(0,H.useState)(0),[s,c]=(0,H.useState)({}),[l,u]=(0,H.useState)({}),[d]=(0,H.useState)(be),[f,p]=(0,H.useState)(je),[m,h]=(0,H.useState)(null),[g,_]=(0,H.useState)(!0),[v,y]=(0,H.useState)(null),[b,x]=(0,H.useState)(Ae),[S,C]=(0,H.useState)(!1);(0,H.useEffect)(()=>{let e=()=>{},t=()=>{},r=[],a=()=>{r.forEach(e=>e()),r=[]},s=w(ge,async s=>{if(h(s),e(),t(),a(),s)try{let a=k(J,`usuarios`,s.uid),l=await re(a);l.exists()?y(l.data()):(console.error(`No se encontro el perfil de usuario en Firestore.`),y(null)),e=B(Oe,e=>{let t=Ne(e);i(t),je()&&n(t)},e=>{console.error(`Error al escuchar movimientos de caja: `,e)}),t=B(ke,e=>{if(e.exists()){let t=e.data();o(t.compras??0),c(t)}else alert(`Error de configuracion: no se encontro el documento 'consecutivos'.`)},e=>{console.error(`Error al escuchar consecutivos: `,e)}),r=Object.keys(Y).map(e=>B(Se(d,e),t=>{u(n=>({...n,[e]:t.exists()?t.data():null}))},t=>{console.error(`Error al escuchar bloque de consecutivo (${e}): `,t)}))}catch(e){console.error(`Error al cargar datos iniciales: `,e)}else n(0),i(0),p(!1),y(null),u({}),sessionStorage.removeItem(`baseEstablecida`);_(!1)});return()=>{s(),e(),t(),a()}},[d]),(0,H.useEffect)(()=>{if(typeof window>`u`)return;let e=async()=>{if(navigator.onLine){C(!0);try{await ae(J)}catch(e){console.error(`No se pudo confirmar la sincronizacion offline:`,e)}finally{C(!1)}}},t=()=>{x(!0),e()},n=()=>{x(!1),C(!1)};return window.addEventListener(`online`,t),window.addEventListener(`offline`,n),navigator.onLine&&e(),()=>{window.removeEventListener(`online`,t),window.removeEventListener(`offline`,n)}},[]);let T=()=>v?.nombre||m?.displayName||m?.email||`SISTEMA`,E=e=>{let t=l?.[e];if(!t)return null;let n=Number(t.inicio),r=Number(t.fin),i=Number(t.siguiente);return!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(i)?null:{...t,inicio:n,fin:r,siguiente:i}},D=async({modulo:e,targetDeviceId:t=d,targetOwnerUid:n=m?.uid,blockSize:r=100})=>{if(!Y[e])throw Error(`Modulo no soportado para consecutivos: ${e}`);if(!b)throw Error(`Sin internet para reservar un nuevo bloque de consecutivos.`);if(!n)throw Error(`No hay un usuario autenticado para reservar bloque.`);let i=await Ee({deviceId:t,ownerUid:n,modulo:e,blockSize:r,actor:T()});return t===d&&u(r=>({...r,[e]:{...r?.[e]||{},inicio:i.inicio,fin:i.fin,siguiente:i.siguiente,tamano:i.tamano,deviceId:t,ownerUid:n,modulo:e}})),i},A=async e=>{if(!Y[e])throw Error(`Modulo no soportado para consecutivos: ${e}`);let t=m?.uid;if(!t)throw Error(`No hay usuario autenticado para generar consecutivos.`);let n=E(e);if(!n||n.ownerUid!==t||n.siguiente>n.fin){let r=await D({modulo:e,targetOwnerUid:t});n={inicio:r.inicio,fin:r.fin,siguiente:r.siguiente,ownerUid:t}}if(!n||n.siguiente>n.fin)throw Error(`No hay consecutivos disponibles para este modulo.`);let r=n.siguiente;return{numero:r,consecutivo:Te(e,r),bloqueRef:Se(d,e)}},j=async({tipo:e,monto:t,descripcion:n=``,referencia:r=null})=>{let i=Number(t);if(!Number.isFinite(i))throw Error(`El monto del movimiento no es valido.`);if((e===`ingreso`||e===`egreso`)&&i<=0)throw Error(`El monto debe ser mayor que cero.`);if(e===`ajuste`&&i===0)throw Error(`El ajuste no puede ser cero.`);let a={tipo:e,monto:e===`ajuste`?i:Math.abs(i),descripcion:n.trim(),fecha:z.now(),usuario:T(),anulado:!1};r?.coleccion&&r?.id&&(a.referencia=r),await I(Oe,a)},M={base:t,baseGuardada:r,baseEstablecida:f,establecerBase:async(e,t={})=>{let{registrarMovimiento:i=!0}=t,a=Number(e);if(!Number.isFinite(a)||a<0){alert(`Ingresa un monto valido de base.`);return}try{if(i){let e=a-r;e!==0&&await j({tipo:`ajuste`,monto:e,descripcion:`Ajuste manual de base de caja`})}n(a),p(!0),sessionStorage.setItem(`baseEstablecida`,`true`)}catch(e){console.error(`Error al establecer la base:`,e),alert(`No se pudo establecer la base: ${e.message}`)}},restarDeLaBase:async(e,n=`Salida manual de caja`)=>{let r=Number(e);if(!Number.isFinite(r)||r<=0){alert(`El monto a restar debe ser mayor que cero.`);return}if(r>t){alert(`El monto a restar supera la base actual.`);return}try{await j({tipo:`egreso`,monto:r,descripcion:n})}catch(e){console.error(`Error al restar de la base:`,e),alert(`No se pudo restar de la base: ${e.message}`)}},sumarALaBase:async(e,t=`Ingreso manual de caja`)=>{let n=Number(e);if(!Number.isFinite(n)||n<=0){alert(`El monto a agregar debe ser mayor que cero.`);return}try{await j({tipo:`ingreso`,monto:n,descripcion:t})}catch(e){console.error(`Error al sumar a la base:`,e),alert(`No se pudo agregar a la base: ${e.message}`)}},registrarMovimientoCaja:j,anularMovimientoCaja:async(e,t=``)=>{if(!e)throw Error(`Debe indicar el ID del movimiento a anular.`);let n=k(J,`movimientos_caja`,e);await O(n,{anulado:!0,motivoAnulacion:t.trim()||`Sin motivo`,fechaAnulacion:z.now(),usuarioAnulacion:T()})},currentUser:m,loadingAuth:g,userProfile:v,setBase:n,consecutivos:a,consecutivosData:s,bloquesConsecutivos:l,deviceId:d,obtenerConsecutivoParaModulo:A,reservarBloqueParaModulo:D,isOnline:b,isSyncing:S};return g?null:(0,K.jsx)(De.Provider,{value:M,children:e})}function X(){let e=(0,H.useContext)(De);if(!e)throw Error(`useCaja debe ser usado dentro de un CajaProvider`);return e}function Fe(){let{userProfile:e}=X(),t=e?.rol===`admin`;return(0,K.jsxs)(`header`,{className:`header-principal`,children:[(0,K.jsxs)(p,{to:`/`,className:`header-logo-link`,children:[(0,K.jsx)(`img`,{src:G(`/logo.png`),alt:`Logo Nasashe`,className:`header-logo-img`}),(0,K.jsxs)(`div`,{className:`header-logo`,children:[`NASASHE`,(0,K.jsx)(`span`,{children:`CHATARRERIA`})]})]}),(0,K.jsxs)(`nav`,{className:`header-nav`,children:[t&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(q,{texto:`Art√≠culos`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,K.jsx)(q,{texto:`Proveedores`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,K.jsx)(q,{texto:`Ventas`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,K.jsx)(q,{texto:`Remisiones`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,K.jsx)(q,{texto:`Usuarios`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,K.jsx)(q,{texto:`Configuraci√≥n`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,K.jsx)(q,{texto:`Reportes`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,K.jsx)(q,{texto:`Compras`,icono:`/icons/Compras.png`,to:`/compras`}),(0,K.jsx)(q,{texto:`Gastos`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,K.jsx)(q,{texto:`Venta Menor`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var Ie=Fe;function Le(){let{base:e,userProfile:t,sumarALaBase:n}=X(),r=new Date().toLocaleDateString(),i=e<3e5,a=async()=>{if(window.confirm(`¬øEst√°s seguro de que deseas cerrar sesi√≥n?`))try{await D(ge)}catch(e){console.error(`Error al cerrar sesi√≥n: `,e),alert(`Error al cerrar sesi√≥n.`)}},o=t?t.nombre:`Cargando...`;return(0,K.jsxs)(`footer`,{className:`footer-principal`,children:[(0,K.jsxs)(`div`,{className:`footer-user`,children:[`Usuario: **`,o,`** |`,(0,K.jsx)(`a`,{href:`#`,onClick:a,style:{color:`black`,marginLeft:`40px`,textDecoration:`underline`,cursor:`pointer`},children:`Salir`})]}),(0,K.jsxs)(`div`,{className:`footer-base`,children:[(0,K.jsxs)(`div`,{className:`base-valor`,children:[`Base en Caja: $`,e.toLocaleString(`es-CO`)]}),i&&(0,K.jsx)(`div`,{className:`base-alerta`,children:`‚ö†Ô∏è Base por debajo de $300.000. Agrega m√°s base.`})]}),(0,K.jsxs)(`div`,{className:`footer-actions`,children:[(0,K.jsx)(`button`,{type:`button`,className:`btn-agregar-base`,onClick:async()=>{let e=window.prompt(`¬øCu√°nto deseas agregar a la base?`,`0`);if(e===null)return;let t=e.replace(/[^0-9.,-]/g,``).replace(`,`,`.`),r=Number(t);if(Number.isNaN(r)||r<=0){alert(`Ingresa un monto v√°lido mayor que cero.`);return}let i=window.prompt(`Descripci√≥n del ingreso manual:`,`Ingreso manual de caja`)||`Ingreso manual de caja`;await n(r,i)},children:`A√±adir base`}),(0,K.jsx)(`div`,{className:`footer-fecha`,children:r})]})]})}var Re=Le;function ze({baseAnterior:e,onContinuar:t,onNuevaBase:n}){let[r,i]=(0,H.useState)(!1),[a,o]=(0,H.useState)(``);return(0,K.jsx)(`div`,{className:`modal-overlay`,children:(0,K.jsxs)(`div`,{className:`modal-content`,children:[(0,K.jsx)(`h2`,{children:`Bienvenido`}),(0,K.jsx)(`p`,{children:`¬øDesea continuar con la base en caja anterior?`}),(0,K.jsxs)(`div`,{className:`base-anterior`,children:[`$`,e.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`div`,{className:`modal-actions`,children:[(0,K.jsx)(`button`,{className:`btn-continuar`,onClick:()=>t(e),children:`S√≠, continuar`}),(0,K.jsx)(`button`,{className:`btn-nueva`,onClick:()=>i(!0),children:`No, ingresar nueva base`})]}),r&&(0,K.jsxs)(`form`,{onSubmit:e=>{e.preventDefault();let t=Number(a);t>0?n(t):alert(`Por favor, ingrese un monto v√°lido.`)},className:`nueva-base-form`,children:[(0,K.jsx)(`label`,{htmlFor:`nuevaBase`,children:`Monto de la nueva base:`}),(0,K.jsx)(`input`,{id:`nuevaBase`,type:`number`,placeholder:`0`,value:a,onChange:e=>o(e.target.value),autoFocus:!0}),(0,K.jsx)(`button`,{type:`submit`,className:`btn-continuar`,children:`Guardar Nueva Base`})]})]})})}var Be=ze;function Ve(){let{currentUser:e,baseEstablecida:t,baseGuardada:n,establecerBase:r,isOnline:i,isSyncing:a}=X();return e?e&&!t?(0,K.jsx)(Be,{baseAnterior:n,onContinuar:e=>r(e,{registrarMovimiento:!1}),onNuevaBase:e=>r(e,{registrarMovimiento:!0})}):(0,K.jsxs)(`div`,{className:`app-container`,children:[(0,K.jsx)(Ie,{}),(0,K.jsx)(`div`,{style:{padding:`8px 12px`,fontSize:`14px`,fontWeight:600,textAlign:`center`,color:`#fff`,backgroundColor:i?`#2f855a`:`#c53030`},children:i?a?`Conectado. Sincronizando cambios pendientes...`:`Conectado.`:`Sin internet. Trabajando en modo offline; se sincronizara al reconectar.`}),(0,K.jsx)(`main`,{className:`main-content`,children:(0,K.jsx)(g,{})}),(0,K.jsx)(Re,{})]}):(0,K.jsx)(d,{to:`/login`,replace:!0})}var He=Ve;function Ue({titulo:e,descripcion:t,icono:n,to:r}){return(0,K.jsxs)(p,{to:r,className:`module-button`,children:[(0,K.jsx)(`img`,{src:G(n),alt:e,className:`module-icon`}),(0,K.jsxs)(`div`,{className:`module-text`,children:[(0,K.jsx)(`h3`,{children:e}),(0,K.jsx)(`p`,{children:t})]})]})}var Z=Ue;function We(){let{userProfile:e}=X(),t=e?.rol===`admin`;return(0,K.jsxs)(`div`,{className:`dashboard-container`,children:[(0,K.jsx)(`h1`,{className:`dashboard-title`,children:`Bienvenido(a) a NASASHE. ¬°Haz clic en alg√∫n m√≥dulo para empezar!`}),(0,K.jsxs)(`div`,{className:`dashboard-grid`,children:[t&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(Z,{titulo:`Art√≠culos`,descripcion:`Gestionar inventario, precios y categor√≠as.`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,K.jsx)(Z,{titulo:`Proveedores`,descripcion:`Administrar lista de proveedores y cuentas.`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,K.jsx)(Z,{titulo:`Ventas`,descripcion:`Crear facturas de venta a proveedores.`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,K.jsx)(Z,{titulo:`Remisiones`,descripcion:`Emitir remisiones y generar PDF firmado.`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,K.jsx)(Z,{titulo:`Usuarios`,descripcion:`Gestionar cuentas de empleados.`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,K.jsx)(Z,{titulo:`Configuraci√≥n`,descripcion:`Restablecer consecutivos y ajustes generales.`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,K.jsx)(Z,{titulo:`Reportes`,descripcion:`Ver res√∫menes de ventas, caja e inventario.`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,K.jsx)(Z,{titulo:`Compras`,descripcion:`Registrar compras a recicladores.`,icono:`/icons/Compras.png`,to:`/compras`}),(0,K.jsx)(Z,{titulo:`Gastos`,descripcion:`Registrar salidas de efectivo (ej. comida).`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,K.jsx)(Z,{titulo:`Venta Menor`,descripcion:`Registrar ventas a particulares (ej. tubos).`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var Ge=We,Ke=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),qe=async()=>{for(let e of[`@tauri-apps/plugin-dialog`,`@tauri-apps/api/dialog`]){let t=await x(()=>import(e),[]).catch(()=>null);if(t?.message)return t.message}return null};async function Q(e,t={}){if(Ke()){let n=await qe();if(n)return n(e,t)}if(t?.title){alert(`${t.title}: ${e}`);return}alert(e)}var Je=`ACERO.jpg,ALUMINIO.jpg,ANTIMONIO.jpg,ARCHIVO.jpg,BATERIA_1_GRUPO.jpg,BATERIA_2_GRUPO.jpg,BATERIA_3_GRUPO.jpg,BATERIA_4_GRUPO.jpg,BATERIA_5_GRUPO.jpg,BATERIA_7_GRUPO.jpg,BATERIA_8_GRUPO.jpg,BATERIA_PEQUE√ëA.jpg,BRONCE.jpg,CANASTA.jpg,CARTON.jpg,COBRE.jpg,COBRE_CABLE.jpg,HIERRO.jpg,OTRO.jpg,PASTA.jpg,PERFIL.jpg,PET.jpg,PLAQUETA_1.jpg,PLAQUETA_2.jpg,PLAQUETA_3.jpg,PLAQUETA_BAJA.jpg,PLAQUETA_CELULAR.jpg,PLAQUETA_DECO.jpg,PLOMO.jpg,POTE.jpg,POTE_DE_ALUMINIO.jpg,RADIADOR_ALUMINIO.jpg,RADIADOR_BRONCE.jpg,RADIADOR_COBRE.jpg,RADIADOR_MIXTO.jpg,SCARP_LIMPIO.jpg,SCARP_SUCIO.jpg,SILLA.jpg,TANQUE.jpg,TANQUE_METALICO.jpg,VOLUMEN_HIERRO.jpg`.split(`,`);function Ye(){let[e,t]=(0,H.useState)(!0),[n,r]=(0,H.useState)([]),[i,a]=(0,H.useState)(``),[o,s]=(0,H.useState)(``),[c,l]=(0,H.useState)(``),[u,d]=(0,H.useState)(``),[f,p]=(0,H.useState)(``),[m,h]=(0,H.useState)(null),[g,_]=(0,H.useState)({nombre:``,precioCompra:``,precioVenta:``,stock:``,imagenUrl:``}),v=async()=>{t(!0);try{let e=(await R(L(J,`articulos`))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,H.useEffect)(()=>{v()},[]);let y=async e=>{e.preventDefault();let t=Number(o),n=Number(c),r=Number(u);if(!i||t<=0||n<=0){await Q(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await I(L(J,`articulos`),{nombre:i.toUpperCase(),precioCompra:t,precioVenta:n,stock:r||0,imagenUrl:pe(f)||``}),a(``),s(``),l(``),d(``),p(``),await v()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},b=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este art√≠culo?`))try{let t=k(J,`articulos`,e);await P(t),await v()}catch(e){console.error(`Error al eliminar el documento: `,e)}},x=e=>{let{name:t,value:n}=e.target,r=n;t===`nombre`?r=n.toUpperCase():(t===`precioCompra`||t===`precioVenta`||t===`stock`)&&(r=n.replace(/[^0-9]/g,``)),_(e=>({...e,[t]:r}))},S=e=>{h(e.id),_({nombre:e.nombre,precioCompra:e.precioCompra,precioVenta:e.precioVenta,stock:e.stock,imagenUrl:pe(e.imagenUrl||``)})},C=()=>{h(null)},w=async e=>{e.preventDefault();let t=k(J,`articulos`,m),n={nombre:g.nombre.toUpperCase(),precioCompra:Number(g.precioCompra),precioVenta:Number(g.precioVenta),stock:Number(g.stock)||0,imagenUrl:pe(g.imagenUrl)||``};if(!n.nombre||n.precioCompra<=0||n.precioVenta<=0){await Q(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await O(t,n),h(null),await v()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,K.jsxs)(`div`,{className:`pagina-articulos`,children:[(0,K.jsx)(`h1`,{children:`M√≥dulo de Art√≠culos`}),(0,K.jsx)(`p`,{children:`Aqu√≠ puedes gestionar tu inventario.`}),(0,K.jsxs)(`div`,{className:`form-container`,children:[(0,K.jsx)(`h2`,{children:`A√±adir Nuevo Art√≠culo`}),(0,K.jsxs)(`form`,{onSubmit:y,children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,K.jsx)(`input`,{id:`nuevoNombre`,type:`text`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoPrecioCompra`,children:`Precio Compra:`}),(0,K.jsx)(`input`,{id:`nuevoPrecioCompra`,type:`text`,value:o,onChange:e=>s(e.target.value.replace(/[^0-9]/g,``))})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoPrecioVenta`,children:`Precio Venta:`}),(0,K.jsx)(`input`,{id:`nuevoPrecioVenta`,type:`text`,value:c,onChange:e=>l(e.target.value.replace(/[^0-9]/g,``))})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoStock`,children:`Stock:`}),(0,K.jsx)(`input`,{id:`nuevoStock`,type:`text`,value:u,onChange:e=>d(e.target.value.replace(/[^0-9]/g,``))})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevaImagenUrl`,children:`Imagen:`}),(0,K.jsxs)(`select`,{id:`nuevaImagenUrl`,value:f,onChange:e=>p(e.target.value),children:[(0,K.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),Je.map(e=>(0,K.jsx)(`option`,{value:`icons/${e}`,children:e},e))]})]}),(0,K.jsx)(`button`,{type:`submit`,children:`Guardar Art√≠culo`})]})]}),(0,K.jsx)(`h2`,{children:`Inventario Actual en Firebase`}),e?(0,K.jsx)(`p`,{children:`Cargando...`}):(0,K.jsxs)(`table`,{className:`articulos-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{className:`articulo-imagen-header`,children:`Imagen`}),(0,K.jsx)(`th`,{children:`Nombre`}),(0,K.jsx)(`th`,{children:`Precio Compra`}),(0,K.jsx)(`th`,{children:`Precio Venta`}),(0,K.jsx)(`th`,{children:`Stock`}),(0,K.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:n.map(e=>(0,K.jsx)(`tr`,{className:m===e.id?`edit-row`:``,children:m===e.id?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`td`,{className:`articulo-imagen-cell`,children:(0,K.jsxs)(`select`,{name:`imagenUrl`,value:g.imagenUrl,onChange:x,children:[(0,K.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),Je.map(e=>(0,K.jsx)(`option`,{value:`icons/${e}`,children:e},e))]})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`nombre`,value:g.nombre,onChange:x})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`precioCompra`,value:g.precioCompra,onChange:x})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`precioVenta`,value:g.precioVenta,onChange:x})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`stock`,value:g.stock,onChange:x})}),(0,K.jsxs)(`td`,{className:`acciones-cell`,children:[(0,K.jsx)(`button`,{onClick:w,className:`btn-guardar`,children:`Guardar`}),(0,K.jsx)(`button`,{type:`button`,onClick:C,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`td`,{className:`articulo-imagen-cell`,children:e.imagenUrl&&(0,K.jsx)(`img`,{src:G(e.imagenUrl),alt:e.nombre})}),(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`td`,{children:[`$`,e.precioVenta.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)}),(0,K.jsxs)(`td`,{className:`acciones-cell`,children:[(0,K.jsx)(`button`,{onClick:()=>S(e),className:`btn-editar`,children:`Editar`}),(0,K.jsx)(`button`,{onClick:()=>b(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var Xe=Ye;function Ze(){let[e,t]=(0,H.useState)(!0),[n,r]=(0,H.useState)([]),[i,a]=(0,H.useState)(``),[o,s]=(0,H.useState)(``),[c,l]=(0,H.useState)(``),[u,d]=(0,H.useState)(``),[f,p]=(0,H.useState)(``),[m,h]=(0,H.useState)(``),[g,_]=(0,H.useState)(null),[v,y]=(0,H.useState)({nombre:``,telefono:``,email:``,nit:``,direccion:``,material:``}),b=async()=>{t(!0);try{let e=(await R(L(J,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,H.useEffect)(()=>{b()},[]);let x=async e=>{if(e.preventDefault(),!i||!u){alert(`Por favor, completa el Nombre y el NIT.`);return}try{await I(L(J,`proveedores`),{nombre:i.toUpperCase(),telefono:o,email:c,nit:u,direccion:f,material:m.toUpperCase()}),a(``),s(``),l(``),d(``),p(``),h(``),await b()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},S=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este proveedor?`))try{let t=k(J,`proveedores`,e);await P(t),await b()}catch(e){console.error(`Error al eliminar el documento: `,e)}},C=e=>{let{name:t,value:n}=e.target,r=n;(t===`nombre`||t===`material`)&&(r=n.toUpperCase()),y(e=>({...e,[t]:r}))},w=e=>{_(e.id),y({nombre:e.nombre,telefono:e.telefono,email:e.email,nit:e.nit,direccion:e.direccion,material:e.material})},T=()=>{_(null)},E=async e=>{e.preventDefault();let t=k(J,`proveedores`,g);if(!v.nombre||!v.nit){alert(`Por favor, completa el Nombre y el NIT.`);return}let n={nombre:v.nombre.toUpperCase(),telefono:v.telefono,email:v.email,nit:v.nit,direccion:v.direccion,material:v.material.toUpperCase()};try{await O(t,n),_(null),await b()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,K.jsxs)(`div`,{className:`pagina-proveedores`,children:[(0,K.jsx)(`h1`,{children:`M√≥dulo de Proveedores`}),(0,K.jsxs)(`div`,{className:`form-container`,children:[(0,K.jsx)(`h2`,{children:`A√±adir Nuevo Proveedor`}),(0,K.jsxs)(`form`,{onSubmit:x,children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,K.jsx)(`input`,{id:`nuevoNombre`,type:`text`,name:`nombre`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoNit`,children:`NIT:`}),(0,K.jsx)(`input`,{id:`nuevoNit`,type:`text`,name:`nit`,value:u,onChange:e=>d(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoTelefono`,children:`Tel√©fono:`}),(0,K.jsx)(`input`,{id:`nuevoTelefono`,type:`text`,name:`telefono`,value:o,onChange:e=>s(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoEmail`,children:`Email:`}),(0,K.jsx)(`input`,{id:`nuevoEmail`,type:`email`,name:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoDireccion`,children:`Direcci√≥n:`}),(0,K.jsx)(`input`,{id:`nuevoDireccion`,type:`text`,name:`direccion`,value:f,onChange:e=>p(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{htmlFor:`nuevoMaterial`,children:`Material:`}),(0,K.jsx)(`input`,{id:`nuevoMaterial`,type:`text`,name:`material`,value:m,onChange:e=>h(e.target.value.toUpperCase())})]}),(0,K.jsx)(`button`,{type:`submit`,children:`Guardar Proveedor`})]})]}),(0,K.jsx)(`h2`,{children:`Lista de Proveedores`}),e?(0,K.jsx)(`p`,{children:`Cargando...`}):(0,K.jsxs)(`table`,{className:`proveedores-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Nombre`}),(0,K.jsx)(`th`,{children:`NIT`}),(0,K.jsx)(`th`,{children:`Tel√©fono`}),(0,K.jsx)(`th`,{children:`Email`}),(0,K.jsx)(`th`,{children:`Direcci√≥n`}),(0,K.jsx)(`th`,{children:`Material`}),(0,K.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:n.map(e=>(0,K.jsx)(`tr`,{className:g===e.id?`edit-row`:``,children:g===e.id?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`nombre`,value:v.nombre,onChange:C})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`nit`,value:v.nit,onChange:C})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`telefono`,value:v.telefono,onChange:C})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`email`,name:`email`,value:v.email,onChange:C})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`direccion`,value:v.direccion,onChange:C})}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`input`,{type:`text`,name:`material`,value:v.material,onChange:C})}),(0,K.jsxs)(`td`,{className:`acciones-cell`,children:[(0,K.jsx)(`button`,{onClick:E,className:`btn-guardar`,children:`Guardar`}),(0,K.jsx)(`button`,{type:`button`,onClick:T,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{children:e.nit}),(0,K.jsx)(`td`,{children:e.telefono}),(0,K.jsx)(`td`,{children:e.email}),(0,K.jsx)(`td`,{children:e.direccion}),(0,K.jsx)(`td`,{children:e.material}),(0,K.jsxs)(`td`,{className:`acciones-cell`,children:[(0,K.jsx)(`button`,{onClick:()=>w(e),className:`btn-editar`,children:`Editar`}),(0,K.jsx)(`button`,{onClick:()=>S(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var Qe=Ze;const $e=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e.reciclador||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE COMPRA`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Compra
`,a+=`Fecha: ${n}\n`,a+=`Facturado por: ${t?.nombre||`SISTEMA`}\n`,a+=`Reciclador: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioCompra.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,a+=i(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,a+=i(`¬° Gracias por su venta !`,45)+`
`,a},et=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.proveedor?.nombre||``).toString().trim()||`N/A`,i=(e?.proveedor?.nit||``).toString().trim()||`N/A`,a=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},o=a(`TICKET DE VENTA`,45)+`
`;return o+=a(`RECICLADORA NASASHE S.A.S`,45)+`
`,o+=a(`901907763-3`,45)+`
`,o+=a(`Calle 98#9B-35`,45)+`
`,o+=a(`Barranquilla - Atlantico`,45)+`
`,o+=a(`605-000-0000`,45)+`
`,o+=`-`.repeat(45)+`
`,o+=`Factura: ${e.consecutivo}\n`,o+=`Actividad: Venta
`,o+=`Fecha: ${n}\n`,o+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,o+=`Cliente: ${r}\n`,o+=`NIT: ${i}\n`,o+=`-`.repeat(45)+`
`,o+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,o+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioVenta.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);o+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),o+=`-`.repeat(45)+`
`,o+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,o+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`-`.repeat(45)+`
`,o+=a(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,o+=a(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,o+=a(`¬° Gracias por su compra !`,45)+`
`,o},tt=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.cliente||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE VENTA MENOR`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Venta Menor
`,a+=`Fecha: ${n}\n`,a+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,a+=`Cliente: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Descripci√≥n`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.descripcion.length>18?e.descripcion.substring(0,18):e.descripcion,n=e.cantidad.toString(),r=e.precio.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`¬° Gracias por su compra !`,45)+`
`,a},nt=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`COMPROBANTE DE SALIDA`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=r(`901907763-3`,45)+`
`,i+=r(`Calle 98#9B-35`,45)+`
`,i+=r(`Barranquilla - Atlantico`,45)+`
`,i+=r(`605-000-0000`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Comprobante: ${e.consecutivo}\n`,i+=`Actividad: Gasto / Egreso
`,i+=`Fecha: ${n}\n`,i+=`Registrado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`

`,i+=`Concepto: ${e.concepto}\n`,i+=`Descripci√≥n: ${e.descripcion}\n\n`,i+=`-`.repeat(45)+`
`,i+=`Total:`.padEnd(10)+`${e.monto.toLocaleString(`es-CO`)}`.padStart(35)+`
`,i+=`-`.repeat(45)+`

`,i+=`__________________________________
`,i+=r(`Firma Autorizado`,34)+`

`,i+=`__________________________________
`,i+=r(`Firma Recibido`,34)+`
`,i},rt=({titulo:e,textoTicket:t})=>{if(typeof window>`u`||typeof document>`u`)return!1;try{let n=document.createElement(`iframe`);n.style.position=`fixed`,n.style.right=`0`,n.style.bottom=`0`,n.style.width=`0`,n.style.height=`0`,n.style.border=`0`,n.style.visibility=`hidden`,n.setAttribute(`aria-hidden`,`true`),n.tabIndex=-1,document.body.appendChild(n);let r=n.contentWindow,i=r?.document;if(!r||!i)return document.body.removeChild(n),!1;let a=!1,o=()=>{n.parentNode&&n.parentNode.removeChild(n)},s=()=>{r.removeEventListener(`afterprint`,s),o()};return n.onload=()=>{r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error al intentar imprimir el ticket en el iframe:`,e),r.removeEventListener(`afterprint`,s),o()}},i.open(),i.write(`<!DOCTYPE html><html><head><title>${e}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${t}</pre></body></html>`),i.close(),setTimeout(()=>{if(!(a||!n.isConnected)){r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error en impresi√≥n de respaldo del ticket:`,e),o()}setTimeout(()=>{!a&&n.isConnected&&o()},1500)}},500),!0}catch(e){return console.error(`No se pudo preparar la impresi√≥n del ticket en el navegador:`,e),!1}};var it=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,at=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function ot(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,H.useState)(!0),[a,o]=(0,H.useState)(!1),[s,c]=(0,H.useState)([]),[l,u]=(0,H.useState)(``),[d,f]=(0,H.useState)(``),[p,m]=(0,H.useState)(``),[h,g]=(0,H.useState)(``),[_,v]=(0,H.useState)(``),[y,b]=(0,H.useState)(``),[x,S]=(0,H.useState)([]),[C,w]=(0,H.useState)(0),[T,E]=(0,H.useState)(null),[D,O]=(0,H.useState)(null);(0,H.useEffect)(()=>{i(!0);let e=L(J,`articulos`),t=B(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));c(t),i(!1),console.log(`¬°Art√≠culos cargados y cacheados con onSnapshot!`)},e=>{console.error(`Error al cargar art√≠culos con onSnapshot: `,e),i(!1)});return()=>{console.log(`Limpiando listener de Art√≠culos.`),t()}},[]),(0,H.useEffect)(()=>{let e=0;x.forEach(t=>{e+=t.subtotal}),w(e)},[x]);let M=e=>{let t=e.target.value;if(f(t),t!==`otros`&&(m(``),g(``)),t===`otros`){b(`/icons/OTRO.jpg`);return}if(t){let e=s.find(e=>e.id===t);e&&e.imagenUrl?b(e.imagenUrl):b(``)}else b(``)},ee=()=>{if(!d||!_||Number(_)<=0){alert(`Seleccione un art√≠culo y una cantidad (peso) v√°lida.`);return}if(d===`otros`){let e=p.trim().toUpperCase(),t=Number(h),n=Number(_);if(!e||!t||t<=0){alert(`Ingrese un nombre y un precio de compra v√°lido para el material.`);return}let r=n*t;S(i=>[...i,{localId:Date.now(),articuloId:null,nombre:e,cantidad:n,precioCompra:t,subtotal:r,esManual:!0}]),f(``),m(``),g(``),v(``),b(``);return}let e=s.find(e=>e.id===d);if(!e){alert(`Error: Art√≠culo no encontrado.`);return}let t=Number(_),n=t*e.precioCompra;x.find(t=>t.articuloId===e.id)?S(r=>r.map(r=>r.articuloId===e.id?{...r,cantidad:r.cantidad+t,subtotal:r.subtotal+n}:r)):S(r=>[...r,{localId:Date.now(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioCompra:e.precioCompra,subtotal:n}]),f(``),v(``),b(``)},N=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&S(x.filter(t=>t.localId!==e))},te=e=>{O(t=>t===e?null:e)},P=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=n*e.precioCompra;return{...e,cantidad:n,subtotal:t}}return e}))},ne=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=e.cantidad*n;return{...e,precioCompra:n,subtotal:t}}return e}))},F=async()=>{if(x.length===0){alert(`No hay art√≠culos en la compra.`);return}o(!0);let r=null;try{let i=t,{consecutivo:a,bloqueRef:o}=await n(`compras`);if(C>i)throw Error(`¬°Error! Fondos insuficientes. Base: $${i.toLocaleString(`es-CO`)}`);let c=l.trim().toUpperCase(),d={consecutivo:a,reciclador:c||`N/A`,items:x,total:C,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};r=d;let f=A(J),p=k(L(J,`compras`)),m=k(L(J,`movimientos_caja`));f.set(p,d),f.update(o,{siguiente:j(1),actualizadoEn:z.now()}),f.set(m,{tipo:`egreso`,monto:C,descripcion:`Compra ${a} - ${c||`N/A`}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`compras`,id:p.id,consecutivo:a}}),x.forEach(e=>{if(e.esManual)return;if(!s.find(t=>t.id===e.articuloId))throw Error(`Art√≠culo ${e.nombre} no encontrado en cach√©.`);let t=k(J,`articulos`,e.articuloId);f.update(t,{stock:j(e.cantidad)})}),await f.commit(),E(r),u(``),S([])}catch(e){console.error(`Error al guardar la compra: `,e),alert(`Error al guardar: ${e.message}`)}o(!1)},I=t=>{let n=$e(t,e);rt({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return r?(0,K.jsx)(`p`,{children:`Cargando Art√≠culos...`}):(0,K.jsxs)(`div`,{className:`pagina-compras`,children:[(0,K.jsx)(`h1`,{children:`Registrar Nueva Compra (a Reciclador)`}),(0,K.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,K.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`layout-compras`,children:[(0,K.jsxs)(`div`,{className:`formulario-compra`,children:[(0,K.jsx)(`h2`,{children:`Datos de la Compra`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`reciclador`,children:`Nombre Reciclador (Opcional):`}),(0,K.jsx)(`input`,{id:`reciclador`,type:`text`,value:l,onChange:e=>u(e.target.value.toUpperCase()),disabled:T})]}),(0,K.jsx)(`hr`,{}),(0,K.jsx)(`h3`,{children:`A√±adir Art√≠culos`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`articulo`,children:`Art√≠culo:`}),(0,K.jsxs)(`select`,{id:`articulo`,value:d,onChange:M,disabled:T,children:[(0,K.jsx)(`option`,{value:``,children:`-- Seleccione un Art√≠culo --`}),(0,K.jsx)(`option`,{value:`otros`,children:`Otros (ingreso manual)`}),s.map(e=>(0,K.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioCompra,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),d===`otros`&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`nombreManual`,children:`Nombre del material:`}),(0,K.jsx)(`input`,{id:`nombreManual`,type:`text`,value:p,onChange:e=>m(e.target.value.toUpperCase()),disabled:T})]}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`precioManual`,children:`Precio compra:`}),(0,K.jsx)(`input`,{id:`precioManual`,type:`number`,value:h,onChange:e=>g(e.target.value),disabled:T})]})]}),(0,K.jsx)(`div`,{className:`imagen-preview-container`,children:y?(0,K.jsx)(`img`,{src:G(y),alt:`Vista previa del material`}):(0,K.jsx)(`span`,{style:{color:`#888`},children:`Imagen del material`})}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,K.jsx)(`input`,{id:`cantidad`,type:`number`,value:_,onChange:e=>v(e.target.value),disabled:T})]}),(0,K.jsx)(`button`,{type:`button`,onClick:ee,className:`btn-anadir-item`,disabled:T,children:`A√±adir Item a la Compra`})]}),(0,K.jsxs)(`div`,{className:`pre-factura`,children:[(0,K.jsx)(`h2`,{children:`Items de la Compra`}),(0,K.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Art√≠culo`}),(0,K.jsx)(`th`,{children:`Cant.`}),(0,K.jsx)(`th`,{children:`Precio`}),(0,K.jsx)(`th`,{children:`Subtotal`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:(T?T.items:x).length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`A√±ade art√≠culos...`})}):(T?T.items:x).map((e,t)=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{children:D===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>P(t,e.localId),autoFocus:!0,style:{width:`70px`,padding:`3px`}}):(Number(e.cantidad)||0).toFixed(2)}),(0,K.jsx)(`td`,{children:D===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.precioCompra,onChange:t=>ne(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioCompra}`}),(0,K.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,K.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>te(e.localId),disabled:T,children:D===e.localId?`Listo`:`Editar`}),(0,K.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>N(e.localId),disabled:T,children:`Anular`})]})]},t))})]}),(0,K.jsxs)(`div`,{className:`total-compra`,children:[`Total: $`,(T?T.total:C).toLocaleString(`es-CO`)]}),(0,K.jsx)(`div`,{className:`botones-accion`,children:T?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`p`,{className:`compra-exitosa`,children:[`¬°Compra `,T.consecutivo,` guardada!`]}),(0,K.jsx)(`button`,{type:`button`,onClick:async()=>{if(T)if(!it())I(T);else{localStorage.setItem(`ticketData`,JSON.stringify(T)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`compra`);let t=`ticket-compra-${T.consecutivo.replace(/\s/g,`-`)}`;new le(t,{url:`/imprimir`,title:`Ticket ${T.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),I(T)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{if(!T)return;let t=$e(T,e);at(t,T.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{S([]),w(0),u(``),E(null),f(``),m(``),g(``),v(``),b(``)},className:`btn-nueva-compra`,children:`Registrar Nueva Compra`})]}):(0,K.jsx)(`button`,{type:`button`,onClick:F,className:`btn-guardar-compra`,disabled:a||x.length===0,children:a?`Guardando...`:`Guardar Compra`})})]})]})]})}var st=ot,ct=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,lt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function ut(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,H.useState)(!0),[a,o]=(0,H.useState)(!1),[s,c]=(0,H.useState)([]),[l,u]=(0,H.useState)([]),[d,f]=(0,H.useState)(``),[p,m]=(0,H.useState)(``),[h,g]=(0,H.useState)(``),[_,v]=(0,H.useState)([]),[y,b]=(0,H.useState)(0),[x,S]=(0,H.useState)(null),[C,w]=(0,H.useState)(null),T=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,E=async()=>{i(!0);try{let e=(await R(L(J,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));c(e);let t=(await R(L(J,`articulos`))).docs.map(e=>({id:e.id,...e.data()}));u(t)}catch(e){console.error(`Error al cargar datos: `,e)}i(!1)};(0,H.useEffect)(()=>{E()},[]),(0,H.useEffect)(()=>{let e=0;_.forEach(t=>{e+=t.subtotal}),b(e)},[_]);let D=()=>{if(!p||!h||Number(h)<=0){alert(`Seleccione un art√É¬≠culo y una cantidad (peso) v√É¬°lida.`);return}let e=l.find(e=>e.id===p);if(!e){alert(`Error: Art√É¬≠culo no encontrado.`);return}let t=Number(h),n=e.stock||0,r=_.find(t=>t.articuloId===e.id),i=r?r.cantidad:0;if(t+i>n){alert(`√Ç¬°No hay stock suficiente! Stock actual: ${n}, Quieres vender: ${t+i}`);return}let a=t*e.precioVenta;v(r?n=>n.map(n=>n.articuloId===e.id?{...n,cantidad:n.cantidad+t,subtotal:n.subtotal+a}:n):n=>[...n,{localId:T(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioVenta:e.precioVenta,subtotal:a}]),m(``),g(``)},O=e=>{window.confirm(`√Ç¬øDesea eliminar este item de la prefactura?`)&&(v(t=>t.filter(t=>t.localId!==e)),w(t=>t===e?null:t))},M=e=>{w(t=>t===e?null:e)},ee=(e,t)=>{let n=Number(e.target.value);n<=0||v(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precioVenta}:e))},N=(e,t)=>{let n=Number(e.target.value);n<=0||v(e=>e.map(e=>e.localId===t?{...e,precioVenta:n,subtotal:n*e.cantidad}:e))},te=async()=>{if(_.length===0){alert(`No hay art√É¬≠culos en la venta.`);return}if(!d){alert(`Debe seleccionar un Proveedor (Cliente de Venta).`);return}o(!0);let t=null;try{let r=k(L(J,`ventas`)),i=s.find(e=>e.id===d),{consecutivo:a,bloqueRef:o}=await n(`ventas`),c={consecutivo:a,proveedor:{id:i.id,nombre:i.nombre,nit:i.nit},items:_,total:y,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};t=c,_.forEach(e=>{let t=l.find(t=>t.id===e.articuloId);if(!t)throw Error(`Articulo ${e.nombre} no encontrado en cache.`);let n=Number(t.stock)||0;if(e.cantidad>n)throw Error(`Stock insuficiente para ${e.nombre}`)});let u=A(J);u.set(r,c),u.update(o,{siguiente:j(1),actualizadoEn:z.now()}),_.forEach(e=>{let t=k(J,`articulos`,e.articuloId);u.update(t,{stock:j(-e.cantidad)})}),await u.commit(),await E(),S(t),f(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}o(!1)},P=t=>{let n=et(t,e);rt({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√É¬≥n del ticket en el navegador. Verifica la configuraci√É¬≥n de impresi√É¬≥n e int√É¬©ntalo nuevamente.`)};return r?(0,K.jsx)(`p`,{children:`Cargando datos maestros...`}):(0,K.jsxs)(`div`,{className:`pagina-ventas`,children:[(0,K.jsx)(`h1`,{children:`Registrar Nueva Venta (a Proveedor)`}),(0,K.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,K.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`layout-ventas`,children:[(0,K.jsxs)(`div`,{className:`formulario-venta`,children:[(0,K.jsx)(`h2`,{children:`Datos de la Venta`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`proveedor`,children:`Cliente (Proveedor al que Vendes):`}),(0,K.jsxs)(`select`,{id:`proveedor`,value:d,onChange:e=>f(e.target.value),disabled:x,children:[(0,K.jsx)(`option`,{value:``,children:`-- Seleccione un Cliente --`}),s.map(e=>(0,K.jsxs)(`option`,{value:e.id,children:[e.nombre,` (`,e.nit,`)`]},e.id))]})]}),(0,K.jsx)(`hr`,{}),(0,K.jsx)(`h3`,{children:`A√É¬±adir Art√É¬≠culos`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`articulo`,children:`Art√É¬≠culo:`}),(0,K.jsxs)(`select`,{id:`articulo`,value:p,onChange:e=>m(e.target.value),disabled:x,children:[(0,K.jsx)(`option`,{value:``,children:`-- Seleccione un Art√É¬≠culo --`}),l.map(e=>(0,K.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioVenta,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,K.jsx)(`input`,{id:`cantidad`,type:`number`,value:h,onChange:e=>g(e.target.value),disabled:x})]}),(0,K.jsx)(`button`,{type:`button`,onClick:D,className:`btn-anadir-item-venta`,disabled:x,children:`A√É¬±adir Item a la Venta`})]}),(0,K.jsxs)(`div`,{className:`pre-factura`,children:[(0,K.jsx)(`h2`,{children:`Items de la Venta`}),(0,K.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Art√É¬≠culo`}),(0,K.jsx)(`th`,{children:`Cant.`}),(0,K.jsx)(`th`,{children:`Precio Venta`}),(0,K.jsx)(`th`,{children:`Subtotal`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:(x?x.items:_).length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√É¬±ade art√É¬≠culos...`})}):(x?x.items:_).map((e,t)=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{children:C===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>ee(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,K.jsx)(`td`,{children:C===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.precioVenta,onChange:t=>N(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioVenta}`}),(0,K.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,K.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>M(e.localId),disabled:x,children:C===e.localId?`Listo`:`Editar`}),(0,K.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>O(e.localId),disabled:x,children:`Anular`})]})]},e.localId||t))})]}),(0,K.jsxs)(`div`,{className:`total-venta`,children:[`Total: $`,(x?x.total:y).toLocaleString(`es-CO`)]}),(0,K.jsx)(`div`,{className:`botones-accion`,children:x?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`p`,{className:`venta-exitosa`,children:[`√Ç¬°Venta `,x.consecutivo,` guardada!`]}),(0,K.jsx)(`button`,{type:`button`,onClick:async()=>{if(x)if(!ct())P(x);else{localStorage.setItem(`ticketData`,JSON.stringify(x)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`venta`);let t=`ticket-venta-${x.consecutivo.replace(/\s/g,`-`)}`;new le(t,{url:`/imprimir`,title:`Ticket ${x.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√É¬≥n:`,e),P(x)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{if(!x||ct())return;let t=et(x,e);lt(t,x.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{v([]),b(0),f(``),S(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,K.jsx)(`button`,{type:`button`,onClick:te,className:`btn-guardar-venta`,disabled:a||_.length===0,children:a?`Guardando...`:`Guardar Venta`})})]})]})]})}var dt=ut,ft=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,pt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function mt(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,H.useState)(!1),[a,o]=(0,H.useState)(``),[s,c]=(0,H.useState)(``),[l,u]=(0,H.useState)(null),d=async()=>{let r=Number(s),l=a.trim();if(!l||r<=0){alert(`Debe ingresar una descripci√≥n y un monto v√°lido.`);return}if(r>t){alert(`Error: el monto del gasto no puede superar la base en caja.`);return}i(!0);try{let t=k(L(J,`gastos`)),i=null,{consecutivo:a,bloqueRef:s}=await n(`gastos`),d={consecutivo:a,descripcion:l,monto:r,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};i=d;let f=A(J),p=k(L(J,`movimientos_caja`));f.set(t,d),f.update(s,{siguiente:j(1),actualizadoEn:z.now()}),f.set(p,{tipo:`egreso`,monto:r,descripcion:`Gasto ${a} - ${l}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`gastos`,id:t.id,consecutivo:a}}),await f.commit(),u(i),o(``),c(``)}catch(e){console.error(`Error al guardar el gasto: `,e),alert(`Error al guardar: ${e.message}`)}i(!1)},f=t=>{let n=nt(t,e);rt({titulo:`Comprobante ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del comprobante en el navegador.`)},p=async()=>{if(l)if(!ft())f(l),h();else{localStorage.setItem(`ticketData`,JSON.stringify(l)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`gasto`);let t=`ticket-gasto-${l.consecutivo.replace(/\s/g,`-`)}`,n=new le(t,{url:`/imprimir`,title:`Comprobante ${l.consecutivo}`,width:310,height:600});n.once(`tauri://created`,()=>{m()}),n.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),f(l),h()})}},m=()=>{l&&h()},h=()=>{if(l&&!ft()){let t=nt(l,e);pt(t,l.consecutivo)}o(``),c(``),u(null)};return(0,K.jsxs)(`div`,{className:`pagina-gastos`,children:[(0,K.jsx)(`h1`,{children:`Registro de Gasto (Salida de Caja)`}),(0,K.jsxs)(`div`,{children:[`Base actual: `,(0,K.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`layout-gastos`,children:[(0,K.jsxs)(`div`,{className:`formulario-gasto`,children:[(0,K.jsx)(`h2`,{children:`Datos del Gasto`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`descripcion`,children:`Descripci√≥n:`}),(0,K.jsx)(`textarea`,{id:`descripcion`,rows:`4`,value:a,onChange:e=>o(e.target.value),disabled:!!l})]}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`monto`,children:`Monto ($):`}),(0,K.jsx)(`input`,{id:`monto`,type:`number`,value:s,onChange:e=>c(e.target.value),disabled:!!l})]})]}),(0,K.jsxs)(`div`,{className:`vista-previa-gasto`,children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`h2`,{children:`Resumen de Salida`}),(0,K.jsxs)(`div`,{className:`resumen-gasto`,children:[(0,K.jsxs)(`div`,{children:[`Descripci√≥n: `,l?l.descripcion:a]}),(0,K.jsxs)(`div`,{className:`monto`,children:[`- $`,(l?l.monto:Number(s||0)).toLocaleString(`es-CO`)]})]})]}),(0,K.jsx)(`div`,{className:`botones-accion`,children:l?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`p`,{className:`gasto-exitoso`,children:[`Gasto `,l.consecutivo,` guardado.`]}),(0,K.jsx)(`button`,{type:`button`,onClick:p,className:`btn-imprimir-ticket`,children:`Imprimir Comprobante (SALIDA)`}),(0,K.jsx)(`button`,{type:`button`,onClick:m,className:`btn-nuevo-gasto`,children:`Registrar Nuevo Gasto (y Descargar TXT)`})]}):(0,K.jsx)(`button`,{type:`button`,onClick:d,className:`btn-guardar-gasto`,disabled:r||!a||!s,children:r?`Guardando...`:`Guardar Gasto`})})]})]})]})}var ht=mt;r.register(s,t,a,c,n,o);function gt({chartData:e,titulo:t,useLogScale:n=!1}){return(0,K.jsx)(l,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:`top`},title:{display:!0,text:t,font:{size:18}}},scales:{x:{ticks:{autoSkip:!1,maxRotation:45}},y:{type:n?`logarithmic`:`linear`,beginAtZero:!n,min:n?.1:void 0,title:{display:!0,text:n?`Escala logar√≠tmica (kg/und)`:`Cantidad (kg/und)`},ticks:n?{callback:e=>Number(e).toLocaleString(`es-CO`)}:{precision:0}}}},data:e})}var _t=gt,vt=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),yt=()=>new Date().toISOString().split(`T`)[0],$=e=>{let t=e.split(`-`);return new Date(t[0],t[1]-1,t[2])},bt=(e,t)=>{let n=new Date().toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`REPORTE DE INVENTARIO`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Fecha: ${n}\n`,i+=`Generado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`
`,i+=`Material`.padEnd(30)+`Stock (kg/und)`.padStart(15)+`
`,i+=`-`.repeat(45)+`
`,e.forEach(e=>{let t=e.nombre.length>29?e.nombre.substring(0,29):e.nombre,n=(Number(e.stock)||0).toFixed(2);i+=t.padEnd(30)+n.padStart(15)+`
`}),i+=`-`.repeat(45)+`
`,i+=`Total de Art√≠culos: ${e.length}\n`,i+=`-`.repeat(45)+`
`,i};function xt(){let{base:e,userProfile:t}=X(),[n,r]=(0,H.useState)(`cierre`),[i,a]=(0,H.useState)(!1),[o,s]=(0,H.useState)(yt),[c,l]=(0,H.useState)(0),[u,d]=(0,H.useState)(0),[f,p]=(0,H.useState)(0),[m,h]=(0,H.useState)(yt),[g,_]=(0,H.useState)(yt),[v,y]=(0,H.useState)([]),[b,x]=(0,H.useState)([]),[w,T]=(0,H.useState)([]),[E,D]=(0,H.useState)([]),[O,k]=(0,H.useState)([]),[A,j]=(0,H.useState)(yt),[ee,N]=(0,H.useState)(yt),[te,P]=(0,H.useState)(``),[ne,I]=(0,H.useState)(yt),[re,ie]=(0,H.useState)(yt),[B,ae]=(0,H.useState)(`todos`),[oe,se]=(0,H.useState)(``),[ce,ue]=(0,H.useState)([]),[U,de]=(0,H.useState)({ingresos:0,egresos:0,ajustes:0,saldo:0}),[W,fe]=(0,H.useState)([]),[G,pe]=(0,H.useState)(!1);(0,H.useRef)(null);let[me,q]=(0,H.useState)(null),[he,ge]=(0,H.useState)(!1),_e=async()=>{a(!0);let e=$(o),t=new Date(e.setHours(0,0,0,0)),n=new Date(e.setHours(23,59,59,999)),r=z.fromDate(t),i=z.fromDate(n),s=0,c=0,u=0;try{let e=F(L(J,`compras`),V(`fecha`,`>=`,r),V(`fecha`,`<=`,i));(await R(e)).forEach(e=>s+=e.data().total);let t=F(L(J,`gastos`),V(`fecha`,`>=`,r),V(`fecha`,`<=`,i));(await R(t)).forEach(e=>c+=e.data().monto);let n=F(L(J,`ventasMenores`),V(`fecha`,`>=`,r),V(`fecha`,`<=`,i));(await R(n)).forEach(e=>u+=e.data().total)}catch(e){console.error(`Error al generar el reporte: `,e),await Q(`Error al generar el reporte.`,{title:`Nasashe sas`,type:`error`})}l(s),d(c),p(u),a(!1)},Y=c+u,ve=e+Y-f,ye=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(J,`compras`),V(`fecha`,`>=`,n),V(`fecha`,`<=`,r),M(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),y(i)}catch(e){console.error(`Error al buscar historial: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`warning`})}a(!1)},be=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(J,`ventas`),V(`fecha`,`>=`,n),V(`fecha`,`<=`,r),M(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),x(i)}catch(e){console.error(`Error al buscar historial de ventas: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},xe=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(J,`ventasMenores`),V(`fecha`,`>=`,n),V(`fecha`,`<=`,r),M(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),T(i)}catch(e){console.error(`Error al buscar historial de ventas menores: `,e),await Q(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},Se=async()=>{a(!0);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(J,`gastos`),V(`fecha`,`>=`,n),V(`fecha`,`<=`,r),M(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),D(i)}catch(e){console.error(`Error al buscar historial de gastos: `,e),alert(`Error al buscar historial.`)}a(!1)},Ce=async()=>{a(!0);let e=te.trim().toUpperCase(),t=new Date($(A).setHours(0,0,0,0)),n=new Date($(ee).setHours(23,59,59,999)),r=z.fromDate(t),i=z.fromDate(n);try{let t;if(e){let n=F(L(J,`remisiones`),V(`consecutivo`,`==`,e));t=await R(n)}else{let e=F(L(J,`remisiones`),V(`fecha`,`>=`,r),V(`fecha`,`<=`,i),M(`fecha`,`desc`));t=await R(e)}let n=t.docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}});k(n)}catch(e){console.error(`Error al buscar historial de remisiones: `,e),alert(`Error al buscar remisiones.`)}a(!1)},we=async()=>{a(!0);try{let e=new Date($(ne).setHours(0,0,0,0)),t=new Date($(re).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[V(`fecha`,`>=`,n),V(`fecha`,`<=`,r),M(`fecha`,`desc`)];B!==`todos`&&i.unshift(V(`tipo`,`==`,B));let a=F(L(J,`movimientos_caja`),...i),o=(await R(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}}),s=oe.trim().toUpperCase();s&&(o=o.filter(e=>String(e.usuario||``).toUpperCase().includes(s)));let c=0,l=0,u=0;o.forEach(e=>{if(e.anulado)return;let t=Number(e.monto)||0;e.tipo===`ingreso`&&(c+=Math.abs(t)),e.tipo===`egreso`&&(l+=Math.abs(t)),e.tipo===`ajuste`&&(u+=t)}),ue(o),de({ingresos:c,egresos:l,ajustes:u,saldo:c-l+u})}catch(e){console.error(`Error al buscar libro de caja: `,e),await Q(`No se pudo cargar el libro de caja.`,{title:`Nasashe sas`,type:`error`})}a(!1)},Te=(e,t)=>{let n=document.createElement(`iframe`);n.style.position=`absolute`,n.style.width=`0`,n.style.height=`0`,n.style.border=`none`,document.body.appendChild(n);let r=n.contentWindow.document;r.open(),r.write(`<!DOCTYPE html><html><head><title>${t}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${e}</pre></body></html>`),r.close();let i=()=>{n.contentWindow.focus(),n.contentWindow.print(),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3)};window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,0)},Ee=e=>{let n=$e(e,t);Te(n,`Ticket ${e.consecutivo}`)},De=e=>{let n=et(e,t);Te(n,`Ticket ${e.consecutivo}`)},Oe=e=>{let n=tt(e,t);Te(n,`Ticket ${e.consecutivo}`)},ke=e=>{let n=nt(e,t);Te(n,`Comprobante ${e.consecutivo}`)},Ae=e=>e?e instanceof Date?e.toLocaleString(`es-CO`):new Date(e).toLocaleString(`es-CO`):``,je=async e=>{let t=new S({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√ìN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino?.nombre||`N/D`}`,12,r),t.text(`Direcci√≥n: ${e.destino?.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino?.nit||`N/D`}`,12,r),t.text(`Tel√©fono: ${e.destino?.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√≥n: ${Ae(e.fecha)}`,12,r),r+=6,t.text(`Conductor: ${e.conductor?.nombre||`N/D`}`,12,r),t.text(`C√©dula: ${e.conductor?.cedula||`N/D`}`,n/2,r),r+=6,t.text(`Direcci√≥n: ${e.conductor?.direccion||`N/D`}`,12,r),r+=6,t.text(`V√≠nculo: ${e.conductor?.vinculo||`N/D`}`,12,r),t.text(`Placa: ${e.conductor?.placa||`N/D`}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor?.celular||`N/D`}`,12,r),r+=6,e.observaciones&&(t.text(`Observaciones: ${e.observaciones}`,12,r),r+=6),C(t,{startY:r+4,head:[[`√çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:(e.items||[]).map((e,t)=>[(t+1).toString(),e.nombre,(e.cantidad??0).toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t},Me=async e=>{try{let t=(await je(e)).output(`bloburl`);window.open(t,`_blank`)}catch(e){console.error(`Error al reimprimir la remisi√≥n:`,e),alert(`No se pudo generar el PDF de la remisi√≥n.`)}},Ne=async(e,n)=>{if(!n)return;let r=()=>{switch(e){case`compra`:return Ee(n);case`venta`:return De(n);case`ventaMenor`:return Oe(n);case`gasto`:return ke(n);case`inventario`:return Ie(n);default:console.warn(`Tipo de ticket no soportado para impresi√≥n en navegador: ${e}`)}};if(!vt()){r();return}try{localStorage.setItem(`ticketData`,JSON.stringify(n)),localStorage.setItem(`ticketUser`,JSON.stringify(t)),localStorage.setItem(`ticketType`,e)}catch(e){console.error(`Error al preparar datos para impresi√≥n:`,e),r();return}let i=(e=>(e?String(e):`${Date.now()}`).replace(/\s/g,`-`))(n.consecutivo),a=`ticket-${e}-${i}`,o=`Impresi√≥n de ticket`;e===`gasto`?o=`Comprobante ${n.consecutivo||``}`.trim():e===`inventario`?o=`Reporte de Inventario`:n.consecutivo&&(o=`Ticket ${n.consecutivo}`);let s=new le(a,{url:`/imprimir`,title:o,width:310,height:600,resizable:!0,decorations:!0});s.once(`tauri://created`,()=>{console.log(`Ventana de impresi√≥n creada`)}),s.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),r()})},Pe=async()=>{pe(!0);let e=[];try{let t=F(L(J,`articulos`),M(`nombre`,`asc`));(await R(t)).forEach(t=>{e.push({id:t.id,...t.data()})}),fe(e)}catch(e){console.error(`Error al cargar inventario: `,e),await Q(`Error al cargar inventario.`)}pe(!1)},Fe=async()=>{if(W.length===0){await Q(`No hay datos de inventario para exportar.`,{title:`Nasashe sas`,type:`warning`});return}let e=new S;e.text(`Reporte de Inventario Actual`,14,15),e.setFontSize(10),e.text(`Generado por: ${t?.nombre||`SISTEMA`}`,14,20),e.text(`Fecha: ${new Date().toLocaleDateString(`es-CO`)}`,14,25);let n=[`Nombre`,`Precio Compra ($)`,`Stock Actual (kg/und)`],r=[];W.forEach(e=>{let t=Number(e?.precioCompra??0),n=Number(e?.stock??0),i=[e?.nombre||`Sin nombre`,t.toLocaleString(`es-CO`),n.toLocaleString(`es-CO`)];r.push(i)}),C(e,{head:[n],body:r,startY:30});let i=new Date().toISOString().split(`T`)[0];try{e.save(`Reporte_Inventario_${i}.pdf`),await Q(`Su archivo se export√≥ con √©xito en la carpeta de descargas.`,{title:`Nasashe sas`,type:`info`})}catch(e){console.error(`Error al exportar el inventario a PDF:`,e),await Q(`Ocurri√≥ un error al exportar el PDF. Por favor, int√©ntalo de nuevo.`,{title:`Nasashe sas`,type:`error`})}},Ie=async e=>{let n=Array.isArray(e?.items)&&e.items.length>0?e.items:W;if(!n||n.length===0){await Q(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`warning`});return}let r=`<!DOCTYPE html><html><head><title>Reporte Inventario</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${bt(n,t)}</pre></body></html>`,i=document.createElement(`iframe`);i.style.position=`fixed`,i.style.right=`0`,i.style.bottom=`0`,i.style.width=`0`,i.style.height=`0`,i.style.border=`0`,document.body.appendChild(i);let a=()=>{setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};i.onload=()=>{let e=i.contentWindow;e?(e.focus(),e.print(),e.onafterprint=a,setTimeout(a,5e3)):a()},i.srcdoc=r};return(0,K.jsxs)(`div`,{className:`pagina-reportes`,children:[(0,K.jsx)(`h1`,{children:`M√≥dulo de Reportes`}),(0,K.jsxs)(`div`,{className:`tabs-container`,children:[(0,K.jsx)(`button`,{className:`tab-button ${n===`cierre`?`active`:``}`,onClick:()=>r(`cierre`),children:`Cierre de Caja`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`historialCompras`?`active`:``}`,onClick:()=>r(`historialCompras`),children:`Hist. Compras`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`historialVentas`?`active`:``}`,onClick:()=>r(`historialVentas`),children:`Hist. Ventas`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`historialVentasMenores`?`active`:``}`,onClick:()=>r(`historialVentasMenores`),children:`Hist. Ventas Menores`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`historialGastos`?`active`:``}`,onClick:()=>r(`historialGastos`),children:`Hist. Gastos`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`libroCaja`?`active`:``}`,onClick:()=>r(`libroCaja`),children:`Libro de Caja`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`historialRemisiones`?`active`:``}`,onClick:()=>r(`historialRemisiones`),children:`Hist. Remisiones`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`inventario`?`active`:``}`,onClick:()=>r(`inventario`),children:`Inventario`}),(0,K.jsx)(`button`,{className:`tab-button ${n===`analisis`?`active`:``}`,onClick:()=>r(`analisis`),children:`An√°lisis de Materiales`})]}),(0,K.jsxs)(`div`,{className:`tab-content`,children:[n===`cierre`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-cierre`,children:`Seleccione la fecha:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-cierre`,value:o,onChange:e=>s(e.target.value)}),(0,K.jsx)(`button`,{onClick:_e,className:`btn-generar`,disabled:i,children:i?`Calculando...`:`Generar Cierre`})]}),(0,K.jsxs)(`h2`,{children:[`Resumen del D√≠a (`,o,`)`]}),(0,K.jsxs)(`div`,{className:`reporte-grid`,children:[(0,K.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,K.jsx)(`h3`,{children:`(+) Total Ventas Menores`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,f.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,K.jsx)(`h3`,{children:`(-) Total Compras`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,c.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,K.jsx)(`h3`,{children:`(-) Total Gastos`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,u.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,K.jsx)(`h3`,{children:`(=) Efectivo Actual en Caja`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,e.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,K.jsx)(`h3`,{children:`(=) Base Inicial (Calculada)`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,ve.toLocaleString(`es-CO`)]})]})]})]}),n===`historialCompras`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,K.jsx)(`button`,{onClick:ye,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Compras`})]}),(0,K.jsx)(`h2`,{children:`Historial de Compras`}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Consecutivo`}),(0,K.jsx)(`th`,{children:`Reciclador`}),(0,K.jsx)(`th`,{children:`Total`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):v.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron compras.`})}):v.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,K.jsx)(`td`,{children:e.consecutivo}),(0,K.jsx)(`td`,{children:e.reciclador}),(0,K.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{onClick:()=>Ne(`compra`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentas`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,K.jsx)(`button`,{onClick:be,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas`})]}),(0,K.jsx)(`h2`,{children:`Historial de Ventas (a Proveedores)`}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Consecutivo`}),(0,K.jsx)(`th`,{children:`Cliente (Proveedor)`}),(0,K.jsx)(`th`,{children:`Total`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):b.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):b.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,K.jsx)(`td`,{children:e.consecutivo}),(0,K.jsx)(`td`,{children:e.proveedor.nombre}),(0,K.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{onClick:()=>Ne(`venta`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentasMenores`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.g.value)}),(0,K.jsx)(`button`,{onClick:xe,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas Menores`})]}),(0,K.jsx)(`h2`,{children:`Historial de Ventas Menores (a Particulares)`}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Consecutivo`}),(0,K.jsx)(`th`,{children:`Cliente`}),(0,K.jsx)(`th`,{children:`Total`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):w.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):w.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,K.jsx)(`td`,{children:e.consecutivo}),(0,K.jsx)(`td`,{children:e.cliente}),(0,K.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{onClick:()=>Ne(`ventaMenor`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialGastos`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,K.jsx)(`button`,{onClick:Se,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Gastos`})]}),(0,K.jsx)(`h2`,{children:`Historial de Gastos`}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Consecutivo`}),(0,K.jsx)(`th`,{children:`Concepto`}),(0,K.jsx)(`th`,{children:`Descripci√≥n`}),(0,K.jsx)(`th`,{children:`Monto`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):E.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron gastos.`})}):E.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,K.jsx)(`td`,{children:e.consecutivo}),(0,K.jsx)(`td`,{children:e.concepto}),(0,K.jsx)(`td`,{children:e.descripcion}),(0,K.jsxs)(`td`,{children:[`$`,e.monto.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{onClick:()=>Ne(`gasto`,e,t),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`libroCaja`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`caja-fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`caja-fecha-inicio`,value:ne,onChange:e=>I(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`caja-fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`caja-fecha-fin`,value:re,onChange:e=>ie(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`caja-tipo`,children:`Tipo:`}),(0,K.jsxs)(`select`,{id:`caja-tipo`,value:B,onChange:e=>ae(e.target.value),children:[(0,K.jsx)(`option`,{value:`todos`,children:`Todos`}),(0,K.jsx)(`option`,{value:`ingreso`,children:`Ingreso`}),(0,K.jsx)(`option`,{value:`egreso`,children:`Egreso`}),(0,K.jsx)(`option`,{value:`ajuste`,children:`Ajuste`})]}),(0,K.jsx)(`label`,{htmlFor:`caja-usuario`,children:`Usuario:`}),(0,K.jsx)(`input`,{id:`caja-usuario`,type:`text`,placeholder:`Filtro por usuario`,value:oe,onChange:e=>se(e.target.value)}),(0,K.jsx)(`button`,{onClick:we,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Movimientos`})]}),(0,K.jsx)(`h2`,{children:`Libro de Caja`}),(0,K.jsxs)(`div`,{className:`reporte-grid`,children:[(0,K.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,K.jsx)(`h3`,{children:`(+) Ingresos`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,U.ingresos.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,K.jsx)(`h3`,{children:`(-) Egresos`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,U.egresos.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,K.jsx)(`h3`,{children:`(+/-) Ajustes`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,U.ajustes.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,K.jsx)(`h3`,{children:`(=) Saldo Calculado`}),(0,K.jsxs)(`div`,{className:`monto`,children:[`$`,U.saldo.toLocaleString(`es-CO`)]})]})]}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Tipo`}),(0,K.jsx)(`th`,{children:`Descripci√≥n`}),(0,K.jsx)(`th`,{children:`Usuario`}),(0,K.jsx)(`th`,{children:`Estado`}),(0,K.jsx)(`th`,{children:`Monto`}),(0,K.jsx)(`th`,{children:`Referencia`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`Buscando...`})}):ce.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`No se encontraron movimientos.`})}):ce.map(e=>{let t=Number(e.monto)||0,n=e.tipo===`egreso`?`-`:`+`,r=e.tipo===`egreso`?`card-egresos`:`card-ingresos`,i=e.referencia?.consecutivo||e.referencia?.id||`N/A`;return(0,K.jsxs)(`tr`,{style:e.anulado?{opacity:.55,textDecoration:`line-through`}:void 0,children:[(0,K.jsx)(`td`,{children:e.fecha?.toLocaleString(`es-CO`)}),(0,K.jsx)(`td`,{children:String(e.tipo||``).toUpperCase()}),(0,K.jsx)(`td`,{children:e.descripcion||`Sin descripci√≥n`}),(0,K.jsx)(`td`,{children:e.usuario||`N/A`}),(0,K.jsx)(`td`,{children:e.anulado?`ANULADO`:`ACTIVO`}),(0,K.jsxs)(`td`,{className:r,children:[n,` $`,Math.abs(t).toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:i})]},e.id)})})]})]}),n===`historialRemisiones`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`remision-fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`remision-fecha-inicio`,value:A,onChange:e=>j(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`remision-fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`remision-fecha-fin`,value:ee,onChange:e=>N(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`remision-consecutivo`,children:`Consecutivo (opcional)`}),(0,K.jsx)(`input`,{id:`remision-consecutivo`,type:`text`,placeholder:`REM-000001`,value:te,onChange:e=>P(e.target.value)}),(0,K.jsx)(`button`,{onClick:Ce,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Remisiones`})]}),(0,K.jsx)(`h2`,{children:`Historial de Remisiones`}),(0,K.jsxs)(`table`,{className:`historial-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Fecha`}),(0,K.jsx)(`th`,{children:`Consecutivo`}),(0,K.jsx)(`th`,{children:`Destino`}),(0,K.jsx)(`th`,{children:`Conductor`}),(0,K.jsx)(`th`,{children:`Items`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:i?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):O.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron remisiones.`})}):O.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:Ae(e.fecha)}),(0,K.jsx)(`td`,{children:e.consecutivo}),(0,K.jsx)(`td`,{children:e.destino?.nombre||`N/D`}),(0,K.jsx)(`td`,{children:e.conductor?.nombre||`N/D`}),(0,K.jsx)(`td`,{children:Array.isArray(e.items)?e.items.length:0}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{onClick:()=>Me(e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`analisis`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`inventario-header`,children:[(0,K.jsx)(`h2`,{children:`Reporte de Inventario Actual`}),(0,K.jsxs)(`div`,{className:`inventario-header-botones`,children:[(0,K.jsx)(`button`,{onClick:Pe,className:`btn-generar`,disabled:G,children:G?`Cargando...`:`Cargar Inventario`}),(0,K.jsx)(`button`,{onClick:Fe,className:`btn-exportar-pdf`,disabled:W.length===0,children:`Exportar a PDF`}),(0,K.jsx)(`button`,{onClick:async()=>{if(W.length===0){await Q(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`error`});return}let e={items:W.map(({id:e,nombre:t,stock:n,precioCompra:r})=>({id:e,nombre:t,stock:n,precioCompra:r})),fechaGeneracion:new Date().toISOString()};try{await Ne(`inventario`,e)}catch(t){console.error(`Error al preparar la impresi√≥n del inventario:`,t),Ie(e)}},className:`btn-imprimir-inventario`,disabled:W.length===0,children:`Imprimir`})]})]}),(0,K.jsxs)(`table`,{className:`inventario-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Nombre`}),(0,K.jsx)(`th`,{children:`Precio Compra`}),(0,K.jsx)(`th`,{children:`Stock Actual (kg/und)`})]})}),(0,K.jsx)(`tbody`,{children:G?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`Cargando...`})}):W.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`No se encontr√≥ inventario.`})}):W.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,K.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})]}),n===`analisis`&&(0,K.jsxs)(`div`,{children:[(0,K.jsxs)(`div`,{className:`reporte-controles`,children:[(0,K.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,K.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,K.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,K.jsxs)(`label`,{className:`checkbox-inline`,style:{display:`flex`,alignItems:`center`,gap:`8px`},children:[(0,K.jsx)(`input`,{type:`checkbox`,checked:he,onChange:e=>ge(e.target.checked)}),`Usar escala logar√≠tmica`]}),(0,K.jsx)(`button`,{onClick:async()=>{a(!0),q(null);let e=new Date($(m).setHours(0,0,0,0)),t=new Date($(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i={};try{let e=F(L(J,`compras`),V(`fecha`,`>=`,n),V(`fecha`,`<=`,r));(await R(e)).forEach(e=>{e.data().items.forEach(e=>{i[e.nombre]=(i[e.nombre]||0)+e.cantidad})});let t=Object.keys(i),a=Object.values(i);t.length===0?q({labels:[],datasets:[]}):q({labels:t,datasets:[{label:`Total Comprado (kg/und)`,data:a,backgroundColor:`rgba(220, 53, 69, 0.6)`,borderColor:`rgba(220, 53, 69, 1)`,borderWidth:1,minBarLength:8}]})}catch(e){console.error(`Error al generar an√°lisis: `,e),await Q(`Error al generar an√°lisis.`,{title:`Error de an√°lisis`,type:`error`})}a(!1)},className:`btn-generar`,disabled:i,children:i?`Generando...`:`Generar An√°lisis`})]}),(0,K.jsx)(`h2`,{children:`An√°lisis de Materiales Comprados (por Cantidad)`}),(0,K.jsx)(`div`,{className:`chart-container`,children:i?(0,K.jsx)(`p`,{children:`Generando gr√°fica...`}):me?me.labels.length>0?(0,K.jsx)(_t,{chartData:me,titulo:`Materiales Comprados (${m} a ${g})`,useLogScale:he}):(0,K.jsx)(`p`,{children:`No se encontraron datos de compras para este rango de fechas.`}):(0,K.jsx)(`p`,{children:`Seleccione un rango de fechas y haga clic en "Generar An√°lisis" para ver la gr√°fica.`})})]})]})]})}var St=xt,Ct=e=>String(e||``).trim().toUpperCase(),wt=e=>String(e||``).trim().toLowerCase();async function Tt(e){let t=e.trim();if(!t)throw Error(`Usuario no encontrado.`);let n=L(J,`usuarios`),r=Ct(t),i=await R(F(n,V(`nombre`,`==`,r)));if(!i.empty){let e=i.docs[0].data()?.email;if(e)return e}let a=(await R(n)).docs.map(e=>e.data()).find(e=>[e?.nombre,e?.nombreUsuario,e?.username,e?.usuario].map(Ct).includes(r))?.email;if(a)return a;if(t.includes(`@`))return wt(t);throw Error(`Usuario no encontrado.`)}function Et(){let[e,t]=(0,H.useState)(``),[n,r]=(0,H.useState)(``),[i,a]=(0,H.useState)(null),[o,s]=(0,H.useState)(!1),c=m();return(0,K.jsx)(`div`,{className:`login-page-container`,children:(0,K.jsxs)(`div`,{className:`login-box`,children:[(0,K.jsx)(`h1`,{children:`Iniciar Sesi√≥n`}),(0,K.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),a(null),s(!0);try{let t=await Tt(e);await oe(ge,t,n),c(`/`)}catch(e){e?.code===`permission-denied`||e?.code===`firestore/permission-denied`?a(`No hay permiso para leer usuarios en Firestore.`):e?.message===`Usuario no encontrado.`?a(`Nombre de usuario incorrecto.`):e?.code===`auth/invalid-credential`||e?.code===`auth/wrong-password`?a(`Contrase√±a incorrecta.`):e?.code===`auth/user-not-found`?a(`Usuario no existe en Authentication.`):a(`Error al iniciar sesi√≥n. Intente de nuevo.`),console.error(e)}finally{s(!1)}},className:`login-form`,children:[(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`nombre-usuario`,children:`Nombre de Usuario:`}),(0,K.jsx)(`input`,{id:`nombre-usuario`,type:`text`,value:e,onChange:e=>t(e.target.value),required:!0})]}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`password`,children:`Contrase√±a:`}),(0,K.jsx)(`input`,{id:`password`,type:`password`,value:n,onChange:e=>r(e.target.value),required:!0})]}),(0,K.jsx)(`button`,{type:`submit`,className:`login-btn`,disabled:o,children:o?`Ingresando...`:`Ingresar`}),i&&(0,K.jsx)(`p`,{className:`login-error`,children:i})]})]})})}var Dt=Et,Ot=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,kt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function At(){let{userProfile:e,base:t,obtenerConsecutivoParaModulo:n}=X(),[r,i]=(0,H.useState)(!1),[a,o]=(0,H.useState)(``),[s,c]=(0,H.useState)(``),[l,u]=(0,H.useState)(``),[d,f]=(0,H.useState)(``),[p,m]=(0,H.useState)([]),[h,g]=(0,H.useState)(0),[_,v]=(0,H.useState)(null),[y,b]=(0,H.useState)(null),x=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`;(0,H.useEffect)(()=>{let e=p.reduce((e,t)=>e+t.subtotal,0);g(e)},[p]);let S=()=>{let e=Number(l),t=Number(d);if(!s||e<=0||t<=0){alert(`Complete Material, Cantidad y Precio.`);return}let n=e*t;m(r=>[...r,{id:new Date().getTime(),localId:x(),descripcion:s.toUpperCase(),cantidad:e,precio:t,subtotal:n}]),c(``),u(``),f(``)},C=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&(m(t=>t.filter(t=>t.localId!==e)),b(t=>t===e?null:t))},w=e=>{b(t=>t===e?null:e)},T=(e,t)=>{let n=Number(e.target.value);n<=0||m(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precio}:e))},E=(e,t)=>{let n=Number(e.target.value);n<=0||m(e=>e.map(e=>e.localId===t?{...e,precio:n,subtotal:n*e.cantidad}:e))},D=async()=>{if(p.length===0){alert(`No hay art√≠culos en la venta.`);return}i(!0);let t=null;try{let r=k(L(J,`ventasMenores`)),{consecutivo:i,bloqueRef:s}=await n(`ventasMenores`),c=a.trim().toUpperCase(),l={consecutivo:i,cliente:c||`N/A`,items:p,total:h,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};t=l;let u=A(J),d=k(L(J,`movimientos_caja`));u.set(r,l),u.update(s,{siguiente:j(1),actualizadoEn:z.now()}),u.set(d,{tipo:`ingreso`,monto:h,descripcion:`Venta menor ${i} - ${c||`N/A`}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`ventasMenores`,id:r.id,consecutivo:i}}),await u.commit(),v(t),o(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}i(!1)},O=t=>{let n=tt(t,e);rt({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return(0,K.jsxs)(`div`,{className:`pagina-ventas-menores`,children:[(0,K.jsx)(`h1`,{children:`Registro de Venta Menor (a Particular)`}),(0,K.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,K.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`layout-ventas-menores`,children:[(0,K.jsxs)(`div`,{className:`formulario-venta-menor`,children:[(0,K.jsx)(`h2`,{children:`Datos de la Venta`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`cliente`,children:`Nombre Cliente (Opcional):`}),(0,K.jsx)(`input`,{id:`cliente`,type:`text`,value:a,onChange:e=>o(e.target.value.toUpperCase()),disabled:_})]}),(0,K.jsx)(`hr`,{}),(0,K.jsx)(`h3`,{children:`Material`}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`itemDescripcion`,children:`Descripci√≥n:`}),(0,K.jsx)(`input`,{id:`itemDescripcion`,type:`text`,value:s,onChange:e=>c(e.target.value.toUpperCase()),disabled:_})]}),(0,K.jsxs)(`div`,{className:`form-manual-item`,children:[(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`itemCantidad`,children:`Cantidad:`}),(0,K.jsx)(`input`,{id:`itemCantidad`,type:`number`,value:l,onChange:e=>u(e.target.value),disabled:_})]}),(0,K.jsxs)(`div`,{className:`form-grupo`,children:[(0,K.jsx)(`label`,{htmlFor:`itemPrecio`,children:`Precio x (Und o Kg):`}),(0,K.jsx)(`input`,{id:`itemPrecio`,type:`number`,value:d,onChange:e=>f(e.target.value),disabled:_})]})]}),(0,K.jsx)(`button`,{type:`button`,onClick:S,className:`btn-anadir-item-menor`,disabled:_,children:`+ A√±adir Item`})]}),(0,K.jsxs)(`div`,{className:`pre-factura`,children:[(0,K.jsx)(`h2`,{children:`Items de la Venta`}),(0,K.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Descripci√≥n`}),(0,K.jsx)(`th`,{children:`Cant.`}),(0,K.jsx)(`th`,{children:`Precio`}),(0,K.jsx)(`th`,{children:`Subtotal`}),(0,K.jsx)(`th`,{children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:(_?_.items:p).length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√±ade art√≠culos manuales...`})}):(_?_.items:p).map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.descripcion}),(0,K.jsx)(`td`,{children:y===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>T(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,K.jsx)(`td`,{children:y===e.localId?(0,K.jsx)(`input`,{type:`number`,value:e.precio,onChange:t=>E(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precio}`}),(0,K.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,K.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>w(e.localId),disabled:_,children:y===e.localId?`Listo`:`Editar`}),(0,K.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>C(e.localId),disabled:_,children:`Anular`})]})]},e.localId||e.id))})]}),(0,K.jsxs)(`div`,{className:`total-venta-menor`,children:[`Total: $`,(_?_.total:h).toLocaleString(`es-CO`)]}),(0,K.jsx)(`div`,{className:`botones-accion`,children:_?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`p`,{className:`venta-exitosa`,children:[`¬°Venta `,_.consecutivo,` guardada!`]}),(0,K.jsx)(`button`,{type:`button`,onClick:async()=>{if(_)if(!Ot())O(_);else{localStorage.setItem(`ticketData`,JSON.stringify(_)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`ventaMenor`);let t=`ticket-venta-menor-${_.consecutivo.replace(/\s/g,`-`)}`;new le(t,{url:`/imprimir`,title:`Ticket ${_.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),O(_)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{if(!_||Ot())return;let t=tt(_,e);kt(t,_.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{m([]),g(0),o(``),v(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,K.jsx)(`button`,{type:`button`,onClick:D,className:`btn-guardar-venta-menor`,disabled:r||p.length===0,children:r?`Guardando...`:`Guardar Venta`})})]})]})]})}var jt=At;function Mt(){let[e,t]=(0,H.useState)(!0),[n,r]=(0,H.useState)([]),[i,a]=(0,H.useState)(!1),[o,s]=(0,H.useState)(``),[c,l]=(0,H.useState)(``),[u,d]=(0,H.useState)(``),[f,p]=(0,H.useState)(`empleado`),m=async()=>{t(!0);try{let e=(await R(L(J,`usuarios`))).docs.map(e=>({id:e.id,...e.data()}));r(e)}catch(e){console.error(`Error al traer usuarios: `,e)}t(!1)};(0,H.useEffect)(()=>{m()},[]);let h=async e=>{if(e.preventDefault(),!o||!c||!u){alert(`Complete todos los campos.`);return}a(!0);try{let e=o.trim(),t=c.trim().toLowerCase(),n=(await se(ge,t,u)).user.uid;await N(k(J,`usuarios`,n),{nombre:e.toUpperCase(),nombreNormalizado:e.toUpperCase(),email:t,rol:f}),alert(`Usuario ${e.toUpperCase()} creado!`),s(``),l(``),d(``),p(`empleado`),await m()}catch(e){console.error(`Error al crear usuario: `,e),e.code===`auth/email-already-in-use`?alert(`Error: Este correo electr√≥nico ya est√° en uso.`):alert(`Error al crear el usuario. Verifique la consola.`)}a(!1)},g=async(e,t)=>{if(window.confirm(`¬øSeguro que deseas eliminar a ${t}? Esta acci√≥n no se puede deshacer.`))try{await P(k(J,`usuarios`,e)),alert(`Usuario ${t} eliminado.`),await m()}catch(e){console.error(`Error al eliminar usuario: `,e)}};return(0,K.jsxs)(`div`,{className:`pagina-usuarios`,children:[(0,K.jsx)(`h1`,{children:`Gesti√≥n de Usuarios`}),(0,K.jsx)(`p`,{children:`Aqu√≠ puedes crear y administrar las cuentas de los empleados.`}),(0,K.jsxs)(`div`,{className:`form-container`,children:[(0,K.jsx)(`h2`,{children:`A√±adir Nuevo Usuario`}),(0,K.jsxs)(`form`,{onSubmit:h,children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{children:`Nombre (para Login):`}),(0,K.jsx)(`input`,{type:`text`,value:o,onChange:e=>s(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{children:`Email (real):`}),(0,K.jsx)(`input`,{type:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{children:`Contrase√±a:`}),(0,K.jsx)(`input`,{type:`password`,value:u,onChange:e=>d(e.target.value)})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`label`,{children:`Rol:`}),(0,K.jsxs)(`select`,{value:f,onChange:e=>p(e.target.value),children:[(0,K.jsx)(`option`,{value:`empleado`,children:`Empleado`}),(0,K.jsx)(`option`,{value:`admin`,children:`Administrador`})]})]}),(0,K.jsx)(`button`,{type:`submit`,disabled:i,children:i?`Creando...`:`Crear Usuario`})]})]}),(0,K.jsx)(`h2`,{children:`Lista de Usuarios`}),e?(0,K.jsx)(`p`,{children:`Cargando...`}):(0,K.jsxs)(`table`,{className:`usuarios-table`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Nombre`}),(0,K.jsx)(`th`,{children:`Email`}),(0,K.jsx)(`th`,{children:`Rol`}),(0,K.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,K.jsx)(`tbody`,{children:n.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{children:e.email}),(0,K.jsx)(`td`,{children:e.rol}),(0,K.jsx)(`td`,{className:`acciones-cell`,children:e.rol!==`admin`&&(0,K.jsx)(`button`,{onClick:()=>g(e.id,e.nombre),className:`btn-borrar`,children:`Borrar`})})]},e.id))})]})]})}var Nt=Mt,Pt=e=>`REM-${String(e).padStart(6,`0`)}`,Ft=e=>{let t=Number(e);return Number.isNaN(t)?0:t},It=()=>typeof crypto<`u`&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Lt=async e=>{let t=await(await fetch(e)).blob();return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})};function Rt(){let{userProfile:e,consecutivosData:t,bloquesConsecutivos:n,obtenerConsecutivoParaModulo:r}=X(),i=e?.rol===`admin`,[a,o]=(0,H.useState)([]),[s,c]=(0,H.useState)([]),[l,u]=(0,H.useState)(``),[d,f]=(0,H.useState)({nombre:``,nit:``,direccion:``,telefono:``}),[p,m]=(0,H.useState)({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),[h,g]=(0,H.useState)({articuloId:``,cantidad:``,modoCantidad:`manual`}),[_,v]=(0,H.useState)([]),[y,b]=(0,H.useState)(``),[x,w]=(0,H.useState)(!1),[T,E]=(0,H.useState)(null),[D,O]=(0,H.useState)(``),M=(0,H.useMemo)(()=>{let e=n?.remisiones,r=Number(e?.siguiente),i=Number(e?.fin);return Number.isFinite(r)&&Number.isFinite(i)&&r<=i?r:(t?.remisiones??0)+1},[n,t]);(0,H.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([R(L(J,`proveedores`)),R(L(J,`articulos`))]),n=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre)),r=t.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));o(n),c(r)}catch(e){console.error(`Error al cargar datos para la remisi√É¬≥n:`,e)}})()},[]);let ee=e=>{let t=e.target.value;u(t);let n=a.find(e=>e.id===t);n&&f({nombre:n.nombre||``,nit:n.nit||``,direccion:n.direccion||``,telefono:n.telefono||``})},N=e=>{let{name:t,value:n}=e.target;m(e=>({...e,[t]:t===`vinculo`?n:n.toUpperCase()}))},te=e=>{let t=e.target.value,n=s.find(e=>e.id===t);g(e=>({...e,articuloId:t,cantidad:n&&e.modoCantidad===`stock`?n.stock||0:``}))},P=e=>{let t=s.find(e=>e.id===h.articuloId);g(n=>({...n,modoCantidad:e,cantidad:e===`stock`&&t?t.stock||0:``}))},ne=()=>{if(!h.articuloId){alert(`Selecciona un material antes de agregarlo.`);return}let e=s.find(e=>e.id===h.articuloId);if(!e){alert(`No se pudo identificar el material.`);return}let t=h.modoCantidad===`stock`?e.stock||0:Ft(h.cantidad);if(t<=0){alert(`Ingresa una cantidad v√É¬°lida.`);return}if(t>(e.stock||0)){alert(`La cantidad supera el stock disponible (${e.stock||0}).`);return}v(n=>[...n,{localId:It(),articuloId:e.id,nombre:e.nombre,cantidad:t,modoCantidad:h.modoCantidad}]),g({articuloId:``,cantidad:``,modoCantidad:`manual`})},F=e=>{v(t=>t.filter(t=>t.localId!==e))},I=()=>i?l?_.length===0?(alert(`Agrega al menos un material a la remisi√É¬≥n.`),!1):!p.nombre||!p.cedula||!p.placa?(alert(`Completa los datos del conductor (nombre, c√É¬©dula y placa son obligatorios).`),!1):!0:(alert(`Selecciona un destino (proveedor).`),!1):(alert(`Solo los administradores pueden crear remisiones.`),!1),re=async e=>{let t=new S({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;try{let e=await Lt(encodeURI(G(`logo con fondo.png`)));t.addImage(e,`PNG`,12,r,40,20)}catch(e){console.warn(`No se pudo cargar el logo para el PDF:`,e)}t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√É‚ÄúN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino.nombre}`,12,r),t.text(`Direcci√É¬≥n: ${e.destino.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino.nit||`N/D`}`,12,r),t.text(`Tel√É¬©fono: ${e.destino.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√É¬≥n: ${new Date(e.fecha.toDate()).toLocaleString()}`,12,r),r+=6,t.text(`Conductor: ${e.conductor.nombre}`,12,r),t.text(`C√É¬©dula: ${e.conductor.cedula}`,n/2,r),r+=6,t.text(`Direcci√É¬≥n: ${e.conductor.direccion||`N/D`}`,12,r),r+=6,t.text(`V√É¬≠nculo: ${e.conductor.vinculo}`,12,r),t.text(`Placa: ${e.conductor.placa}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor.celular||`N/D`}`,12,r),r+=6,y&&(t.text(`Observaciones: ${y}`,12,r),r+=6),C(t,{startY:r+4,head:[[`√É¬çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:e.items.map((e,t)=>[(t+1).toString(),e.nombre,e.cantidad.toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√É¬°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t};return i?(0,K.jsxs)(`div`,{className:`remisiones-container`,children:[(0,K.jsxs)(`div`,{className:`remisiones-encabezado`,children:[(0,K.jsxs)(`div`,{className:`remisiones-encabezado-textos`,children:[(0,K.jsx)(`h1`,{children:`Remisiones`}),(0,K.jsx)(`p`,{children:`Genera y guarda remisiones con consecutivo y descarga el PDF listo para impresi√É¬≥n.`}),(0,K.jsxs)(`p`,{className:`remisiones-consecutivo`,children:[`Pr√É¬≥ximo consecutivo: `,(0,K.jsx)(`strong`,{children:Pt(M)})]})]}),(0,K.jsx)(`img`,{src:G(`logo con fondo.png`),alt:`Logo Nasashe`,className:`remisiones-logo`})]}),(0,K.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,K.jsx)(`h2`,{children:`Destino`}),(0,K.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,K.jsxs)(`label`,{children:[`Destino (proveedor)`,(0,K.jsxs)(`select`,{value:l,onChange:ee,children:[(0,K.jsx)(`option`,{value:``,children:`Seleccione...`}),a.map(e=>(0,K.jsx)(`option`,{value:e.id,children:e.nombre},e.id))]})]}),(0,K.jsxs)(`label`,{children:[`NIT / CC`,(0,K.jsx)(`input`,{type:`text`,value:d.nit,readOnly:!0})]}),(0,K.jsxs)(`label`,{children:[`Direcci√É¬≥n`,(0,K.jsx)(`input`,{type:`text`,value:d.direccion,readOnly:!0})]}),(0,K.jsxs)(`label`,{children:[`Tel√É¬©fono`,(0,K.jsx)(`input`,{type:`text`,value:d.telefono,readOnly:!0})]})]})]}),(0,K.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,K.jsx)(`h2`,{children:`Datos del conductor`}),(0,K.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,K.jsxs)(`label`,{children:[`Nombre`,(0,K.jsx)(`input`,{name:`nombre`,value:p.nombre,onChange:N})]}),(0,K.jsxs)(`label`,{children:[`C√É¬©dula`,(0,K.jsx)(`input`,{name:`cedula`,value:p.cedula,onChange:N})]}),(0,K.jsxs)(`label`,{children:[`Direcci√É¬≥n de residencia`,(0,K.jsx)(`input`,{name:`direccion`,value:p.direccion,onChange:N})]}),(0,K.jsxs)(`label`,{children:[`Placa veh√É¬≠culo`,(0,K.jsx)(`input`,{name:`placa`,value:p.placa,onChange:N})]}),(0,K.jsxs)(`label`,{children:[`Celular`,(0,K.jsx)(`input`,{name:`celular`,value:p.celular,onChange:N})]}),(0,K.jsxs)(`div`,{className:`remisiones-vinculo`,children:[(0,K.jsx)(`span`,{children:`V√É¬≠nculo con la raz√É¬≥n social`}),(0,K.jsxs)(`label`,{className:`remisiones-check`,children:[(0,K.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`CONTRATISTA DE FLETE`,checked:p.vinculo===`CONTRATISTA DE FLETE`,onChange:N}),`Contr. Flete`]}),(0,K.jsxs)(`label`,{className:`remisiones-check`,children:[(0,K.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`EMPLEADO`,checked:p.vinculo===`EMPLEADO`,onChange:N}),`Empleado`]})]})]})]}),(0,K.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,K.jsx)(`h2`,{children:`Materiales`}),(0,K.jsxs)(`div`,{className:`remisiones-articulos`,children:[(0,K.jsxs)(`label`,{children:[`Material`,(0,K.jsxs)(`select`,{value:h.articuloId,onChange:te,children:[(0,K.jsx)(`option`,{value:``,children:`Seleccione...`}),s.map(e=>(0,K.jsxs)(`option`,{value:e.id,children:[e.nombre,` (stock: `,e.stock||0,` Kg)`]},e.id))]})]}),(0,K.jsxs)(`div`,{className:`remisiones-cantidad-opciones`,children:[(0,K.jsx)(`span`,{children:`Cantidad`}),(0,K.jsxs)(`div`,{className:`remisiones-radios`,children:[(0,K.jsxs)(`label`,{children:[(0,K.jsx)(`input`,{type:`radio`,checked:h.modoCantidad===`stock`,onChange:()=>P(`stock`)}),`Usar stock disponible`]}),(0,K.jsxs)(`label`,{children:[(0,K.jsx)(`input`,{type:`radio`,checked:h.modoCantidad===`manual`,onChange:()=>P(`manual`)}),`Ingresar manualmente`]})]}),h.modoCantidad===`manual`&&(0,K.jsx)(`input`,{type:`number`,min:`0`,value:h.cantidad,onChange:e=>g(t=>({...t,cantidad:e.target.value})),placeholder:`Cantidad en Kg`})]}),(0,K.jsx)(`button`,{type:`button`,className:`remisiones-add`,onClick:ne,children:`A√É¬±adir material`})]}),_.length>0&&(0,K.jsxs)(`table`,{className:`remisiones-tabla`,children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`#`}),(0,K.jsx)(`th`,{children:`Material`}),(0,K.jsx)(`th`,{children:`Cantidad (Kg)`}),(0,K.jsx)(`th`,{})]})}),(0,K.jsx)(`tbody`,{children:_.map((e,t)=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:t+1}),(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{children:e.cantidad}),(0,K.jsx)(`td`,{children:(0,K.jsx)(`button`,{type:`button`,className:`remisiones-delete`,onClick:()=>F(e.localId),children:`Quitar`})})]},e.localId))})]})]}),(0,K.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,K.jsx)(`h2`,{children:`Observaciones`}),(0,K.jsx)(`textarea`,{value:y,onChange:e=>b(e.target.value.toUpperCase()),placeholder:`Datos adicionales, sellos, etc.`,rows:3})]}),(0,K.jsxs)(`div`,{className:`remisiones-acciones`,children:[(0,K.jsx)(`button`,{type:`button`,onClick:async()=>{if(!I())return;w(!0);let t=a.find(e=>e.id===l);try{let n=k(L(J,`remisiones`)),i=null,{consecutivo:a,bloqueRef:o}=await r(`remisiones`),c=_.map(e=>{let t=s.find(t=>t.id===e.articuloId);if(!t)throw Error(`No se encontro el articulo ${e.nombre} en cache.`);let n=Number(t.stock)||0;if(e.cantidad>n)throw Error(`El material ${e.nombre} no tiene stock suficiente.`);return e}),l={consecutivo:a,destino:{id:t.id,nombre:t.nombre,nit:t.nit||``,direccion:t.direccion||``,telefono:t.telefono||``},conductor:p,items:c,observaciones:y,fecha:z.now(),creadoPor:e?.nombre||`SISTEMA`};i=l;let d=A(J);d.set(n,l),d.update(o,{siguiente:j(1),actualizadoEn:z.now()}),c.forEach(e=>{let t=k(J,`articulos`,e.articuloId);d.update(t,{stock:j(-e.cantidad)})}),await d.commit();let h=await re(i);E(h),O(i.consecutivo),v([]),b(``),u(``),f({nombre:``,nit:``,direccion:``,telefono:``}),m({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),g({articuloId:``,cantidad:``,modoCantidad:`manual`});let x=h.output(`bloburl`);window.open(x,`_blank`)}catch(e){console.error(`Error al guardar la remisi√É¬≥n:`,e),alert(e.message||`No se pudo guardar la remisi√É¬≥n.`)}w(!1)},disabled:x,children:x?`Guardando...`:`Guardar y generar PDF`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{if(T){let e=T.output(`bloburl`),t=document.createElement(`iframe`);t.style.display=`none`,t.src=e,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print()}}},disabled:!T,children:`Imprimir √É¬∫ltima remisi√É¬≥n`}),(0,K.jsx)(`button`,{type:`button`,onClick:()=>{T&&D&&T.save(`${D}.pdf`)},disabled:!T,children:`Descargar PDF`})]})]}):(0,K.jsxs)(`div`,{className:`remisiones-container`,children:[(0,K.jsx)(`h1`,{children:`Remisiones`}),(0,K.jsx)(`p`,{className:`remisiones-alerta`,children:`Solo los administradores pueden gestionar las remisiones.`})]})}var zt=Rt,Bt=e(y()),Vt=e=>{if(!e)return new Date;if(e instanceof Date)return e;if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?new Date:t}return typeof e==`object`&&typeof e.toDate==`function`?e.toDate():new Date};function Ht({compraData:e,usuario:t}){if(!e)return null;let n=Vt(e.fecha).toLocaleString(`es-CO`);return e.consecutivo,(0,K.jsxs)(`div`,{className:`ticket-container`,children:[(0,K.jsxs)(`div`,{className:`ticket-header`,children:[(0,K.jsx)(`h3`,{children:`TICKET DE COMPRA`}),(0,K.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,K.jsx)(`p`,{children:`901907763-3`}),(0,K.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,K.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,K.jsx)(`p`,{children:`605-000-0000`})]}),(0,K.jsxs)(`div`,{className:`ticket-info`,children:[(0,K.jsxs)(`p`,{children:[`Factura: `,e.consecutivo]}),(0,K.jsx)(`p`,{children:`Actividad: Compra`}),(0,K.jsxs)(`p`,{children:[`Fecha: `,n]}),(0,K.jsxs)(`p`,{children:[`Facturado por: `,t?.nombre||`USUARIO`]})]}),(0,K.jsx)(`div`,{className:`ticket-barcode`,children:(0,K.jsx)(Bt.default,{value:e.consecutivo.replace(/\D/g,``),format:`CODE128`,displayValue:!1,margin:0})}),(0,K.jsx)(`div`,{className:`ticket-items`,children:(0,K.jsxs)(`table`,{children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,K.jsx)(`th`,{className:`col-cant`,children:`Cant`}),(0,K.jsx)(`th`,{className:`col-prec`,children:`Prec`}),(0,K.jsx)(`th`,{className:`col-tot`,children:`Total`})]})}),(0,K.jsx)(`tbody`,{children:e.items.map((e,t)=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.nombre}),(0,K.jsx)(`td`,{className:`col-cant`,children:(Number(e.cantidad)||0).toFixed(2)}),(0,K.jsxs)(`td`,{className:`col-prec`,children:[`$`,e.precioCompra]}),(0,K.jsxs)(`td`,{className:`col-tot`,children:[`$`,e.subtotal.toLocaleString(`es-CO`)]})]},t))})]})}),(0,K.jsxs)(`div`,{className:`ticket-totales`,children:[(0,K.jsxs)(`div`,{className:`total-row`,children:[(0,K.jsx)(`span`,{children:`Subtotal:`}),(0,K.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]}),(0,K.jsxs)(`div`,{className:`total-row`,children:[(0,K.jsx)(`span`,{children:`IVA (0%):`}),(0,K.jsx)(`span`,{children:`$0`})]}),(0,K.jsxs)(`div`,{className:`total-row final`,children:[(0,K.jsx)(`span`,{children:`Total:`}),(0,K.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]})]}),(0,K.jsxs)(`div`,{className:`ticket-footer`,children:[(0,K.jsx)(`p`,{children:`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`}),(0,K.jsx)(`p`,{children:`¬° Gracias por su venta !`})]})]})}var Ut=Ht;function Wt({inventarioData:e,usuario:t}){if(!e||!Array.isArray(e.items)||e.items.length===0)return(0,K.jsx)(`div`,{className:`ticket-container`,children:(0,K.jsxs)(`div`,{className:`ticket-header`,children:[(0,K.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,K.jsx)(`p`,{children:`No hay art√≠culos para mostrar.`})]})});let n=e.fechaGeneracion?new Date(e.fechaGeneracion):new Date,r=e.items.length;return(0,K.jsxs)(`div`,{className:`ticket-container`,children:[(0,K.jsxs)(`div`,{className:`ticket-header`,children:[(0,K.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,K.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,K.jsx)(`p`,{children:`901907763-3`}),(0,K.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,K.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,K.jsx)(`p`,{children:`605-000-0000`})]}),(0,K.jsxs)(`div`,{className:`ticket-info`,children:[(0,K.jsxs)(`p`,{children:[`Fecha: `,n.toLocaleString(`es-CO`)]}),(0,K.jsxs)(`p`,{children:[`Generado por: `,t?.nombre||`USUARIO`]})]}),(0,K.jsx)(`div`,{className:`ticket-items`,children:(0,K.jsxs)(`table`,{children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,K.jsx)(`th`,{className:`col-tot`,children:`Stock (kg/und)`})]})}),(0,K.jsx)(`tbody`,{children:e.items.map(e=>(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{className:`col-mat`,children:e.nombre}),(0,K.jsx)(`td`,{className:`col-tot`,children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})}),(0,K.jsx)(`div`,{className:`ticket-totales`,children:(0,K.jsxs)(`div`,{className:`total-row final`,children:[(0,K.jsx)(`span`,{children:`Total de art√≠culos:`}),(0,K.jsx)(`span`,{children:r})]})}),(0,K.jsx)(`div`,{className:`ticket-footer`,children:(0,K.jsx)(`p`,{children:`Inventario generado autom√°ticamente.`})})]})}var Gt=Wt,Kt=(e,t)=>typeof t==`object`&&t&&`seconds`in t&&`nanoseconds`in t?new Date(t.seconds*1e3+t.nanoseconds/1e6):e===`fecha`&&typeof t==`string`&&t.includes(`T`)&&t.endsWith(`Z`)?new Date(t):t;function qt(){let[e,t]=(0,H.useState)(null);if((0,H.useEffect)(()=>{try{let e=localStorage.getItem(`ticketData`),n=localStorage.getItem(`ticketUser`),r=localStorage.getItem(`ticketType`);if(e&&n&&r){let i=JSON.parse(e,Kt),a=JSON.parse(n);t({data:i,user:a,type:r}),localStorage.removeItem(`ticketData`),localStorage.removeItem(`ticketUser`),localStorage.removeItem(`ticketType`)}else console.error(`No se encontraron datos de impresi√≥n en localStorage.`)}catch(e){console.error(`Error al leer datos de impresi√≥n:`,e)}},[]),(0,H.useEffect)(()=>{if(e){let e=setTimeout(()=>{let e=()=>{try{window.__TAURI__?ce().close():window.close()}catch(e){console.warn(`No se pudo cerrar la ventana de impresi√≥n autom√°ticamente:`,e)}};window.onafterprint=e,window.print(),window.onfocus=()=>setTimeout(e,500)},100);return()=>clearTimeout(e)}},[e]),!e)return(0,K.jsx)(`div`,{style:{fontFamily:`monospace`,padding:`10px`},children:`Cargando ticket...`});switch(e.type){case`compra`:return(0,K.jsx)(Ut,{compraData:e.data,usuario:e.user});case`inventario`:return(0,K.jsx)(Gt,{inventarioData:e.data,usuario:e.user});default:return(0,K.jsx)(`div`,{children:`Error: Tipo de ticket no reconocido.`})}}var Jt=qt,Yt=k(J,`configuracion`,`consecutivos`),Xt=e=>{let t=Number(e);return Number.isNaN(t)||t<0?0:t},Zt=(e,t=100)=>{let n=Number(e);return!Number.isFinite(n)||n<=0?t:Math.floor(n)};function Qt(){let{userProfile:e,currentUser:t,deviceId:n,reservarBloqueParaModulo:r}=X(),i=e?.rol===`admin`,[a,o]=(0,H.useState)({compras:``,ventas:``,gastos:``,ventasMenores:``,remisiones:``}),[s,c]=(0,H.useState)(!0),[l,u]=(0,H.useState)(!1),[d,f]=(0,H.useState)(``),[p,m]=(0,H.useState)([]),[h,g]=(0,H.useState)(!0),[_,v]=(0,H.useState)(``),[y,b]=(0,H.useState)(!1),[x,S]=(0,H.useState)({deviceId:``,ownerUid:``,modulo:`ventas`,tamano:`100`}),C=(0,H.useMemo)(()=>Object.keys(Y),[]);(0,H.useEffect)(()=>{(async()=>{c(!0);try{let e=await re(Yt);if(e.exists()){let t=e.data();o({compras:(t.compras??0).toString(),ventas:(t.ventas??0).toString(),gastos:(t.gastos??0).toString(),ventasMenores:(t.ventasMenores??0).toString(),remisiones:(t.remisiones??0).toString()})}else f(`No se encontro el documento de consecutivos en la base de datos.`)}catch(e){console.error(`Error al cargar consecutivos:`,e),f(`No se pudieron cargar los consecutivos. Intenta nuevamente.`)}c(!1)})()},[]),(0,H.useEffect)(()=>{n&&S(e=>e.deviceId&&e.ownerUid?e:{...e,deviceId:e.deviceId||n,ownerUid:e.ownerUid||t?.uid||``})},[n,t?.uid]),(0,H.useEffect)(()=>{if(!i)return;let e=L(J,`consecutivo_bloques`),t=B(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{let n=String(e.modulo||``).localeCompare(String(t.modulo||``));return n===0?String(e.deviceId||``).localeCompare(String(t.deviceId||``)):n});m(t),g(!1)},e=>{console.error(`Error al escuchar bloques de consecutivos:`,e),g(!1)});return()=>t()},[i]);let w=e=>{let{name:t,value:n}=e.target;/^\d*$/.test(n)&&o(e=>({...e,[t]:n}))},T=async e=>{if(e.preventDefault(),!i){alert(`Solo un administrador puede modificar los consecutivos.`);return}let t={compras:Xt(a.compras),ventas:Xt(a.ventas),gastos:Xt(a.gastos),ventasMenores:Xt(a.ventasMenores),remisiones:Xt(a.remisiones)};u(!0),f(``);try{await O(Yt,t),o({compras:t.compras.toString(),ventas:t.ventas.toString(),gastos:t.gastos.toString(),ventasMenores:t.ventasMenores.toString(),remisiones:t.remisiones.toString()}),f(`Consecutivos globales actualizados.`)}catch(e){console.error(`Error al actualizar consecutivos:`,e),f(`No se pudieron actualizar los consecutivos. Intentalo de nuevo.`)}u(!1)},E=e=>{let{name:t,value:n}=e.target;t===`tamano`&&!/^\d*$/.test(n)||S(e=>({...e,[t]:n}))},D=async()=>{if(x.modulo){b(!0),v(``);try{let e=Zt(x.tamano);await r({modulo:x.modulo,blockSize:e}),v(`Bloque reservado para este dispositivo (${n}) en ${x.modulo}.`)}catch(e){console.error(`Error al reservar bloque para dispositivo actual:`,e),v(e.message||`No se pudo reservar el bloque.`)}b(!1)}},k=async t=>{t.preventDefault();let n=String(x.deviceId||``).trim();if(!n){v(`Debes escribir un deviceId para reservar el bloque.`);return}let r=String(x.ownerUid||``).trim();if(!r){v(`Debes escribir el ownerUid del usuario que usara ese dispositivo.`);return}if(!C.includes(x.modulo)){v(`Modulo invalido para reservar bloque.`);return}b(!0),v(``);try{let t=Zt(x.tamano);await Ee({deviceId:n,ownerUid:r,modulo:x.modulo,blockSize:t,actor:e?.nombre||`ADMIN`}),v(`Bloque reservado: ${x.modulo} para ${n} (owner ${r}, tamano ${t}).`)}catch(e){console.error(`Error al reservar bloque manual:`,e),v(e.message||`No se pudo reservar el bloque manualmente.`)}b(!1)},A=(e,t,n)=>{let r=Xt(a[e]);return(0,K.jsxs)(`div`,{className:`configuracion-campo`,children:[(0,K.jsx)(`label`,{htmlFor:e,children:t}),(0,K.jsxs)(`div`,{className:`configuracion-input-row`,children:[(0,K.jsx)(`div`,{className:`configuracion-prefijo`,children:n}),(0,K.jsx)(`input`,{id:e,name:e,type:`text`,inputMode:`numeric`,pattern:`[0-9]*`,value:a[e],onChange:w,placeholder:`Ultimo consecutivo reservado`})]}),(0,K.jsxs)(`p`,{className:`configuracion-hint`,children:[`Siguiente valor global reservado: `,(0,K.jsx)(`strong`,{children:`${n}-${(r+1).toString().padStart(6,`0`)}`})]})]},e)},j=e=>{let t=Number(e?.inicio??0),n=Number(e?.fin??0),r=Number(e?.siguiente??0),i=Math.max(n-r+1,0);return{inicio:t,fin:n,siguiente:r,disponibles:i}};return e?i?(0,K.jsxs)(`div`,{className:`configuracion-container`,children:[(0,K.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,K.jsx)(`p`,{className:`configuracion-descripcion`,children:`Los consecutivos globales ahora reservan rangos para bloques por dispositivo. Cada equipo toma su bloque y puede operar offline.`}),s?(0,K.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos...`}):(0,K.jsxs)(`form`,{className:`configuracion-form`,onSubmit:T,children:[(0,K.jsxs)(`div`,{className:`configuracion-grid`,children:[A(`ventas`,`Factura de venta a proveedor`,`FAV`),A(`ventasMenores`,`Factura de venta menor`,`FAVMI`),A(`compras`,`Factura de compra`,`FAC`),A(`gastos`,`Comprobante de gasto`,`GAS`),A(`remisiones`,`Remisiones`,`REM`)]}),(0,K.jsx)(`button`,{type:`submit`,className:`configuracion-boton`,disabled:l,children:l?`Guardando...`:`Actualizar consecutivos globales`}),d&&(0,K.jsx)(`p`,{className:`configuracion-estado`,children:d})]}),(0,K.jsx)(`hr`,{style:{margin:`24px 0`}}),(0,K.jsxs)(`section`,{children:[(0,K.jsx)(`h2`,{children:`Bloques por dispositivo`}),(0,K.jsxs)(`p`,{children:[`Dispositivo actual: `,(0,K.jsx)(`strong`,{children:n})]}),(0,K.jsxs)(`form`,{onSubmit:k,style:{display:`grid`,gap:`8px`,maxWidth:`720px`},children:[(0,K.jsx)(`label`,{htmlFor:`bloqueDeviceId`,children:`Device ID`}),(0,K.jsx)(`input`,{id:`bloqueDeviceId`,name:`deviceId`,type:`text`,value:x.deviceId,onChange:E,placeholder:`ID del dispositivo destino`}),(0,K.jsx)(`label`,{htmlFor:`bloqueOwnerUid`,children:`Owner UID`}),(0,K.jsx)(`input`,{id:`bloqueOwnerUid`,name:`ownerUid`,type:`text`,value:x.ownerUid,onChange:E,placeholder:`UID del usuario propietario del bloque`}),(0,K.jsx)(`label`,{htmlFor:`bloqueModulo`,children:`Modulo`}),(0,K.jsx)(`select`,{id:`bloqueModulo`,name:`modulo`,value:x.modulo,onChange:E,children:C.map(e=>(0,K.jsx)(`option`,{value:e,children:e},e))}),(0,K.jsx)(`label`,{htmlFor:`bloqueTamano`,children:`Tamano del bloque`}),(0,K.jsx)(`input`,{id:`bloqueTamano`,name:`tamano`,type:`text`,inputMode:`numeric`,value:x.tamano,onChange:E}),(0,K.jsxs)(`div`,{style:{display:`flex`,gap:`8px`,flexWrap:`wrap`},children:[(0,K.jsx)(`button`,{type:`button`,onClick:D,disabled:y,children:y?`Reservando...`:`Reservar para este dispositivo`}),(0,K.jsx)(`button`,{type:`submit`,disabled:y,children:y?`Reservando...`:`Reservar/Reasignar manualmente`})]})]}),_&&(0,K.jsx)(`p`,{className:`configuracion-estado`,children:_}),h?(0,K.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando bloques...`}):(0,K.jsx)(`div`,{style:{overflowX:`auto`,marginTop:`12px`},children:(0,K.jsxs)(`table`,{className:`configuracion-tabla-bloques`,style:{width:`100%`,borderCollapse:`collapse`},children:[(0,K.jsx)(`thead`,{children:(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`th`,{children:`Modulo`}),(0,K.jsx)(`th`,{children:`Device ID`}),(0,K.jsx)(`th`,{children:`Owner UID`}),(0,K.jsx)(`th`,{children:`Inicio`}),(0,K.jsx)(`th`,{children:`Fin`}),(0,K.jsx)(`th`,{children:`Siguiente`}),(0,K.jsx)(`th`,{children:`Disponibles`}),(0,K.jsx)(`th`,{children:`Tamano`}),(0,K.jsx)(`th`,{children:`Asignado por`})]})}),(0,K.jsx)(`tbody`,{children:p.length===0?(0,K.jsx)(`tr`,{children:(0,K.jsx)(`td`,{colSpan:`9`,style:{textAlign:`center`},children:`No hay bloques asignados.`})}):p.map(e=>{let t=j(e);return(0,K.jsxs)(`tr`,{children:[(0,K.jsx)(`td`,{children:e.modulo||`N/A`}),(0,K.jsx)(`td`,{children:e.deviceId||`N/A`}),(0,K.jsx)(`td`,{children:e.ownerUid||`N/A`}),(0,K.jsx)(`td`,{children:t.inicio}),(0,K.jsx)(`td`,{children:t.fin}),(0,K.jsx)(`td`,{children:t.siguiente}),(0,K.jsx)(`td`,{children:t.disponibles}),(0,K.jsx)(`td`,{children:e.tamano||`-`}),(0,K.jsx)(`td`,{children:e.asignadoPor||`SISTEMA`})]},e.id)})})]})})]})]}):(0,K.jsxs)(`div`,{className:`configuracion-container`,children:[(0,K.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,K.jsx)(`p`,{className:`configuracion-alerta`,children:`Solo los administradores pueden gestionar consecutivos y bloques.`})]}):(0,K.jsxs)(`div`,{className:`configuracion-container`,children:[(0,K.jsx)(`h1`,{children:`Configuracion de consecutivos`}),(0,K.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos de usuario...`})]})}var $t=Qt;function en(){return(0,K.jsxs)(f,{children:[(0,K.jsxs)(v,{element:(0,K.jsx)(g,{}),children:[(0,K.jsx)(v,{path:`/login`,element:(0,K.jsx)(Dt,{})}),(0,K.jsx)(v,{path:`/imprimir`,element:(0,K.jsx)(Jt,{})})]}),(0,K.jsxs)(v,{element:(0,K.jsx)(He,{}),children:[(0,K.jsx)(v,{path:`/`,element:(0,K.jsx)(Ge,{})}),(0,K.jsx)(v,{path:`/articulos`,element:(0,K.jsx)(Xe,{})}),(0,K.jsx)(v,{path:`/proveedores`,element:(0,K.jsx)(Qe,{})}),(0,K.jsx)(v,{path:`/compras`,element:(0,K.jsx)(st,{})}),(0,K.jsx)(v,{path:`/ventas`,element:(0,K.jsx)(dt,{})}),(0,K.jsx)(v,{path:`/gastos`,element:(0,K.jsx)(ht,{})}),(0,K.jsx)(v,{path:`/reportes`,element:(0,K.jsx)(St,{})}),(0,K.jsx)(v,{path:`/ventas-menores`,element:(0,K.jsx)(jt,{})}),(0,K.jsx)(v,{path:`/usuarios`,element:(0,K.jsx)(Nt,{})}),(0,K.jsx)(v,{path:`/remisiones`,element:(0,K.jsx)(zt,{})}),(0,K.jsx)(v,{path:`/configuracion`,element:(0,K.jsx)($t,{})})]})]})}var tn=en;const nn=typeof window<`u`&&(`__TAURI__`in window||`__TAURI_INTERNALS__`in window);var rn=`/NASASHE-S.A.S/`,an=rn.startsWith(`/`)&&rn!==`/`?rn.replace(/\/$/,``):void 0,on=nn?_:h,sn=nn?{}:{basename:an};ue.createRoot(document.getElementById(`root`)).render((0,K.jsx)(H.StrictMode,{children:(0,K.jsx)(Pe,{children:(0,K.jsx)(on,{...sn,children:(0,K.jsx)(tn,{})})})}));