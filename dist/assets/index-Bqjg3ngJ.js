import{r as e}from"./rolldown-runtime-D7zIpOPY.js";import{a as t,c as n,i as r,l as i,n as a,o,r as s,s as c,t as l,u}from"./charts-tT8kpEU2.js";import{a as d,c as f,i as p,l as m,n as h,o as g,r as _,s as v,t as y}from"./react-A5e_vJlJ.js";import{i as b,n as x,t as S}from"./pdf-tools-DxzMBTSY.js";import{C,S as w,T,_ as E,a as D,b as O,c as k,d as A,f as j,g as M,h as N,i as P,l as ee,m as F,n as I,o as te,p as ne,r as L,s as R,t as z,u as re,v as B,w as ie,x as ae,y as oe}from"./firebase-NWVzjcQv.js";import{Ft as se,Pt as ce}from"./vendor-Dx7PxmPg.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var le=e(m()),V=e(u()),H=e(i());function ue({texto:e,icono:t,to:n}){return(0,H.jsxs)(_,{to:n,className:`header-button`,children:[(0,H.jsx)(`img`,{src:t,alt:e,className:`header-button-icon`}),(0,H.jsx)(`span`,{children:e})]})}var U=ue,W=T({apiKey:`AIzaSyBsAP-bhieVtVkPglMBsf5lben2JuUEcf0`,authDomain:`nasashe-chatarreria.firebaseapp.com`,projectId:`nasashe-chatarreria`,storageBucket:`nasashe-chatarreria.firebasestorage.app`,messagingSenderId:`401122117055`,appId:`1:401122117055:web:0b48451b9b4d5291cacd0a`});const G=ee(W,{localCache:j({tabManager:ne()})}),de=ae(W);console.log(`¬°Persistencia local activada con el m√©todo moderno! üöÄ`);var K=(0,V.createContext)(),fe=L(G,`movimientos_caja`),pe=D(G,`configuracion`,`consecutivos`),me=()=>sessionStorage.getItem(`baseEstablecida`)===`true`,he=e=>{let t=Number(e);return Number.isFinite(t)?t:0},ge=e=>{let t=0;return e.forEach(e=>{let n=e.data();if(n?.anulado===!0)return;let r=he(n?.monto);if(n?.tipo===`ingreso`){t+=Math.abs(r);return}if(n?.tipo===`egreso`){t-=Math.abs(r);return}n?.tipo===`ajuste`&&(t+=r)}),t};function _e({children:e}){let[t,n]=(0,V.useState)(0),[r,i]=(0,V.useState)(0),[a,o]=(0,V.useState)(0),[s,c]=(0,V.useState)({}),[l,u]=(0,V.useState)(me),[d,f]=(0,V.useState)(null),[p,m]=(0,V.useState)(!0),[h,g]=(0,V.useState)(null);(0,V.useEffect)(()=>{let e=()=>{},t=()=>{},r=w(de,async r=>{if(f(r),e(),t(),r)try{let a=D(G,`usuarios`,r.uid),s=await te(a);s.exists()?g(s.data()):(console.error(`No se encontro el perfil de usuario en Firestore.`),g(null)),e=re(fe,e=>{let t=ge(e);i(t),me()&&n(t)},e=>{console.error(`Error al escuchar movimientos de caja: `,e)}),t=re(pe,e=>{if(e.exists()){let t=e.data();o(t.compras??0),c(t)}else alert(`Error de configuracion: no se encontro el documento 'consecutivos'.`)},e=>{console.error(`Error al escuchar consecutivos: `,e)})}catch(e){console.error(`Error al cargar datos iniciales: `,e)}else n(0),i(0),u(!1),g(null),sessionStorage.removeItem(`baseEstablecida`);m(!1)});return()=>{r(),e(),t()}},[]);let _=()=>h?.nombre||d?.displayName||d?.email||`SISTEMA`,v=async({tipo:e,monto:t,descripcion:n=``,referencia:r=null})=>{let i=Number(t);if(!Number.isFinite(i))throw Error(`El monto del movimiento no es valido.`);if((e===`ingreso`||e===`egreso`)&&i<=0)throw Error(`El monto debe ser mayor que cero.`);if(e===`ajuste`&&i===0)throw Error(`El ajuste no puede ser cero.`);let a={tipo:e,monto:e===`ajuste`?i:Math.abs(i),descripcion:n.trim(),fecha:z.now(),usuario:_(),anulado:!1};r?.coleccion&&r?.id&&(a.referencia=r),await I(fe,a)},y={base:t,baseGuardada:r,baseEstablecida:l,establecerBase:async(e,t={})=>{let{registrarMovimiento:i=!0}=t,a=Number(e);if(!Number.isFinite(a)||a<0){alert(`Ingresa un monto valido de base.`);return}try{if(i){let e=a-r;e!==0&&await v({tipo:`ajuste`,monto:e,descripcion:`Ajuste manual de base de caja`})}n(a),u(!0),sessionStorage.setItem(`baseEstablecida`,`true`)}catch(e){console.error(`Error al establecer la base:`,e),alert(`No se pudo establecer la base: ${e.message}`)}},restarDeLaBase:async(e,n=`Salida manual de caja`)=>{let r=Number(e);if(!Number.isFinite(r)||r<=0){alert(`El monto a restar debe ser mayor que cero.`);return}if(r>t){alert(`El monto a restar supera la base actual.`);return}try{await v({tipo:`egreso`,monto:r,descripcion:n})}catch(e){console.error(`Error al restar de la base:`,e),alert(`No se pudo restar de la base: ${e.message}`)}},sumarALaBase:async(e,t=`Ingreso manual de caja`)=>{let n=Number(e);if(!Number.isFinite(n)||n<=0){alert(`El monto a agregar debe ser mayor que cero.`);return}try{await v({tipo:`ingreso`,monto:n,descripcion:t})}catch(e){console.error(`Error al sumar a la base:`,e),alert(`No se pudo agregar a la base: ${e.message}`)}},registrarMovimientoCaja:v,anularMovimientoCaja:async(e,t=``)=>{if(!e)throw Error(`Debe indicar el ID del movimiento a anular.`);let n=D(G,`movimientos_caja`,e);await E(n,{anulado:!0,motivoAnulacion:t.trim()||`Sin motivo`,fechaAnulacion:z.now(),usuarioAnulacion:_()})},currentUser:d,loadingAuth:p,userProfile:h,setBase:n,consecutivos:a,consecutivosData:s};return p?null:(0,H.jsx)(K.Provider,{value:y,children:e})}function q(){let e=(0,V.useContext)(K);if(!e)throw Error(`useCaja debe ser usado dentro de un CajaProvider`);return e}function ve(){let{userProfile:e}=q(),t=e?.rol===`admin`;return(0,H.jsxs)(`header`,{className:`header-principal`,children:[(0,H.jsxs)(_,{to:`/`,className:`header-logo-link`,children:[(0,H.jsx)(`img`,{src:`/logo.png`,alt:`Logo Nasashe`,className:`header-logo-img`}),(0,H.jsxs)(`div`,{className:`header-logo`,children:[`NASASHE`,(0,H.jsx)(`span`,{children:`CHATARRERIA`})]})]}),(0,H.jsxs)(`nav`,{className:`header-nav`,children:[t&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(U,{texto:`Art√≠culos`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,H.jsx)(U,{texto:`Proveedores`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,H.jsx)(U,{texto:`Ventas`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,H.jsx)(U,{texto:`Remisiones`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,H.jsx)(U,{texto:`Usuarios`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,H.jsx)(U,{texto:`Configuraci√≥n`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,H.jsx)(U,{texto:`Reportes`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,H.jsx)(U,{texto:`Compras`,icono:`/icons/Compras.png`,to:`/compras`}),(0,H.jsx)(U,{texto:`Gastos`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,H.jsx)(U,{texto:`Venta Menor`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var ye=ve;function be(){let{base:e,userProfile:t,sumarALaBase:n}=q(),r=new Date().toLocaleDateString(),i=e<3e5,a=async()=>{if(window.confirm(`¬øEst√°s seguro de que deseas cerrar sesi√≥n?`))try{await ie(de)}catch(e){console.error(`Error al cerrar sesi√≥n: `,e),alert(`Error al cerrar sesi√≥n.`)}},o=t?t.nombre:`Cargando...`;return(0,H.jsxs)(`footer`,{className:`footer-principal`,children:[(0,H.jsxs)(`div`,{className:`footer-user`,children:[`Usuario: **`,o,`** |`,(0,H.jsx)(`a`,{href:`#`,onClick:a,style:{color:`black`,marginLeft:`40px`,textDecoration:`underline`,cursor:`pointer`},children:`Salir`})]}),(0,H.jsxs)(`div`,{className:`footer-base`,children:[(0,H.jsxs)(`div`,{className:`base-valor`,children:[`Base en Caja: $`,e.toLocaleString(`es-CO`)]}),i&&(0,H.jsx)(`div`,{className:`base-alerta`,children:`‚ö†Ô∏è Base por debajo de $300.000. Agrega m√°s base.`})]}),(0,H.jsxs)(`div`,{className:`footer-actions`,children:[(0,H.jsx)(`button`,{type:`button`,className:`btn-agregar-base`,onClick:async()=>{let e=window.prompt(`¬øCu√°nto deseas agregar a la base?`,`0`);if(e===null)return;let t=e.replace(/[^0-9.,-]/g,``).replace(`,`,`.`),r=Number(t);if(Number.isNaN(r)||r<=0){alert(`Ingresa un monto v√°lido mayor que cero.`);return}let i=window.prompt(`Descripci√≥n del ingreso manual:`,`Ingreso manual de caja`)||`Ingreso manual de caja`;await n(r,i)},children:`A√±adir base`}),(0,H.jsx)(`div`,{className:`footer-fecha`,children:r})]})]})}var xe=be;function Se({baseAnterior:e,onContinuar:t,onNuevaBase:n}){let[r,i]=(0,V.useState)(!1),[a,o]=(0,V.useState)(``);return(0,H.jsx)(`div`,{className:`modal-overlay`,children:(0,H.jsxs)(`div`,{className:`modal-content`,children:[(0,H.jsx)(`h2`,{children:`Bienvenido`}),(0,H.jsx)(`p`,{children:`¬øDesea continuar con la base en caja anterior?`}),(0,H.jsxs)(`div`,{className:`base-anterior`,children:[`$`,e.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`div`,{className:`modal-actions`,children:[(0,H.jsx)(`button`,{className:`btn-continuar`,onClick:()=>t(e),children:`S√≠, continuar`}),(0,H.jsx)(`button`,{className:`btn-nueva`,onClick:()=>i(!0),children:`No, ingresar nueva base`})]}),r&&(0,H.jsxs)(`form`,{onSubmit:e=>{e.preventDefault();let t=Number(a);t>0?n(t):alert(`Por favor, ingrese un monto v√°lido.`)},className:`nueva-base-form`,children:[(0,H.jsx)(`label`,{htmlFor:`nuevaBase`,children:`Monto de la nueva base:`}),(0,H.jsx)(`input`,{id:`nuevaBase`,type:`number`,placeholder:`0`,value:a,onChange:e=>o(e.target.value),autoFocus:!0}),(0,H.jsx)(`button`,{type:`submit`,className:`btn-continuar`,children:`Guardar Nueva Base`})]})]})})}var Ce=Se;function we(){let{currentUser:e,baseEstablecida:t,baseGuardada:n,establecerBase:r}=q();return e?e&&!t?(0,H.jsx)(Ce,{baseAnterior:n,onContinuar:e=>r(e,{registrarMovimiento:!1}),onNuevaBase:e=>r(e,{registrarMovimiento:!0})}):(0,H.jsxs)(`div`,{className:`app-container`,children:[(0,H.jsx)(ye,{}),(0,H.jsxs)(`main`,{className:`main-content`,children:[(0,H.jsx)(d,{}),` `]}),(0,H.jsx)(xe,{})]}):(0,H.jsx)(p,{to:`/login`,replace:!0})}var Te=we;function Ee({titulo:e,descripcion:t,icono:n,to:r}){return(0,H.jsxs)(_,{to:r,className:`module-button`,children:[(0,H.jsx)(`img`,{src:n,alt:e,className:`module-icon`}),(0,H.jsxs)(`div`,{className:`module-text`,children:[(0,H.jsx)(`h3`,{children:e}),(0,H.jsx)(`p`,{children:t})]})]})}var J=Ee;function De(){let{userProfile:e}=q(),t=e?.rol===`admin`;return(0,H.jsxs)(`div`,{className:`dashboard-container`,children:[(0,H.jsx)(`h1`,{className:`dashboard-title`,children:`Bienvenido(a) a NASASHE. ¬°Haz clic en alg√∫n m√≥dulo para empezar!`}),(0,H.jsxs)(`div`,{className:`dashboard-grid`,children:[t&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(J,{titulo:`Art√≠culos`,descripcion:`Gestionar inventario, precios y categor√≠as.`,icono:`/icons/Art√≠culos.png`,to:`/articulos`}),(0,H.jsx)(J,{titulo:`Proveedores`,descripcion:`Administrar lista de proveedores y cuentas.`,icono:`/icons/Proveedores.png`,to:`/proveedores`}),(0,H.jsx)(J,{titulo:`Ventas`,descripcion:`Crear facturas de venta a proveedores.`,icono:`/icons/Ventas (F2).png`,to:`/ventas`}),(0,H.jsx)(J,{titulo:`Remisiones`,descripcion:`Emitir remisiones y generar PDF firmado.`,icono:`/icons/Remisiones.png`,to:`/remisiones`}),(0,H.jsx)(J,{titulo:`Usuarios`,descripcion:`Gestionar cuentas de empleados.`,icono:`/icons/usuarios.png`,to:`/usuarios`}),(0,H.jsx)(J,{titulo:`Configuraci√≥n`,descripcion:`Restablecer consecutivos y ajustes generales.`,icono:`/icons/CONFIG.png`,to:`/configuracion`})]}),(0,H.jsx)(J,{titulo:`Reportes`,descripcion:`Ver res√∫menes de ventas, caja e inventario.`,icono:`/icons/Reportes.png`,to:`/reportes`}),(0,H.jsx)(J,{titulo:`Compras`,descripcion:`Registrar compras a recicladores.`,icono:`/icons/Compras.png`,to:`/compras`}),(0,H.jsx)(J,{titulo:`Gastos`,descripcion:`Registrar salidas de efectivo (ej. comida).`,icono:`/icons/gastos.png`,to:`/gastos`}),(0,H.jsx)(J,{titulo:`Venta Menor`,descripcion:`Registrar ventas a particulares (ej. tubos).`,icono:`/icons/ventas-menores.png`,to:`/ventas-menores`})]})]})}var Oe=De,ke=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),Ae=async()=>{for(let e of[`@tauri-apps/plugin-dialog`,`@tauri-apps/api/dialog`]){let t=await b(()=>import(e),[]).catch(()=>null);if(t?.message)return t.message}return null};async function Y(e,t={}){if(ke()){let n=await Ae();if(n)return n(e,t)}if(t?.title){alert(`${t.title}: ${e}`);return}alert(e)}var je=`ACERO.jpg,ALUMINIO.jpg,ANTIMONIO.jpg,ARCHIVO.jpg,BATERIA_1_GRUPO.jpg,BATERIA_2_GRUPO.jpg,BATERIA_3_GRUPO.jpg,BATERIA_4_GRUPO.jpg,BATERIA_5_GRUPO.jpg,BATERIA_7_GRUPO.jpg,BATERIA_8_GRUPO.jpg,BATERIA_PEQUE√ëA.jpg,BRONCE.jpg,CANASTA.jpg,CARTON.jpg,COBRE.jpg,COBRE_CABLE.jpg,HIERRO.jpg,OTRO.jpg,PASTA.jpg,PERFIL.jpg,PET.jpg,PLAQUETA_1.jpg,PLAQUETA_2.jpg,PLAQUETA_3.jpg,PLAQUETA_BAJA.jpg,PLAQUETA_CELULAR.jpg,PLAQUETA_DECO.jpg,PLOMO.jpg,POTE.jpg,POTE_DE_ALUMINIO.jpg,RADIADOR_ALUMINIO.jpg,RADIADOR_BRONCE.jpg,RADIADOR_COBRE.jpg,RADIADOR_MIXTO.jpg,SCARP_LIMPIO.jpg,SCARP_SUCIO.jpg,SILLA.jpg,TANQUE.jpg,TANQUE_METALICO.jpg,VOLUMEN_HIERRO.jpg`.split(`,`);function Me(){let[e,t]=(0,V.useState)(!0),[n,r]=(0,V.useState)([]),[i,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(``),[c,l]=(0,V.useState)(``),[u,d]=(0,V.useState)(``),[f,p]=(0,V.useState)(``),[m,h]=(0,V.useState)(null),[g,_]=(0,V.useState)({nombre:``,precioCompra:``,precioVenta:``,stock:``,imagenUrl:``}),v=async()=>{t(!0);try{let e=(await R(L(G,`articulos`))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,V.useEffect)(()=>{v()},[]);let y=async e=>{e.preventDefault();let t=Number(o),n=Number(c),r=Number(u);if(!i||t<=0||n<=0){await Y(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await I(L(G,`articulos`),{nombre:i.toUpperCase(),precioCompra:t,precioVenta:n,stock:r||0,imagenUrl:f||``}),a(``),s(``),l(``),d(``),p(``),await v()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},b=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este art√≠culo?`))try{let t=D(G,`articulos`,e);await P(t),await v()}catch(e){console.error(`Error al eliminar el documento: `,e)}},x=e=>{let{name:t,value:n}=e.target,r=n;t===`nombre`?r=n.toUpperCase():(t===`precioCompra`||t===`precioVenta`||t===`stock`)&&(r=n.replace(/[^0-9]/g,``)),_(e=>({...e,[t]:r}))},S=e=>{h(e.id),_({nombre:e.nombre,precioCompra:e.precioCompra,precioVenta:e.precioVenta,stock:e.stock,imagenUrl:e.imagenUrl||``})},C=()=>{h(null)},w=async e=>{e.preventDefault();let t=D(G,`articulos`,m),n={nombre:g.nombre.toUpperCase(),precioCompra:Number(g.precioCompra),precioVenta:Number(g.precioVenta),stock:Number(g.stock)||0,imagenUrl:g.imagenUrl||``};if(!n.nombre||n.precioCompra<=0||n.precioVenta<=0){await Y(`Por favor, completa Nombre y ambos Precios con valores v√°lidos.`,{title:`Nasashe sas`,type:`warning`});return}try{await E(t,n),h(null),await v()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,H.jsxs)(`div`,{className:`pagina-articulos`,children:[(0,H.jsx)(`h1`,{children:`M√≥dulo de Art√≠culos`}),(0,H.jsx)(`p`,{children:`Aqu√≠ puedes gestionar tu inventario.`}),(0,H.jsxs)(`div`,{className:`form-container`,children:[(0,H.jsx)(`h2`,{children:`A√±adir Nuevo Art√≠culo`}),(0,H.jsxs)(`form`,{onSubmit:y,children:[(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,H.jsx)(`input`,{id:`nuevoNombre`,type:`text`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoPrecioCompra`,children:`Precio Compra:`}),(0,H.jsx)(`input`,{id:`nuevoPrecioCompra`,type:`text`,value:o,onChange:e=>s(e.target.value.replace(/[^0-9]/g,``))})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoPrecioVenta`,children:`Precio Venta:`}),(0,H.jsx)(`input`,{id:`nuevoPrecioVenta`,type:`text`,value:c,onChange:e=>l(e.target.value.replace(/[^0-9]/g,``))})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoStock`,children:`Stock:`}),(0,H.jsx)(`input`,{id:`nuevoStock`,type:`text`,value:u,onChange:e=>d(e.target.value.replace(/[^0-9]/g,``))})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevaImagenUrl`,children:`Imagen:`}),(0,H.jsxs)(`select`,{id:`nuevaImagenUrl`,value:f,onChange:e=>p(e.target.value),children:[(0,H.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),je.map(e=>(0,H.jsx)(`option`,{value:`/icons/${e}`,children:e},e))]})]}),(0,H.jsx)(`button`,{type:`submit`,children:`Guardar Art√≠culo`})]})]}),(0,H.jsx)(`h2`,{children:`Inventario Actual en Firebase`}),e?(0,H.jsx)(`p`,{children:`Cargando...`}):(0,H.jsxs)(`table`,{className:`articulos-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{className:`articulo-imagen-header`,children:`Imagen`}),(0,H.jsx)(`th`,{children:`Nombre`}),(0,H.jsx)(`th`,{children:`Precio Compra`}),(0,H.jsx)(`th`,{children:`Precio Venta`}),(0,H.jsx)(`th`,{children:`Stock`}),(0,H.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:n.map(e=>(0,H.jsx)(`tr`,{className:m===e.id?`edit-row`:``,children:m===e.id?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(`td`,{className:`articulo-imagen-cell`,children:(0,H.jsxs)(`select`,{name:`imagenUrl`,value:g.imagenUrl,onChange:x,children:[(0,H.jsx)(`option`,{value:``,children:`-- Sin imagen --`}),je.map(e=>(0,H.jsx)(`option`,{value:`/icons/${e}`,children:e},e))]})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`nombre`,value:g.nombre,onChange:x})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`precioCompra`,value:g.precioCompra,onChange:x})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`precioVenta`,value:g.precioVenta,onChange:x})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`stock`,value:g.stock,onChange:x})}),(0,H.jsxs)(`td`,{className:`acciones-cell`,children:[(0,H.jsx)(`button`,{onClick:w,className:`btn-guardar`,children:`Guardar`}),(0,H.jsx)(`button`,{type:`button`,onClick:C,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(`td`,{className:`articulo-imagen-cell`,children:e.imagenUrl&&(0,H.jsx)(`img`,{src:e.imagenUrl,alt:e.nombre})}),(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`td`,{children:[`$`,e.precioVenta.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)}),(0,H.jsxs)(`td`,{className:`acciones-cell`,children:[(0,H.jsx)(`button`,{onClick:()=>S(e),className:`btn-editar`,children:`Editar`}),(0,H.jsx)(`button`,{onClick:()=>b(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var Ne=Me;function Pe(){let[e,t]=(0,V.useState)(!0),[n,r]=(0,V.useState)([]),[i,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(``),[c,l]=(0,V.useState)(``),[u,d]=(0,V.useState)(``),[f,p]=(0,V.useState)(``),[m,h]=(0,V.useState)(``),[g,_]=(0,V.useState)(null),[v,y]=(0,V.useState)({nombre:``,telefono:``,email:``,nit:``,direccion:``,material:``}),b=async()=>{t(!0);try{let e=(await R(L(G,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));r(e),t(!1)}catch(e){console.error(`Error al traer los datos: `,e),t(!1)}};(0,V.useEffect)(()=>{b()},[]);let x=async e=>{if(e.preventDefault(),!i||!u){alert(`Por favor, completa el Nombre y el NIT.`);return}try{await I(L(G,`proveedores`),{nombre:i.toUpperCase(),telefono:o,email:c,nit:u,direccion:f,material:m.toUpperCase()}),a(``),s(``),l(``),d(``),p(``),h(``),await b()}catch(e){console.error(`Error al a√±adir el documento: `,e)}},S=async e=>{if(window.confirm(`¬øEst√°s seguro de que deseas eliminar este proveedor?`))try{let t=D(G,`proveedores`,e);await P(t),await b()}catch(e){console.error(`Error al eliminar el documento: `,e)}},C=e=>{let{name:t,value:n}=e.target,r=n;(t===`nombre`||t===`material`)&&(r=n.toUpperCase()),y(e=>({...e,[t]:r}))},w=e=>{_(e.id),y({nombre:e.nombre,telefono:e.telefono,email:e.email,nit:e.nit,direccion:e.direccion,material:e.material})},T=()=>{_(null)},O=async e=>{e.preventDefault();let t=D(G,`proveedores`,g);if(!v.nombre||!v.nit){alert(`Por favor, completa el Nombre y el NIT.`);return}let n={nombre:v.nombre.toUpperCase(),telefono:v.telefono,email:v.email,nit:v.nit,direccion:v.direccion,material:v.material.toUpperCase()};try{await E(t,n),_(null),await b()}catch(e){console.error(`Error al actualizar el documento: `,e)}};return(0,H.jsxs)(`div`,{className:`pagina-proveedores`,children:[(0,H.jsx)(`h1`,{children:`M√≥dulo de Proveedores`}),(0,H.jsxs)(`div`,{className:`form-container`,children:[(0,H.jsx)(`h2`,{children:`A√±adir Nuevo Proveedor`}),(0,H.jsxs)(`form`,{onSubmit:x,children:[(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoNombre`,children:`Nombre:`}),(0,H.jsx)(`input`,{id:`nuevoNombre`,type:`text`,name:`nombre`,value:i,onChange:e=>a(e.target.value.toUpperCase())})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoNit`,children:`NIT:`}),(0,H.jsx)(`input`,{id:`nuevoNit`,type:`text`,name:`nit`,value:u,onChange:e=>d(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoTelefono`,children:`Tel√©fono:`}),(0,H.jsx)(`input`,{id:`nuevoTelefono`,type:`text`,name:`telefono`,value:o,onChange:e=>s(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoEmail`,children:`Email:`}),(0,H.jsx)(`input`,{id:`nuevoEmail`,type:`email`,name:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoDireccion`,children:`Direcci√≥n:`}),(0,H.jsx)(`input`,{id:`nuevoDireccion`,type:`text`,name:`direccion`,value:f,onChange:e=>p(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{htmlFor:`nuevoMaterial`,children:`Material:`}),(0,H.jsx)(`input`,{id:`nuevoMaterial`,type:`text`,name:`material`,value:m,onChange:e=>h(e.target.value.toUpperCase())})]}),(0,H.jsx)(`button`,{type:`submit`,children:`Guardar Proveedor`})]})]}),(0,H.jsx)(`h2`,{children:`Lista de Proveedores`}),e?(0,H.jsx)(`p`,{children:`Cargando...`}):(0,H.jsxs)(`table`,{className:`proveedores-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Nombre`}),(0,H.jsx)(`th`,{children:`NIT`}),(0,H.jsx)(`th`,{children:`Tel√©fono`}),(0,H.jsx)(`th`,{children:`Email`}),(0,H.jsx)(`th`,{children:`Direcci√≥n`}),(0,H.jsx)(`th`,{children:`Material`}),(0,H.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:n.map(e=>(0,H.jsx)(`tr`,{className:g===e.id?`edit-row`:``,children:g===e.id?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`nombre`,value:v.nombre,onChange:C})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`nit`,value:v.nit,onChange:C})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`telefono`,value:v.telefono,onChange:C})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`email`,name:`email`,value:v.email,onChange:C})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`direccion`,value:v.direccion,onChange:C})}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`input`,{type:`text`,name:`material`,value:v.material,onChange:C})}),(0,H.jsxs)(`td`,{className:`acciones-cell`,children:[(0,H.jsx)(`button`,{onClick:O,className:`btn-guardar`,children:`Guardar`}),(0,H.jsx)(`button`,{type:`button`,onClick:T,className:`btn-cancelar`,children:`Cancelar`})]})]}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{children:e.nit}),(0,H.jsx)(`td`,{children:e.telefono}),(0,H.jsx)(`td`,{children:e.email}),(0,H.jsx)(`td`,{children:e.direccion}),(0,H.jsx)(`td`,{children:e.material}),(0,H.jsxs)(`td`,{className:`acciones-cell`,children:[(0,H.jsx)(`button`,{onClick:()=>w(e),className:`btn-editar`,children:`Editar`}),(0,H.jsx)(`button`,{onClick:()=>S(e.id),className:`btn-borrar`,children:`Borrar`})]})]})},e.id))})]})]})}var X=Pe;const Fe=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e.reciclador||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE COMPRA`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Compra
`,a+=`Fecha: ${n}\n`,a+=`Facturado por: ${t?.nombre||`SISTEMA`}\n`,a+=`Reciclador: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioCompra.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,a+=i(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,a+=i(`¬° Gracias por su venta !`,45)+`
`,a},Ie=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.proveedor?.nombre||``).toString().trim()||`N/A`,i=(e?.proveedor?.nit||``).toString().trim()||`N/A`,a=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},o=a(`TICKET DE VENTA`,45)+`
`;return o+=a(`RECICLADORA NASASHE S.A.S`,45)+`
`,o+=a(`901907763-3`,45)+`
`,o+=a(`Calle 98#9B-35`,45)+`
`,o+=a(`Barranquilla - Atlantico`,45)+`
`,o+=a(`605-000-0000`,45)+`
`,o+=`-`.repeat(45)+`
`,o+=`Factura: ${e.consecutivo}\n`,o+=`Actividad: Venta
`,o+=`Fecha: ${n}\n`,o+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,o+=`Cliente: ${r}\n`,o+=`NIT: ${i}\n`,o+=`-`.repeat(45)+`
`,o+=`Material`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,o+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.nombre.length>18?e.nombre.substring(0,18):e.nombre,n=e.cantidad.toString(),r=e.precioVenta.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);o+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),o+=`-`.repeat(45)+`
`,o+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,o+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,o+=`-`.repeat(45)+`
`,o+=a(`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES`,45)+`
`,o+=a(`UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`,45)+`

`,o+=a(`¬° Gracias por su compra !`,45)+`
`,o},Le=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e?.cliente||``).toString().trim()||`N/A`,i=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},a=i(`TICKET DE VENTA MENOR`,45)+`
`;return a+=i(`RECICLADORA NASASHE S.A.S`,45)+`
`,a+=i(`901907763-3`,45)+`
`,a+=i(`Calle 98#9B-35`,45)+`
`,a+=i(`Barranquilla - Atlantico`,45)+`
`,a+=i(`605-000-0000`,45)+`
`,a+=`-`.repeat(45)+`
`,a+=`Factura: ${e.consecutivo}\n`,a+=`Actividad: Venta Menor
`,a+=`Fecha: ${n}\n`,a+=`Vendido por: ${t?.nombre||`SISTEMA`}\n`,a+=`Cliente: ${r}\n`,a+=`-`.repeat(45)+`
`,a+=`Descripci√≥n`.padEnd(19)+`Cant.`.padStart(6)+`Prec.`.padStart(9)+`Total`.padStart(11)+`
`,a+=`-`.repeat(45)+`
`,e.items.forEach(e=>{let t=e.descripcion.length>18?e.descripcion.substring(0,18):e.descripcion,n=e.cantidad.toString(),r=e.precio.toLocaleString(`es-CO`),i=e.subtotal.toLocaleString(`es-CO`);a+=t.padEnd(19)+n.padStart(6)+r.padStart(9)+i.padStart(11)+`
`}),a+=`-`.repeat(45)+`
`,a+=`Subtotal:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`IVA (0%):`.padEnd(10)+`$0`.padStart(35)+`
`,a+=`Total:`.padEnd(10)+`${e.total.toLocaleString(`es-CO`)}`.padStart(35)+`
`,a+=`-`.repeat(45)+`
`,a+=i(`¬° Gracias por su compra !`,45)+`
`,a},Re=(e,t)=>{let n=e.fecha.toDate?e.fecha.toDate().toLocaleString(`es-CO`):new Date(e.fecha).toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`COMPROBANTE DE SALIDA`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=r(`901907763-3`,45)+`
`,i+=r(`Calle 98#9B-35`,45)+`
`,i+=r(`Barranquilla - Atlantico`,45)+`
`,i+=r(`605-000-0000`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Comprobante: ${e.consecutivo}\n`,i+=`Actividad: Gasto / Egreso
`,i+=`Fecha: ${n}\n`,i+=`Registrado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`

`,i+=`Concepto: ${e.concepto}\n`,i+=`Descripci√≥n: ${e.descripcion}\n\n`,i+=`-`.repeat(45)+`
`,i+=`Total:`.padEnd(10)+`${e.monto.toLocaleString(`es-CO`)}`.padStart(35)+`
`,i+=`-`.repeat(45)+`

`,i+=`__________________________________
`,i+=r(`Firma Autorizado`,34)+`

`,i+=`__________________________________
`,i+=r(`Firma Recibido`,34)+`
`,i},ze=({titulo:e,textoTicket:t})=>{if(typeof window>`u`||typeof document>`u`)return!1;try{let n=document.createElement(`iframe`);n.style.position=`fixed`,n.style.right=`0`,n.style.bottom=`0`,n.style.width=`0`,n.style.height=`0`,n.style.border=`0`,n.style.visibility=`hidden`,n.setAttribute(`aria-hidden`,`true`),n.tabIndex=-1,document.body.appendChild(n);let r=n.contentWindow,i=r?.document;if(!r||!i)return document.body.removeChild(n),!1;let a=!1,o=()=>{n.parentNode&&n.parentNode.removeChild(n)},s=()=>{r.removeEventListener(`afterprint`,s),o()};return n.onload=()=>{r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error al intentar imprimir el ticket en el iframe:`,e),r.removeEventListener(`afterprint`,s),o()}},i.open(),i.write(`<!DOCTYPE html><html><head><title>${e}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${t}</pre></body></html>`),i.close(),setTimeout(()=>{if(!(a||!n.isConnected)){r.addEventListener(`afterprint`,s);try{r.focus(),r.print(),a=!0}catch(e){console.error(`Error en impresi√≥n de respaldo del ticket:`,e),o()}setTimeout(()=>{!a&&n.isConnected&&o()},1500)}},500),!0}catch(e){return console.error(`No se pudo preparar la impresi√≥n del ticket en el navegador:`,e),!1}};var Be=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,Ve=(e,t)=>`${t}${String(e).padStart(5,`0`)}`,He=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function Ue(){let{userProfile:e,base:t,consecutivos:n}=q(),[r,i]=(0,V.useState)(!0),[a,o]=(0,V.useState)(!1),[s,c]=(0,V.useState)([]),[l,u]=(0,V.useState)(``),[d,f]=(0,V.useState)(``),[p,m]=(0,V.useState)(``),[h,g]=(0,V.useState)(``),[_,v]=(0,V.useState)(``),[y,b]=(0,V.useState)(``),[x,S]=(0,V.useState)([]),[C,w]=(0,V.useState)(0),[T,E]=(0,V.useState)(null),[O,k]=(0,V.useState)(null);(0,V.useEffect)(()=>{i(!0);let e=L(G,`articulos`),t=re(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));c(t),i(!1),console.log(`¬°Art√≠culos cargados y cacheados con onSnapshot!`)},e=>{console.error(`Error al cargar art√≠culos con onSnapshot: `,e),i(!1)});return()=>{console.log(`Limpiando listener de Art√≠culos.`),t()}},[]),(0,V.useEffect)(()=>{let e=0;x.forEach(t=>{e+=t.subtotal}),w(e)},[x]);let A=e=>{let t=e.target.value;if(f(t),t!==`otros`&&(m(``),g(``)),t===`otros`){b(`/icons/OTRO.jpg`);return}if(t){let e=s.find(e=>e.id===t);e&&e.imagenUrl?b(e.imagenUrl):b(``)}else b(``)},j=()=>{if(!d||!_||Number(_)<=0){alert(`Seleccione un art√≠culo y una cantidad (peso) v√°lida.`);return}if(d===`otros`){let e=p.trim().toUpperCase(),t=Number(h),n=Number(_);if(!e||!t||t<=0){alert(`Ingrese un nombre y un precio de compra v√°lido para el material.`);return}let r=n*t;S(i=>[...i,{localId:Date.now(),articuloId:null,nombre:e,cantidad:n,precioCompra:t,subtotal:r,esManual:!0}]),f(``),m(``),g(``),v(``),b(``);return}let e=s.find(e=>e.id===d);if(!e){alert(`Error: Art√≠culo no encontrado.`);return}let t=Number(_),n=t*e.precioCompra;x.find(t=>t.articuloId===e.id)?S(r=>r.map(r=>r.articuloId===e.id?{...r,cantidad:r.cantidad+t,subtotal:r.subtotal+n}:r)):S(r=>[...r,{localId:Date.now(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioCompra:e.precioCompra,subtotal:n}]),f(``),v(``),b(``)},M=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&S(x.filter(t=>t.localId!==e))},N=e=>{k(t=>t===e?null:e)},P=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=n*e.precioCompra;return{...e,cantidad:n,subtotal:t}}return e}))},ee=(e,t)=>{let n=Number(e.target.value);n<=0||S(e=>e.map(e=>{if(e.localId===t){let t=e.cantidad*n;return{...e,precioCompra:n,subtotal:t}}return e}))},F=async()=>{if(x.length===0){alert(`No hay art√≠culos en la compra.`);return}o(!0);let r=null;try{let i=n,a=t,o=i+1,c=Ve(o,`FAC`);if(C>a)throw Error(`¬°Error! Fondos insuficientes. Base: $${a.toLocaleString(`es-CO`)}`);let d=l.trim().toUpperCase(),f={consecutivo:c,reciclador:d||`N/A`,items:x,total:C,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};r=f;let p=oe(G),m=D(L(G,`compras`)),h=D(G,`configuracion`,`consecutivos`),g=D(L(G,`movimientos_caja`));p.set(m,f),p.update(h,{compras:o}),p.set(g,{tipo:`egreso`,monto:C,descripcion:`Compra ${c} - ${d||`N/A`}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`compras`,id:m.id,consecutivo:c}}),x.forEach(e=>{if(e.esManual)return;let t=s.find(t=>t.id===e.articuloId);if(!t)throw Error(`Art√≠culo ${e.nombre} no encontrado en cach√©.`);let n=(t.stock||0)+e.cantidad,r=D(G,`articulos`,e.articuloId);p.update(r,{stock:n})}),await p.commit(),E(r),u(``),S([])}catch(e){console.error(`Error al guardar la compra: `,e),alert(`Error al guardar: ${e.message}`)}o(!1)},I=t=>{let n=Fe(t,e);ze({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return r?(0,H.jsx)(`p`,{children:`Cargando Art√≠culos...`}):(0,H.jsxs)(`div`,{className:`pagina-compras`,children:[(0,H.jsx)(`h1`,{children:`Registrar Nueva Compra (a Reciclador)`}),(0,H.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,H.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`layout-compras`,children:[(0,H.jsxs)(`div`,{className:`formulario-compra`,children:[(0,H.jsx)(`h2`,{children:`Datos de la Compra`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`reciclador`,children:`Nombre Reciclador (Opcional):`}),(0,H.jsx)(`input`,{id:`reciclador`,type:`text`,value:l,onChange:e=>u(e.target.value.toUpperCase()),disabled:T})]}),(0,H.jsx)(`hr`,{}),(0,H.jsx)(`h3`,{children:`A√±adir Art√≠culos`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`articulo`,children:`Art√≠culo:`}),(0,H.jsxs)(`select`,{id:`articulo`,value:d,onChange:A,disabled:T,children:[(0,H.jsx)(`option`,{value:``,children:`-- Seleccione un Art√≠culo --`}),(0,H.jsx)(`option`,{value:`otros`,children:`Otros (ingreso manual)`}),s.map(e=>(0,H.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioCompra,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),d===`otros`&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`nombreManual`,children:`Nombre del material:`}),(0,H.jsx)(`input`,{id:`nombreManual`,type:`text`,value:p,onChange:e=>m(e.target.value.toUpperCase()),disabled:T})]}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`precioManual`,children:`Precio compra:`}),(0,H.jsx)(`input`,{id:`precioManual`,type:`number`,value:h,onChange:e=>g(e.target.value),disabled:T})]})]}),(0,H.jsx)(`div`,{className:`imagen-preview-container`,children:y?(0,H.jsx)(`img`,{src:y,alt:`Vista previa del material`}):(0,H.jsx)(`span`,{style:{color:`#888`},children:`Imagen del material`})}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,H.jsx)(`input`,{id:`cantidad`,type:`number`,value:_,onChange:e=>v(e.target.value),disabled:T})]}),(0,H.jsx)(`button`,{type:`button`,onClick:j,className:`btn-anadir-item`,disabled:T,children:`A√±adir Item a la Compra`})]}),(0,H.jsxs)(`div`,{className:`pre-factura`,children:[(0,H.jsx)(`h2`,{children:`Items de la Compra`}),(0,H.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Art√≠culo`}),(0,H.jsx)(`th`,{children:`Cant.`}),(0,H.jsx)(`th`,{children:`Precio`}),(0,H.jsx)(`th`,{children:`Subtotal`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:(T?T.items:x).length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`A√±ade art√≠culos...`})}):(T?T.items:x).map((e,t)=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{children:O===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>P(t,e.localId),autoFocus:!0,style:{width:`70px`,padding:`3px`}}):(Number(e.cantidad)||0).toFixed(2)}),(0,H.jsx)(`td`,{children:O===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.precioCompra,onChange:t=>ee(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioCompra}`}),(0,H.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,H.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>N(e.localId),disabled:T,children:O===e.localId?`Listo`:`Editar`}),(0,H.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>M(e.localId),disabled:T,children:`Anular`})]})]},t))})]}),(0,H.jsxs)(`div`,{className:`total-compra`,children:[`Total: $`,(T?T.total:C).toLocaleString(`es-CO`)]}),(0,H.jsx)(`div`,{className:`botones-accion`,children:T?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(`p`,{className:`compra-exitosa`,children:[`¬°Compra `,T.consecutivo,` guardada!`]}),(0,H.jsx)(`button`,{type:`button`,onClick:async()=>{if(T)if(!Be())I(T);else{localStorage.setItem(`ticketData`,JSON.stringify(T)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`compra`);let t=`ticket-compra-${T.consecutivo.replace(/\s/g,`-`)}`;new ce(t,{url:`/imprimir`,title:`Ticket ${T.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),I(T)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{if(!T)return;let t=Fe(T,e);He(t,T.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{S([]),w(0),u(``),E(null),f(``),m(``),g(``),v(``),b(``)},className:`btn-nueva-compra`,children:`Registrar Nueva Compra`})]}):(0,H.jsx)(`button`,{type:`button`,onClick:F,className:`btn-guardar-compra`,disabled:a||x.length===0,children:a?`Guardando...`:`Guardar Compra`})})]})]})]})}var We=Ue,Ge=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,Ke=(e,t)=>`${t}${String(e).padStart(5,`0`)}`,qe=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function Je(){let{userProfile:e,base:t}=q(),[n,r]=(0,V.useState)(!0),[i,a]=(0,V.useState)(!1),[o,s]=(0,V.useState)([]),[c,l]=(0,V.useState)([]),[u,d]=(0,V.useState)(``),[f,p]=(0,V.useState)(``),[m,h]=(0,V.useState)(``),[g,_]=(0,V.useState)([]),[v,y]=(0,V.useState)(0),[b,x]=(0,V.useState)(null),[S,C]=(0,V.useState)(null),w=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,T=async()=>{r(!0);try{let e=(await R(L(G,`proveedores`))).docs.map(e=>({id:e.id,...e.data()}));s(e);let t=(await R(L(G,`articulos`))).docs.map(e=>({id:e.id,...e.data()}));l(t)}catch(e){console.error(`Error al cargar datos: `,e)}r(!1)};(0,V.useEffect)(()=>{T()},[]),(0,V.useEffect)(()=>{let e=0;g.forEach(t=>{e+=t.subtotal}),y(e)},[g]);let E=()=>{if(!f||!m||Number(m)<=0){alert(`Seleccione un art√≠culo y una cantidad (peso) v√°lida.`);return}let e=c.find(e=>e.id===f);if(!e){alert(`Error: Art√≠culo no encontrado.`);return}let t=Number(m),n=e.stock||0,r=g.find(t=>t.articuloId===e.id),i=r?r.cantidad:0;if(t+i>n){alert(`¬°No hay stock suficiente! Stock actual: ${n}, Quieres vender: ${t+i}`);return}let a=t*e.precioVenta;_(r?n=>n.map(n=>n.articuloId===e.id?{...n,cantidad:n.cantidad+t,subtotal:n.subtotal+a}:n):n=>[...n,{localId:w(),articuloId:e.id,nombre:e.nombre,cantidad:t,precioVenta:e.precioVenta,subtotal:a}]),p(``),h(``)},O=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&(_(t=>t.filter(t=>t.localId!==e)),C(t=>t===e?null:t))},k=e=>{C(t=>t===e?null:e)},A=(e,t)=>{let n=Number(e.target.value);n<=0||_(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precioVenta}:e))},j=(e,t)=>{let n=Number(e.target.value);n<=0||_(e=>e.map(e=>e.localId===t?{...e,precioVenta:n,subtotal:n*e.cantidad}:e))},M=async()=>{if(g.length===0){alert(`No hay art√≠culos en la venta.`);return}if(!u){alert(`Debe seleccionar un Proveedor (Cliente de Venta).`);return}a(!0);let t=null,n=``;try{let r=D(L(G,`ventas`)),i=o.find(e=>e.id===u);await N(G,async a=>{let o=D(G,`configuracion`,`consecutivos`),s=await a.get(o);if(!s.exists())throw Error(`Consecutivos no encontrados`);let c=g.map(e=>D(G,`articulos`,e.articuloId)),l=await Promise.all(c.map(e=>a.get(e))),u=s.data().ventas+1;n=Ke(u,`FAV`);let d={consecutivo:n,proveedor:{id:i.id,nombre:i.nombre,nit:i.nit},items:g,total:v,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};t=d,a.set(r,d),a.update(o,{ventas:u}),l.forEach((e,t)=>{if(!e.exists())throw Error(`Art√≠culo ${g[t].nombre} no encontrado`);let n=(e.data().stock||0)-g[t].cantidad;if(n<0)throw Error(`Stock insuficiente para ${g[t].nombre}`);a.update(e.ref,{stock:n})})}),await T(),x(t),d(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}a(!1)},P=t=>{let n=Ie(t,e);ze({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return n?(0,H.jsx)(`p`,{children:`Cargando datos maestros...`}):(0,H.jsxs)(`div`,{className:`pagina-ventas`,children:[(0,H.jsx)(`h1`,{children:`Registrar Nueva Venta (a Proveedor)`}),(0,H.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,H.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`layout-ventas`,children:[(0,H.jsxs)(`div`,{className:`formulario-venta`,children:[(0,H.jsx)(`h2`,{children:`Datos de la Venta`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`proveedor`,children:`Cliente (Proveedor al que Vendes):`}),(0,H.jsxs)(`select`,{id:`proveedor`,value:u,onChange:e=>d(e.target.value),disabled:b,children:[(0,H.jsx)(`option`,{value:``,children:`-- Seleccione un Cliente --`}),o.map(e=>(0,H.jsxs)(`option`,{value:e.id,children:[e.nombre,` (`,e.nit,`)`]},e.id))]})]}),(0,H.jsx)(`hr`,{}),(0,H.jsx)(`h3`,{children:`A√±adir Art√≠culos`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`articulo`,children:`Art√≠culo:`}),(0,H.jsxs)(`select`,{id:`articulo`,value:f,onChange:e=>p(e.target.value),disabled:b,children:[(0,H.jsx)(`option`,{value:``,children:`-- Seleccione un Art√≠culo --`}),c.map(e=>(0,H.jsxs)(`option`,{value:e.id,children:[e.nombre,` ($`,e.precioVenta,`/kg) - Stock: `,(Number(e.stock)||0).toFixed(2)]},e.id))]})]}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`cantidad`,children:`Cantidad (Peso):`}),(0,H.jsx)(`input`,{id:`cantidad`,type:`number`,value:m,onChange:e=>h(e.target.value),disabled:b})]}),(0,H.jsx)(`button`,{type:`button`,onClick:E,className:`btn-anadir-item-venta`,disabled:b,children:`A√±adir Item a la Venta`})]}),(0,H.jsxs)(`div`,{className:`pre-factura`,children:[(0,H.jsx)(`h2`,{children:`Items de la Venta`}),(0,H.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Art√≠culo`}),(0,H.jsx)(`th`,{children:`Cant.`}),(0,H.jsx)(`th`,{children:`Precio Venta`}),(0,H.jsx)(`th`,{children:`Subtotal`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:(b?b.items:g).length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√±ade art√≠culos...`})}):(b?b.items:g).map((e,t)=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{children:S===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>A(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,H.jsx)(`td`,{children:S===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.precioVenta,onChange:t=>j(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precioVenta}`}),(0,H.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,H.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>k(e.localId),disabled:b,children:S===e.localId?`Listo`:`Editar`}),(0,H.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>O(e.localId),disabled:b,children:`Anular`})]})]},e.localId||t))})]}),(0,H.jsxs)(`div`,{className:`total-venta`,children:[`Total: $`,(b?b.total:v).toLocaleString(`es-CO`)]}),(0,H.jsx)(`div`,{className:`botones-accion`,children:b?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(`p`,{className:`venta-exitosa`,children:[`¬°Venta `,b.consecutivo,` guardada!`]}),(0,H.jsx)(`button`,{type:`button`,onClick:async()=>{if(b)if(!Ge())P(b);else{localStorage.setItem(`ticketData`,JSON.stringify(b)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`venta`);let t=`ticket-venta-${b.consecutivo.replace(/\s/g,`-`)}`;new ce(t,{url:`/imprimir`,title:`Ticket ${b.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),P(b)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{if(!b||Ge())return;let t=Ie(b,e);qe(t,b.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{_([]),y(0),d(``),x(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,H.jsx)(`button`,{type:`button`,onClick:M,className:`btn-guardar-venta`,disabled:i||g.length===0,children:i?`Guardando...`:`Guardar Venta`})})]})]})]})}var Ye=Je,Xe=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,Ze=(e,t)=>`${t}${String(e).padStart(5,`0`)}`,Qe=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function $e(){let{userProfile:e,base:t}=q(),[n,r]=(0,V.useState)(!1),[i,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(``),[c,l]=(0,V.useState)(null),u=async()=>{let n=Number(o),c=i.trim();if(!c||n<=0){alert(`Debe ingresar una descripci√≥n y un monto v√°lido.`);return}if(n>t){alert(`Error: el monto del gasto no puede superar la base en caja.`);return}r(!0);try{let t=D(L(G,`gastos`)),r=null;await N(G,async i=>{let a=D(G,`configuracion`,`consecutivos`),o=await i.get(a);if(!o.exists())throw Error(`Consecutivos no encontrados.`);let s=(o.data().gastos??0)+1,l=Ze(s,`GAS`),u={consecutivo:l,descripcion:c,monto:n,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};r=u;let d=D(L(G,`movimientos_caja`));i.set(t,u),i.update(a,{gastos:s}),i.set(d,{tipo:`egreso`,monto:n,descripcion:`Gasto ${l} - ${c}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`gastos`,id:t.id,consecutivo:l}})}),l(r),a(``),s(``)}catch(e){console.error(`Error al guardar el gasto: `,e),alert(`Error al guardar: ${e.message}`)}r(!1)},d=t=>{let n=Re(t,e);ze({titulo:`Comprobante ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del comprobante en el navegador.`)},f=async()=>{if(c)if(!Xe())d(c),m();else{localStorage.setItem(`ticketData`,JSON.stringify(c)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`gasto`);let t=`ticket-gasto-${c.consecutivo.replace(/\s/g,`-`)}`,n=new ce(t,{url:`/imprimir`,title:`Comprobante ${c.consecutivo}`,width:310,height:600});n.once(`tauri://created`,()=>{p()}),n.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),d(c),m()})}},p=()=>{c&&m()},m=()=>{if(c&&!Xe()){let t=Re(c,e);Qe(t,c.consecutivo)}a(``),s(``),l(null)};return(0,H.jsxs)(`div`,{className:`pagina-gastos`,children:[(0,H.jsx)(`h1`,{children:`Registro de Gasto (Salida de Caja)`}),(0,H.jsxs)(`div`,{children:[`Base actual: `,(0,H.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`layout-gastos`,children:[(0,H.jsxs)(`div`,{className:`formulario-gasto`,children:[(0,H.jsx)(`h2`,{children:`Datos del Gasto`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`descripcion`,children:`Descripci√≥n:`}),(0,H.jsx)(`textarea`,{id:`descripcion`,rows:`4`,value:i,onChange:e=>a(e.target.value),disabled:!!c})]}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`monto`,children:`Monto ($):`}),(0,H.jsx)(`input`,{id:`monto`,type:`number`,value:o,onChange:e=>s(e.target.value),disabled:!!c})]})]}),(0,H.jsxs)(`div`,{className:`vista-previa-gasto`,children:[(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`h2`,{children:`Resumen de Salida`}),(0,H.jsxs)(`div`,{className:`resumen-gasto`,children:[(0,H.jsxs)(`div`,{children:[`Descripci√≥n: `,c?c.descripcion:i]}),(0,H.jsxs)(`div`,{className:`monto`,children:[`- $`,(c?c.monto:Number(o||0)).toLocaleString(`es-CO`)]})]})]}),(0,H.jsx)(`div`,{className:`botones-accion`,children:c?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(`p`,{className:`gasto-exitoso`,children:[`Gasto `,c.consecutivo,` guardado.`]}),(0,H.jsx)(`button`,{type:`button`,onClick:f,className:`btn-imprimir-ticket`,children:`Imprimir Comprobante (SALIDA)`}),(0,H.jsx)(`button`,{type:`button`,onClick:p,className:`btn-nuevo-gasto`,children:`Registrar Nuevo Gasto (y Descargar TXT)`})]}):(0,H.jsx)(`button`,{type:`button`,onClick:u,className:`btn-guardar-gasto`,disabled:n||!i||!o,children:n?`Guardando...`:`Guardar Gasto`})})]})]})]})}var et=$e;r.register(s,t,a,c,n,o);function tt({chartData:e,titulo:t,useLogScale:n=!1}){return(0,H.jsx)(l,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:`top`},title:{display:!0,text:t,font:{size:18}}},scales:{x:{ticks:{autoSkip:!1,maxRotation:45}},y:{type:n?`logarithmic`:`linear`,beginAtZero:!n,min:n?.1:void 0,title:{display:!0,text:n?`Escala logar√≠tmica (kg/und)`:`Cantidad (kg/und)`},ticks:n?{callback:e=>Number(e).toLocaleString(`es-CO`)}:{precision:0}}}},data:e})}var nt=tt,rt=()=>typeof window<`u`&&(!!window.__TAURI__||!!window.__TAURI_INTERNALS__),Z=()=>new Date().toISOString().split(`T`)[0],Q=e=>{let t=e.split(`-`);return new Date(t[0],t[1]-1,t[2])},it=(e,t)=>{let n=new Date().toLocaleString(`es-CO`),r=(e,t)=>{let n=Math.max(0,Math.floor((t-e.length)/2));return` `.repeat(n)+e},i=r(`REPORTE DE INVENTARIO`,45)+`
`;return i+=r(`RECICLADORA NASASHE S.A.S`,45)+`
`,i+=`-`.repeat(45)+`
`,i+=`Fecha: ${n}\n`,i+=`Generado por: ${t?.nombre||`SISTEMA`}\n`,i+=`-`.repeat(45)+`
`,i+=`Material`.padEnd(30)+`Stock (kg/und)`.padStart(15)+`
`,i+=`-`.repeat(45)+`
`,e.forEach(e=>{let t=e.nombre.length>29?e.nombre.substring(0,29):e.nombre,n=(Number(e.stock)||0).toFixed(2);i+=t.padEnd(30)+n.padStart(15)+`
`}),i+=`-`.repeat(45)+`
`,i+=`Total de Art√≠culos: ${e.length}\n`,i+=`-`.repeat(45)+`
`,i};function at(){let{base:e,userProfile:t}=q(),[n,r]=(0,V.useState)(`cierre`),[i,a]=(0,V.useState)(!1),[o,s]=(0,V.useState)(Z),[c,l]=(0,V.useState)(0),[u,d]=(0,V.useState)(0),[f,p]=(0,V.useState)(0),[m,h]=(0,V.useState)(Z),[g,_]=(0,V.useState)(Z),[v,y]=(0,V.useState)([]),[b,C]=(0,V.useState)([]),[w,T]=(0,V.useState)([]),[E,D]=(0,V.useState)([]),[O,k]=(0,V.useState)([]),[j,M]=(0,V.useState)(Z),[N,P]=(0,V.useState)(Z),[ee,I]=(0,V.useState)(``),[te,ne]=(0,V.useState)(Z),[re,ie]=(0,V.useState)(Z),[ae,oe]=(0,V.useState)(`todos`),[se,le]=(0,V.useState)(``),[ue,U]=(0,V.useState)([]),[W,de]=(0,V.useState)({ingresos:0,egresos:0,ajustes:0,saldo:0}),[K,fe]=(0,V.useState)([]),[pe,me]=(0,V.useState)(!1);(0,V.useRef)(null);let[he,ge]=(0,V.useState)(null),[_e,ve]=(0,V.useState)(!1),ye=async()=>{a(!0);let e=Q(o),t=new Date(e.setHours(0,0,0,0)),n=new Date(e.setHours(23,59,59,999)),r=z.fromDate(t),i=z.fromDate(n),s=0,c=0,u=0;try{let e=F(L(G,`compras`),B(`fecha`,`>=`,r),B(`fecha`,`<=`,i));(await R(e)).forEach(e=>s+=e.data().total);let t=F(L(G,`gastos`),B(`fecha`,`>=`,r),B(`fecha`,`<=`,i));(await R(t)).forEach(e=>c+=e.data().monto);let n=F(L(G,`ventasMenores`),B(`fecha`,`>=`,r),B(`fecha`,`<=`,i));(await R(n)).forEach(e=>u+=e.data().total)}catch(e){console.error(`Error al generar el reporte: `,e),await Y(`Error al generar el reporte.`,{title:`Nasashe sas`,type:`error`})}l(s),d(c),p(u),a(!1)},be=c+u,xe=e+be-f,Se=async()=>{a(!0);let e=new Date(Q(m).setHours(0,0,0,0)),t=new Date(Q(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(G,`compras`),B(`fecha`,`>=`,n),B(`fecha`,`<=`,r),A(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),y(i)}catch(e){console.error(`Error al buscar historial: `,e),await Y(`Error al buscar historial.`,{title:`Nasashe sas`,type:`warning`})}a(!1)},Ce=async()=>{a(!0);let e=new Date(Q(m).setHours(0,0,0,0)),t=new Date(Q(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(G,`ventas`),B(`fecha`,`>=`,n),B(`fecha`,`<=`,r),A(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),C(i)}catch(e){console.error(`Error al buscar historial de ventas: `,e),await Y(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},we=async()=>{a(!0);let e=new Date(Q(m).setHours(0,0,0,0)),t=new Date(Q(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(G,`ventasMenores`),B(`fecha`,`>=`,n),B(`fecha`,`<=`,r),A(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),T(i)}catch(e){console.error(`Error al buscar historial de ventas menores: `,e),await Y(`Error al buscar historial.`,{title:`Nasashe sas`,type:`error`})}a(!1)},Te=async()=>{a(!0);let e=new Date(Q(m).setHours(0,0,0,0)),t=new Date(Q(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[];try{let e=F(L(G,`gastos`),B(`fecha`,`>=`,n),B(`fecha`,`<=`,r),A(`fecha`,`desc`));(await R(e)).forEach(e=>{let t=e.data();i.push({id:e.id,...t,fecha:t.fecha.toDate()})}),D(i)}catch(e){console.error(`Error al buscar historial de gastos: `,e),alert(`Error al buscar historial.`)}a(!1)},Ee=async()=>{a(!0);let e=ee.trim().toUpperCase(),t=new Date(Q(j).setHours(0,0,0,0)),n=new Date(Q(N).setHours(23,59,59,999)),r=z.fromDate(t),i=z.fromDate(n);try{let t;if(e){let n=F(L(G,`remisiones`),B(`consecutivo`,`==`,e));t=await R(n)}else{let e=F(L(G,`remisiones`),B(`fecha`,`>=`,r),B(`fecha`,`<=`,i),A(`fecha`,`desc`));t=await R(e)}let n=t.docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}});k(n)}catch(e){console.error(`Error al buscar historial de remisiones: `,e),alert(`Error al buscar remisiones.`)}a(!1)},J=async()=>{a(!0);try{let e=new Date(Q(te).setHours(0,0,0,0)),t=new Date(Q(re).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i=[B(`fecha`,`>=`,n),B(`fecha`,`<=`,r),A(`fecha`,`desc`)];ae!==`todos`&&i.unshift(B(`tipo`,`==`,ae));let a=F(L(G,`movimientos_caja`),...i),o=(await R(a)).docs.map(e=>{let t=e.data();return{id:e.id,...t,fecha:t.fecha?.toDate?t.fecha.toDate():new Date}}),s=se.trim().toUpperCase();s&&(o=o.filter(e=>String(e.usuario||``).toUpperCase().includes(s)));let c=0,l=0,u=0;o.forEach(e=>{if(e.anulado)return;let t=Number(e.monto)||0;e.tipo===`ingreso`&&(c+=Math.abs(t)),e.tipo===`egreso`&&(l+=Math.abs(t)),e.tipo===`ajuste`&&(u+=t)}),U(o),de({ingresos:c,egresos:l,ajustes:u,saldo:c-l+u})}catch(e){console.error(`Error al buscar libro de caja: `,e),await Y(`No se pudo cargar el libro de caja.`,{title:`Nasashe sas`,type:`error`})}a(!1)},De=(e,t)=>{let n=document.createElement(`iframe`);n.style.position=`absolute`,n.style.width=`0`,n.style.height=`0`,n.style.border=`none`,document.body.appendChild(n);let r=n.contentWindow.document;r.open(),r.write(`<!DOCTYPE html><html><head><title>${t}</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${e}</pre></body></html>`),r.close();let i=()=>{n.contentWindow.focus(),n.contentWindow.print(),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3)};window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,0)},Oe=e=>{let n=Fe(e,t);De(n,`Ticket ${e.consecutivo}`)},ke=e=>{let n=Ie(e,t);De(n,`Ticket ${e.consecutivo}`)},Ae=e=>{let n=Le(e,t);De(n,`Ticket ${e.consecutivo}`)},je=e=>{let n=Re(e,t);De(n,`Comprobante ${e.consecutivo}`)},Me=e=>e?e instanceof Date?e.toLocaleString(`es-CO`):new Date(e).toLocaleString(`es-CO`):``,Ne=async e=>{let t=new x({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√ìN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino?.nombre||`N/D`}`,12,r),t.text(`Direcci√≥n: ${e.destino?.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino?.nit||`N/D`}`,12,r),t.text(`Tel√©fono: ${e.destino?.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√≥n: ${Me(e.fecha)}`,12,r),r+=6,t.text(`Conductor: ${e.conductor?.nombre||`N/D`}`,12,r),t.text(`C√©dula: ${e.conductor?.cedula||`N/D`}`,n/2,r),r+=6,t.text(`Direcci√≥n: ${e.conductor?.direccion||`N/D`}`,12,r),r+=6,t.text(`V√≠nculo: ${e.conductor?.vinculo||`N/D`}`,12,r),t.text(`Placa: ${e.conductor?.placa||`N/D`}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor?.celular||`N/D`}`,12,r),r+=6,e.observaciones&&(t.text(`Observaciones: ${e.observaciones}`,12,r),r+=6),S(t,{startY:r+4,head:[[`√çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:(e.items||[]).map((e,t)=>[(t+1).toString(),e.nombre,(e.cantidad??0).toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t},Pe=async e=>{try{let t=(await Ne(e)).output(`bloburl`);window.open(t,`_blank`)}catch(e){console.error(`Error al reimprimir la remisi√≥n:`,e),alert(`No se pudo generar el PDF de la remisi√≥n.`)}},X=async(e,n)=>{if(!n)return;let r=()=>{switch(e){case`compra`:return Oe(n);case`venta`:return ke(n);case`ventaMenor`:return Ae(n);case`gasto`:return je(n);case`inventario`:return Ve(n);default:console.warn(`Tipo de ticket no soportado para impresi√≥n en navegador: ${e}`)}};if(!rt()){r();return}try{localStorage.setItem(`ticketData`,JSON.stringify(n)),localStorage.setItem(`ticketUser`,JSON.stringify(t)),localStorage.setItem(`ticketType`,e)}catch(e){console.error(`Error al preparar datos para impresi√≥n:`,e),r();return}let i=(e=>(e?String(e):`${Date.now()}`).replace(/\s/g,`-`))(n.consecutivo),a=`ticket-${e}-${i}`,o=`Impresi√≥n de ticket`;e===`gasto`?o=`Comprobante ${n.consecutivo||``}`.trim():e===`inventario`?o=`Reporte de Inventario`:n.consecutivo&&(o=`Ticket ${n.consecutivo}`);let s=new ce(a,{url:`/imprimir`,title:o,width:310,height:600,resizable:!0,decorations:!0});s.once(`tauri://created`,()=>{console.log(`Ventana de impresi√≥n creada`)}),s.once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),r()})},ze=async()=>{me(!0);let e=[];try{let t=F(L(G,`articulos`),A(`nombre`,`asc`));(await R(t)).forEach(t=>{e.push({id:t.id,...t.data()})}),fe(e)}catch(e){console.error(`Error al cargar inventario: `,e),await Y(`Error al cargar inventario.`)}me(!1)},Be=async()=>{if(K.length===0){await Y(`No hay datos de inventario para exportar.`,{title:`Nasashe sas`,type:`warning`});return}let e=new x;e.text(`Reporte de Inventario Actual`,14,15),e.setFontSize(10),e.text(`Generado por: ${t?.nombre||`SISTEMA`}`,14,20),e.text(`Fecha: ${new Date().toLocaleDateString(`es-CO`)}`,14,25);let n=[`Nombre`,`Precio Compra ($)`,`Stock Actual (kg/und)`],r=[];K.forEach(e=>{let t=Number(e?.precioCompra??0),n=Number(e?.stock??0),i=[e?.nombre||`Sin nombre`,t.toLocaleString(`es-CO`),n.toLocaleString(`es-CO`)];r.push(i)}),S(e,{head:[n],body:r,startY:30});let i=new Date().toISOString().split(`T`)[0];try{e.save(`Reporte_Inventario_${i}.pdf`),await Y(`Su archivo se export√≥ con √©xito en la carpeta de descargas.`,{title:`Nasashe sas`,type:`info`})}catch(e){console.error(`Error al exportar el inventario a PDF:`,e),await Y(`Ocurri√≥ un error al exportar el PDF. Por favor, int√©ntalo de nuevo.`,{title:`Nasashe sas`,type:`error`})}},Ve=async e=>{let n=Array.isArray(e?.items)&&e.items.length>0?e.items:K;if(!n||n.length===0){await Y(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`warning`});return}let r=`<!DOCTYPE html><html><head><title>Reporte Inventario</title><style>body { font-family: 'Courier New', Courier, monospace; font-size: 10px; width: 80mm; margin: 0; padding: 8px; } @page { margin: 2mm; size: 80mm auto; }</style></head><body><pre>${it(n,t)}</pre></body></html>`,i=document.createElement(`iframe`);i.style.position=`fixed`,i.style.right=`0`,i.style.bottom=`0`,i.style.width=`0`,i.style.height=`0`,i.style.border=`0`,document.body.appendChild(i);let a=()=>{setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};i.onload=()=>{let e=i.contentWindow;e?(e.focus(),e.print(),e.onafterprint=a,setTimeout(a,5e3)):a()},i.srcdoc=r};return(0,H.jsxs)(`div`,{className:`pagina-reportes`,children:[(0,H.jsx)(`h1`,{children:`M√≥dulo de Reportes`}),(0,H.jsxs)(`div`,{className:`tabs-container`,children:[(0,H.jsx)(`button`,{className:`tab-button ${n===`cierre`?`active`:``}`,onClick:()=>r(`cierre`),children:`Cierre de Caja`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`historialCompras`?`active`:``}`,onClick:()=>r(`historialCompras`),children:`Hist. Compras`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`historialVentas`?`active`:``}`,onClick:()=>r(`historialVentas`),children:`Hist. Ventas`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`historialVentasMenores`?`active`:``}`,onClick:()=>r(`historialVentasMenores`),children:`Hist. Ventas Menores`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`historialGastos`?`active`:``}`,onClick:()=>r(`historialGastos`),children:`Hist. Gastos`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`libroCaja`?`active`:``}`,onClick:()=>r(`libroCaja`),children:`Libro de Caja`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`historialRemisiones`?`active`:``}`,onClick:()=>r(`historialRemisiones`),children:`Hist. Remisiones`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`inventario`?`active`:``}`,onClick:()=>r(`inventario`),children:`Inventario`}),(0,H.jsx)(`button`,{className:`tab-button ${n===`analisis`?`active`:``}`,onClick:()=>r(`analisis`),children:`An√°lisis de Materiales`})]}),(0,H.jsxs)(`div`,{className:`tab-content`,children:[n===`cierre`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-cierre`,children:`Seleccione la fecha:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-cierre`,value:o,onChange:e=>s(e.target.value)}),(0,H.jsx)(`button`,{onClick:ye,className:`btn-generar`,disabled:i,children:i?`Calculando...`:`Generar Cierre`})]}),(0,H.jsxs)(`h2`,{children:[`Resumen del D√≠a (`,o,`)`]}),(0,H.jsxs)(`div`,{className:`reporte-grid`,children:[(0,H.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,H.jsx)(`h3`,{children:`(+) Total Ventas Menores`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,f.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,H.jsx)(`h3`,{children:`(-) Total Compras`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,c.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,H.jsx)(`h3`,{children:`(-) Total Gastos`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,u.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,H.jsx)(`h3`,{children:`(=) Efectivo Actual en Caja`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,e.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,H.jsx)(`h3`,{children:`(=) Base Inicial (Calculada)`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,xe.toLocaleString(`es-CO`)]})]})]})]}),n===`historialCompras`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,H.jsx)(`button`,{onClick:Se,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Compras`})]}),(0,H.jsx)(`h2`,{children:`Historial de Compras`}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Consecutivo`}),(0,H.jsx)(`th`,{children:`Reciclador`}),(0,H.jsx)(`th`,{children:`Total`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):v.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron compras.`})}):v.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,H.jsx)(`td`,{children:e.consecutivo}),(0,H.jsx)(`td`,{children:e.reciclador}),(0,H.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{onClick:()=>X(`compra`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentas`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,H.jsx)(`button`,{onClick:Ce,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas`})]}),(0,H.jsx)(`h2`,{children:`Historial de Ventas (a Proveedores)`}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Consecutivo`}),(0,H.jsx)(`th`,{children:`Cliente (Proveedor)`}),(0,H.jsx)(`th`,{children:`Total`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):b.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):b.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,H.jsx)(`td`,{children:e.consecutivo}),(0,H.jsx)(`td`,{children:e.proveedor.nombre}),(0,H.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{onClick:()=>X(`venta`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialVentasMenores`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.g.value)}),(0,H.jsx)(`button`,{onClick:we,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Ventas Menores`})]}),(0,H.jsx)(`h2`,{children:`Historial de Ventas Menores (a Particulares)`}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Consecutivo`}),(0,H.jsx)(`th`,{children:`Cliente`}),(0,H.jsx)(`th`,{children:`Total`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`Buscando...`})}):w.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`5`,style:{textAlign:`center`},children:`No se encontraron ventas.`})}):w.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,H.jsx)(`td`,{children:e.consecutivo}),(0,H.jsx)(`td`,{children:e.cliente}),(0,H.jsxs)(`td`,{children:[`$`,e.total.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{onClick:()=>X(`ventaMenor`,e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`historialGastos`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,H.jsx)(`button`,{onClick:Te,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Gastos`})]}),(0,H.jsx)(`h2`,{children:`Historial de Gastos`}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Consecutivo`}),(0,H.jsx)(`th`,{children:`Concepto`}),(0,H.jsx)(`th`,{children:`Descripci√≥n`}),(0,H.jsx)(`th`,{children:`Monto`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):E.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron gastos.`})}):E.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.fecha.toLocaleString(`es-CO`)}),(0,H.jsx)(`td`,{children:e.consecutivo}),(0,H.jsx)(`td`,{children:e.concepto}),(0,H.jsx)(`td`,{children:e.descripcion}),(0,H.jsxs)(`td`,{children:[`$`,e.monto.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{onClick:()=>X(`gasto`,e,t),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`libroCaja`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`caja-fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`caja-fecha-inicio`,value:te,onChange:e=>ne(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`caja-fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`caja-fecha-fin`,value:re,onChange:e=>ie(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`caja-tipo`,children:`Tipo:`}),(0,H.jsxs)(`select`,{id:`caja-tipo`,value:ae,onChange:e=>oe(e.target.value),children:[(0,H.jsx)(`option`,{value:`todos`,children:`Todos`}),(0,H.jsx)(`option`,{value:`ingreso`,children:`Ingreso`}),(0,H.jsx)(`option`,{value:`egreso`,children:`Egreso`}),(0,H.jsx)(`option`,{value:`ajuste`,children:`Ajuste`})]}),(0,H.jsx)(`label`,{htmlFor:`caja-usuario`,children:`Usuario:`}),(0,H.jsx)(`input`,{id:`caja-usuario`,type:`text`,placeholder:`Filtro por usuario`,value:se,onChange:e=>le(e.target.value)}),(0,H.jsx)(`button`,{onClick:J,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Movimientos`})]}),(0,H.jsx)(`h2`,{children:`Libro de Caja`}),(0,H.jsxs)(`div`,{className:`reporte-grid`,children:[(0,H.jsxs)(`div`,{className:`summary-card card-ingresos`,children:[(0,H.jsx)(`h3`,{children:`(+) Ingresos`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,W.ingresos.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-egresos`,children:[(0,H.jsx)(`h3`,{children:`(-) Egresos`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,W.egresos.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-calculada`,children:[(0,H.jsx)(`h3`,{children:`(+/-) Ajustes`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,W.ajustes.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`summary-card card-base`,children:[(0,H.jsx)(`h3`,{children:`(=) Saldo Calculado`}),(0,H.jsxs)(`div`,{className:`monto`,children:[`$`,W.saldo.toLocaleString(`es-CO`)]})]})]}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Tipo`}),(0,H.jsx)(`th`,{children:`Descripci√≥n`}),(0,H.jsx)(`th`,{children:`Usuario`}),(0,H.jsx)(`th`,{children:`Estado`}),(0,H.jsx)(`th`,{children:`Monto`}),(0,H.jsx)(`th`,{children:`Referencia`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`Buscando...`})}):ue.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`7`,style:{textAlign:`center`},children:`No se encontraron movimientos.`})}):ue.map(e=>{let t=Number(e.monto)||0,n=e.tipo===`egreso`?`-`:`+`,r=e.tipo===`egreso`?`card-egresos`:`card-ingresos`,i=e.referencia?.consecutivo||e.referencia?.id||`N/A`;return(0,H.jsxs)(`tr`,{style:e.anulado?{opacity:.55,textDecoration:`line-through`}:void 0,children:[(0,H.jsx)(`td`,{children:e.fecha?.toLocaleString(`es-CO`)}),(0,H.jsx)(`td`,{children:String(e.tipo||``).toUpperCase()}),(0,H.jsx)(`td`,{children:e.descripcion||`Sin descripci√≥n`}),(0,H.jsx)(`td`,{children:e.usuario||`N/A`}),(0,H.jsx)(`td`,{children:e.anulado?`ANULADO`:`ACTIVO`}),(0,H.jsxs)(`td`,{className:r,children:[n,` $`,Math.abs(t).toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:i})]},e.id)})})]})]}),n===`historialRemisiones`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`remision-fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`remision-fecha-inicio`,value:j,onChange:e=>M(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`remision-fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`remision-fecha-fin`,value:N,onChange:e=>P(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`remision-consecutivo`,children:`Consecutivo (opcional)`}),(0,H.jsx)(`input`,{id:`remision-consecutivo`,type:`text`,placeholder:`REM-000001`,value:ee,onChange:e=>I(e.target.value)}),(0,H.jsx)(`button`,{onClick:Ee,className:`btn-generar`,disabled:i,children:i?`Buscando...`:`Buscar Remisiones`})]}),(0,H.jsx)(`h2`,{children:`Historial de Remisiones`}),(0,H.jsxs)(`table`,{className:`historial-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Fecha`}),(0,H.jsx)(`th`,{children:`Consecutivo`}),(0,H.jsx)(`th`,{children:`Destino`}),(0,H.jsx)(`th`,{children:`Conductor`}),(0,H.jsx)(`th`,{children:`Items`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:i?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`Buscando...`})}):O.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`6`,style:{textAlign:`center`},children:`No se encontraron remisiones.`})}):O.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:Me(e.fecha)}),(0,H.jsx)(`td`,{children:e.consecutivo}),(0,H.jsx)(`td`,{children:e.destino?.nombre||`N/D`}),(0,H.jsx)(`td`,{children:e.conductor?.nombre||`N/D`}),(0,H.jsx)(`td`,{children:Array.isArray(e.items)?e.items.length:0}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{onClick:()=>Pe(e),className:`btn-reimprimir`,children:`Re-imprimir`})})]},e.id))})]})]}),n===`analisis`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`inventario-header`,children:[(0,H.jsx)(`h2`,{children:`Reporte de Inventario Actual`}),(0,H.jsxs)(`div`,{className:`inventario-header-botones`,children:[(0,H.jsx)(`button`,{onClick:ze,className:`btn-generar`,disabled:pe,children:pe?`Cargando...`:`Cargar Inventario`}),(0,H.jsx)(`button`,{onClick:Be,className:`btn-exportar-pdf`,disabled:K.length===0,children:`Exportar a PDF`}),(0,H.jsx)(`button`,{onClick:async()=>{if(K.length===0){await Y(`No hay datos de inventario para imprimir.`,{title:`Nasashe sas`,type:`error`});return}let e={items:K.map(({id:e,nombre:t,stock:n,precioCompra:r})=>({id:e,nombre:t,stock:n,precioCompra:r})),fechaGeneracion:new Date().toISOString()};try{await X(`inventario`,e)}catch(t){console.error(`Error al preparar la impresi√≥n del inventario:`,t),Ve(e)}},className:`btn-imprimir-inventario`,disabled:K.length===0,children:`Imprimir`})]})]}),(0,H.jsxs)(`table`,{className:`inventario-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Nombre`}),(0,H.jsx)(`th`,{children:`Precio Compra`}),(0,H.jsx)(`th`,{children:`Stock Actual (kg/und)`})]})}),(0,H.jsx)(`tbody`,{children:pe?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`Cargando...`})}):K.length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`3`,style:{textAlign:`center`},children:`No se encontr√≥ inventario.`})}):K.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsxs)(`td`,{children:[`$`,e.precioCompra.toLocaleString(`es-CO`)]}),(0,H.jsx)(`td`,{children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})]}),n===`analisis`&&(0,H.jsxs)(`div`,{children:[(0,H.jsxs)(`div`,{className:`reporte-controles`,children:[(0,H.jsx)(`label`,{htmlFor:`fecha-inicio`,children:`Desde:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-inicio`,value:m,onChange:e=>h(e.target.value)}),(0,H.jsx)(`label`,{htmlFor:`fecha-fin`,children:`Hasta:`}),(0,H.jsx)(`input`,{type:`date`,id:`fecha-fin`,value:g,onChange:e=>_(e.target.value)}),(0,H.jsxs)(`label`,{className:`checkbox-inline`,style:{display:`flex`,alignItems:`center`,gap:`8px`},children:[(0,H.jsx)(`input`,{type:`checkbox`,checked:_e,onChange:e=>ve(e.target.checked)}),`Usar escala logar√≠tmica`]}),(0,H.jsx)(`button`,{onClick:async()=>{a(!0),ge(null);let e=new Date(Q(m).setHours(0,0,0,0)),t=new Date(Q(g).setHours(23,59,59,999)),n=z.fromDate(e),r=z.fromDate(t),i={};try{let e=F(L(G,`compras`),B(`fecha`,`>=`,n),B(`fecha`,`<=`,r));(await R(e)).forEach(e=>{e.data().items.forEach(e=>{i[e.nombre]=(i[e.nombre]||0)+e.cantidad})});let t=Object.keys(i),a=Object.values(i);t.length===0?ge({labels:[],datasets:[]}):ge({labels:t,datasets:[{label:`Total Comprado (kg/und)`,data:a,backgroundColor:`rgba(220, 53, 69, 0.6)`,borderColor:`rgba(220, 53, 69, 1)`,borderWidth:1,minBarLength:8}]})}catch(e){console.error(`Error al generar an√°lisis: `,e),await Y(`Error al generar an√°lisis.`,{title:`Error de an√°lisis`,type:`error`})}a(!1)},className:`btn-generar`,disabled:i,children:i?`Generando...`:`Generar An√°lisis`})]}),(0,H.jsx)(`h2`,{children:`An√°lisis de Materiales Comprados (por Cantidad)`}),(0,H.jsx)(`div`,{className:`chart-container`,children:i?(0,H.jsx)(`p`,{children:`Generando gr√°fica...`}):he?he.labels.length>0?(0,H.jsx)(nt,{chartData:he,titulo:`Materiales Comprados (${m} a ${g})`,useLogScale:_e}):(0,H.jsx)(`p`,{children:`No se encontraron datos de compras para este rango de fechas.`}):(0,H.jsx)(`p`,{children:`Seleccione un rango de fechas y haga clic en "Generar An√°lisis" para ver la gr√°fica.`})})]})]})]})}var ot=at,st=e=>String(e||``).trim().toUpperCase(),ct=e=>String(e||``).trim().toLowerCase();async function lt(e){let t=e.trim();if(!t)throw Error(`Usuario no encontrado.`);let n=L(G,`usuarios`),r=st(t),i=await k(F(n,B(`nombre`,`==`,r)));if(!i.empty){let e=i.docs[0].data()?.email;if(e)return e}let a=(await k(n)).docs.map(e=>e.data()).find(e=>[e?.nombre,e?.nombreUsuario,e?.username,e?.usuario].map(st).includes(r))?.email;if(a)return a;if(t.includes(`@`))return ct(t);throw Error(`Usuario no encontrado.`)}function ut(){let[e,t]=(0,V.useState)(``),[n,r]=(0,V.useState)(``),[i,a]=(0,V.useState)(null),[o,s]=(0,V.useState)(!1),c=f();return(0,H.jsx)(`div`,{className:`login-page-container`,children:(0,H.jsxs)(`div`,{className:`login-box`,children:[(0,H.jsx)(`h1`,{children:`Iniciar Sesi√≥n`}),(0,H.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),a(null),s(!0);try{let t=await lt(e);await C(de,t,n),c(`/`)}catch(e){e?.code===`permission-denied`||e?.code===`firestore/permission-denied`?a(`No hay permiso para leer usuarios en Firestore.`):e?.message===`Usuario no encontrado.`?a(`Nombre de usuario incorrecto.`):e?.code===`auth/invalid-credential`||e?.code===`auth/wrong-password`?a(`Contrase√±a incorrecta.`):e?.code===`auth/user-not-found`?a(`Usuario no existe en Authentication.`):a(`Error al iniciar sesi√≥n. Intente de nuevo.`),console.error(e)}finally{s(!1)}},className:`login-form`,children:[(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`nombre-usuario`,children:`Nombre de Usuario:`}),(0,H.jsx)(`input`,{id:`nombre-usuario`,type:`text`,value:e,onChange:e=>t(e.target.value),required:!0})]}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`password`,children:`Contrase√±a:`}),(0,H.jsx)(`input`,{id:`password`,type:`password`,value:n,onChange:e=>r(e.target.value),required:!0})]}),(0,H.jsx)(`button`,{type:`submit`,className:`login-btn`,disabled:o,children:o?`Ingresando...`:`Ingresar`}),i&&(0,H.jsx)(`p`,{className:`login-error`,children:i})]})]})})}var dt=ut,ft=()=>typeof window<`u`&&!!window.__TAURI_INTERNALS__,pt=(e,t)=>`${t}${String(e).padStart(5,`0`)}`,mt=(e,t)=>{let n=document.createElement(`a`),r=new Blob([e],{type:`text/plain;charset=utf-8`});n.href=URL.createObjectURL(r),n.download=`${t}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function ht(){let{userProfile:e,base:t}=q(),[n,r]=(0,V.useState)(!1),[i,a]=(0,V.useState)(``),[o,s]=(0,V.useState)(``),[c,l]=(0,V.useState)(``),[u,d]=(0,V.useState)(``),[f,p]=(0,V.useState)([]),[m,h]=(0,V.useState)(0),[g,_]=(0,V.useState)(null),[v,y]=(0,V.useState)(null),b=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`;(0,V.useEffect)(()=>{let e=f.reduce((e,t)=>e+t.subtotal,0);h(e)},[f]);let x=()=>{let e=Number(c),t=Number(u);if(!o||e<=0||t<=0){alert(`Complete Material, Cantidad y Precio.`);return}let n=e*t;p(r=>[...r,{id:new Date().getTime(),localId:b(),descripcion:o.toUpperCase(),cantidad:e,precio:t,subtotal:n}]),s(``),l(``),d(``)},S=e=>{window.confirm(`¬øDesea eliminar este item de la prefactura?`)&&(p(t=>t.filter(t=>t.localId!==e)),y(t=>t===e?null:t))},C=e=>{y(t=>t===e?null:e)},w=(e,t)=>{let n=Number(e.target.value);n<=0||p(e=>e.map(e=>e.localId===t?{...e,cantidad:n,subtotal:n*e.precio}:e))},T=(e,t)=>{let n=Number(e.target.value);n<=0||p(e=>e.map(e=>e.localId===t?{...e,precio:n,subtotal:n*e.cantidad}:e))},E=async()=>{if(f.length===0){alert(`No hay art√≠culos en la venta.`);return}r(!0);let t=null,n=``;try{let r=D(L(G,`ventasMenores`));await N(G,async a=>{let o=D(G,`configuracion`,`consecutivos`),s=await a.get(o);if(!s.exists())throw Error(`Consecutivos no encontrados`);let c=(s.data().ventasMenores??0)+1;n=pt(c,`FAVMI`);let l=i.trim().toUpperCase(),u={consecutivo:n,cliente:l||`N/A`,items:f,total:m,fecha:z.now(),usuario:e?.nombre||`SISTEMA`};t=u;let d=D(L(G,`movimientos_caja`));a.set(r,u),a.update(o,{ventasMenores:c}),a.set(d,{tipo:`ingreso`,monto:m,descripcion:`Venta menor ${n} - ${l||`N/A`}`,fecha:z.now(),usuario:e?.nombre||`SISTEMA`,anulado:!1,referencia:{coleccion:`ventasMenores`,id:r.id,consecutivo:n}})}),_(t),a(``)}catch(e){console.error(`Error al guardar la venta: `,e),alert(`Error al guardar: ${e.message}`)}r(!1)},O=t=>{let n=Le(t,e);ze({titulo:`Ticket ${t.consecutivo}`,textoTicket:n})||alert(`No se pudo preparar la impresi√≥n del ticket en el navegador. Verifica la configuraci√≥n de impresi√≥n e int√©ntalo nuevamente.`)};return(0,H.jsxs)(`div`,{className:`pagina-ventas-menores`,children:[(0,H.jsx)(`h1`,{children:`Registro de Venta Menor (a Particular)`}),(0,H.jsxs)(`div`,{style:{textAlign:`center`,fontSize:`18px`,marginBottom:`10px`},children:[`Base actual: `,(0,H.jsxs)(`strong`,{children:[`$`,t.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`layout-ventas-menores`,children:[(0,H.jsxs)(`div`,{className:`formulario-venta-menor`,children:[(0,H.jsx)(`h2`,{children:`Datos de la Venta`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`cliente`,children:`Nombre Cliente (Opcional):`}),(0,H.jsx)(`input`,{id:`cliente`,type:`text`,value:i,onChange:e=>a(e.target.value.toUpperCase()),disabled:g})]}),(0,H.jsx)(`hr`,{}),(0,H.jsx)(`h3`,{children:`Material`}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`itemDescripcion`,children:`Descripci√≥n:`}),(0,H.jsx)(`input`,{id:`itemDescripcion`,type:`text`,value:o,onChange:e=>s(e.target.value.toUpperCase()),disabled:g})]}),(0,H.jsxs)(`div`,{className:`form-manual-item`,children:[(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`itemCantidad`,children:`Cantidad:`}),(0,H.jsx)(`input`,{id:`itemCantidad`,type:`number`,value:c,onChange:e=>l(e.target.value),disabled:g})]}),(0,H.jsxs)(`div`,{className:`form-grupo`,children:[(0,H.jsx)(`label`,{htmlFor:`itemPrecio`,children:`Precio x (Und o Kg):`}),(0,H.jsx)(`input`,{id:`itemPrecio`,type:`number`,value:u,onChange:e=>d(e.target.value),disabled:g})]})]}),(0,H.jsx)(`button`,{type:`button`,onClick:x,className:`btn-anadir-item-menor`,disabled:g,children:`+ A√±adir Item`})]}),(0,H.jsxs)(`div`,{className:`pre-factura`,children:[(0,H.jsx)(`h2`,{children:`Items de la Venta`}),(0,H.jsxs)(`table`,{className:`pre-factura-tabla`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Descripci√≥n`}),(0,H.jsx)(`th`,{children:`Cant.`}),(0,H.jsx)(`th`,{children:`Precio`}),(0,H.jsx)(`th`,{children:`Subtotal`}),(0,H.jsx)(`th`,{children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:(g?g.items:f).length===0?(0,H.jsx)(`tr`,{children:(0,H.jsx)(`td`,{colSpan:`4`,style:{textAlign:`center`},children:`A√±ade art√≠culos manuales...`})}):(g?g.items:f).map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.descripcion}),(0,H.jsx)(`td`,{children:v===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.cantidad,onChange:t=>w(t,e.localId),style:{width:`70px`,padding:`3px`},autoFocus:!0}):e.cantidad}),(0,H.jsx)(`td`,{children:v===e.localId?(0,H.jsx)(`input`,{type:`number`,value:e.precio,onChange:t=>T(t,e.localId),style:{width:`80px`,padding:`3px`}}):`$${e.precio}`}),(0,H.jsxs)(`td`,{children:[`$`,e.subtotal.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`td`,{className:`prefactura-acciones`,children:[(0,H.jsx)(`button`,{className:`btn-pre-editar`,onClick:()=>C(e.localId),disabled:g,children:v===e.localId?`Listo`:`Editar`}),(0,H.jsx)(`button`,{className:`btn-pre-borrar`,onClick:()=>S(e.localId),disabled:g,children:`Anular`})]})]},e.localId||e.id))})]}),(0,H.jsxs)(`div`,{className:`total-venta-menor`,children:[`Total: $`,(g?g.total:m).toLocaleString(`es-CO`)]}),(0,H.jsx)(`div`,{className:`botones-accion`,children:g?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(`p`,{className:`venta-exitosa`,children:[`¬°Venta `,g.consecutivo,` guardada!`]}),(0,H.jsx)(`button`,{type:`button`,onClick:async()=>{if(g)if(!ft())O(g);else{localStorage.setItem(`ticketData`,JSON.stringify(g)),localStorage.setItem(`ticketUser`,JSON.stringify(e)),localStorage.setItem(`ticketType`,`ventaMenor`);let t=`ticket-venta-menor-${g.consecutivo.replace(/\s/g,`-`)}`;new ce(t,{url:`/imprimir`,title:`Ticket ${g.consecutivo}`,width:310,height:600}).once(`tauri://error`,e=>{console.error(`Error al crear ventana de impresi√≥n:`,e),O(g)})}},className:`btn-imprimir-ticket`,children:`Imprimir Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{if(!g||ft())return;let t=Le(g,e);mt(t,g.consecutivo)},className:`btn-descargar-ticket`,children:`Descargar Ticket`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{p([]),h(0),a(``),_(null)},className:`btn-nueva-venta`,children:`Registrar Nueva Venta`})]}):(0,H.jsx)(`button`,{type:`button`,onClick:E,className:`btn-guardar-venta-menor`,disabled:n||f.length===0,children:n?`Guardando...`:`Guardar Venta`})})]})]})]})}var gt=ht;function _t(){let[e,t]=(0,V.useState)(!0),[n,r]=(0,V.useState)([]),[i,a]=(0,V.useState)(!1),[o,s]=(0,V.useState)(``),[c,l]=(0,V.useState)(``),[u,d]=(0,V.useState)(``),[f,p]=(0,V.useState)(`empleado`),m=async()=>{t(!0);try{let e=(await R(L(G,`usuarios`))).docs.map(e=>({id:e.id,...e.data()}));r(e)}catch(e){console.error(`Error al traer usuarios: `,e)}t(!1)};(0,V.useEffect)(()=>{m()},[]);let h=async e=>{if(e.preventDefault(),!o||!c||!u){alert(`Complete todos los campos.`);return}a(!0);try{let e=o.trim(),t=c.trim().toLowerCase(),n=(await O(de,t,u)).user.uid;await M(D(G,`usuarios`,n),{nombre:e.toUpperCase(),nombreNormalizado:e.toUpperCase(),email:t,rol:f}),alert(`Usuario ${e.toUpperCase()} creado!`),s(``),l(``),d(``),p(`empleado`),await m()}catch(e){console.error(`Error al crear usuario: `,e),e.code===`auth/email-already-in-use`?alert(`Error: Este correo electr√≥nico ya est√° en uso.`):alert(`Error al crear el usuario. Verifique la consola.`)}a(!1)},g=async(e,t)=>{if(window.confirm(`¬øSeguro que deseas eliminar a ${t}? Esta acci√≥n no se puede deshacer.`))try{await P(D(G,`usuarios`,e)),alert(`Usuario ${t} eliminado.`),await m()}catch(e){console.error(`Error al eliminar usuario: `,e)}};return(0,H.jsxs)(`div`,{className:`pagina-usuarios`,children:[(0,H.jsx)(`h1`,{children:`Gesti√≥n de Usuarios`}),(0,H.jsx)(`p`,{children:`Aqu√≠ puedes crear y administrar las cuentas de los empleados.`}),(0,H.jsxs)(`div`,{className:`form-container`,children:[(0,H.jsx)(`h2`,{children:`A√±adir Nuevo Usuario`}),(0,H.jsxs)(`form`,{onSubmit:h,children:[(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{children:`Nombre (para Login):`}),(0,H.jsx)(`input`,{type:`text`,value:o,onChange:e=>s(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{children:`Email (real):`}),(0,H.jsx)(`input`,{type:`email`,value:c,onChange:e=>l(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{children:`Contrase√±a:`}),(0,H.jsx)(`input`,{type:`password`,value:u,onChange:e=>d(e.target.value)})]}),(0,H.jsxs)(`div`,{children:[(0,H.jsx)(`label`,{children:`Rol:`}),(0,H.jsxs)(`select`,{value:f,onChange:e=>p(e.target.value),children:[(0,H.jsx)(`option`,{value:`empleado`,children:`Empleado`}),(0,H.jsx)(`option`,{value:`admin`,children:`Administrador`})]})]}),(0,H.jsx)(`button`,{type:`submit`,disabled:i,children:i?`Creando...`:`Crear Usuario`})]})]}),(0,H.jsx)(`h2`,{children:`Lista de Usuarios`}),e?(0,H.jsx)(`p`,{children:`Cargando...`}):(0,H.jsxs)(`table`,{className:`usuarios-table`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`Nombre`}),(0,H.jsx)(`th`,{children:`Email`}),(0,H.jsx)(`th`,{children:`Rol`}),(0,H.jsx)(`th`,{className:`acciones-cell`,children:`Acciones`})]})}),(0,H.jsx)(`tbody`,{children:n.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{children:e.email}),(0,H.jsx)(`td`,{children:e.rol}),(0,H.jsx)(`td`,{className:`acciones-cell`,children:e.rol!==`admin`&&(0,H.jsx)(`button`,{onClick:()=>g(e.id,e.nombre),className:`btn-borrar`,children:`Borrar`})})]},e.id))})]})]})}var vt=_t,yt=e=>`REM-${String(e).padStart(6,`0`)}`,bt=e=>{let t=Number(e);return Number.isNaN(t)?0:t},xt=()=>typeof crypto<`u`&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,St=async e=>{let t=await(await fetch(e)).blob();return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})};function Ct(){let{userProfile:e,consecutivosData:t}=q(),n=e?.rol===`admin`,[r,i]=(0,V.useState)([]),[a,o]=(0,V.useState)([]),[s,c]=(0,V.useState)(``),[l,u]=(0,V.useState)({nombre:``,nit:``,direccion:``,telefono:``}),[d,f]=(0,V.useState)({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),[p,m]=(0,V.useState)({articuloId:``,cantidad:``,modoCantidad:`manual`}),[h,g]=(0,V.useState)([]),[_,v]=(0,V.useState)(``),[y,b]=(0,V.useState)(!1),[C,w]=(0,V.useState)(null),[T,E]=(0,V.useState)(``),O=(0,V.useMemo)(()=>(t?.remisiones??0)+1,[t]);(0,V.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([R(L(G,`proveedores`)),R(L(G,`articulos`))]),n=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre)),r=t.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.nombre.localeCompare(t.nombre));i(n),o(r)}catch(e){console.error(`Error al cargar datos para la remisi√≥n:`,e)}})()},[]);let k=e=>{let t=e.target.value;c(t);let n=r.find(e=>e.id===t);n&&u({nombre:n.nombre||``,nit:n.nit||``,direccion:n.direccion||``,telefono:n.telefono||``})},A=e=>{let{name:t,value:n}=e.target;f(e=>({...e,[t]:t===`vinculo`?n:n.toUpperCase()}))},j=e=>{let t=e.target.value,n=a.find(e=>e.id===t);m(e=>({...e,articuloId:t,cantidad:n&&e.modoCantidad===`stock`?n.stock||0:``}))},M=e=>{let t=a.find(e=>e.id===p.articuloId);m(n=>({...n,modoCantidad:e,cantidad:e===`stock`&&t?t.stock||0:``}))},P=()=>{if(!p.articuloId){alert(`Selecciona un material antes de agregarlo.`);return}let e=a.find(e=>e.id===p.articuloId);if(!e){alert(`No se pudo identificar el material.`);return}let t=p.modoCantidad===`stock`?e.stock||0:bt(p.cantidad);if(t<=0){alert(`Ingresa una cantidad v√°lida.`);return}if(t>(e.stock||0)){alert(`La cantidad supera el stock disponible (${e.stock||0}).`);return}g(n=>[...n,{localId:xt(),articuloId:e.id,nombre:e.nombre,cantidad:t,modoCantidad:p.modoCantidad}]),m({articuloId:``,cantidad:``,modoCantidad:`manual`})},ee=e=>{g(t=>t.filter(t=>t.localId!==e))},F=()=>n?s?h.length===0?(alert(`Agrega al menos un material a la remisi√≥n.`),!1):!d.nombre||!d.cedula||!d.placa?(alert(`Completa los datos del conductor (nombre, c√©dula y placa son obligatorios).`),!1):!0:(alert(`Selecciona un destino (proveedor).`),!1):(alert(`Solo los administradores pueden crear remisiones.`),!1),I=async e=>{let t=new x({unit:`mm`,format:`letter`}),n=t.internal.pageSize.getWidth(),r=12;try{let e=await St(`/logo%20con%20fondo.png`);t.addImage(e,`PNG`,12,r,40,20)}catch(e){console.warn(`No se pudo cargar el logo para el PDF:`,e)}t.setFontSize(16),t.text(`NASASHE S.A.S.`,n/2,r+6,{align:`center`}),t.setFontSize(10),t.text(`901.907.763-3`,n/2,r+12,{align:`center`}),t.text(`Calle 98 9B 35`,n/2,r+18,{align:`center`}),t.text(`Tel: 3227377140`,n/2,r+24,{align:`center`}),t.setFontSize(14),t.text(`REMISI√ìN`,n-12,r+10,{align:`right`}),t.setFontSize(12),t.text(e.consecutivo,n-12,r+18,{align:`right`}),r+=30,t.setFontSize(11),t.text(`Destino: ${e.destino.nombre}`,12,r),t.text(`Direcci√≥n: ${e.destino.direccion||`N/D`}`,n/2,r),r+=6,t.text(`NIT: ${e.destino.nit||`N/D`}`,12,r),t.text(`Tel√©fono: ${e.destino.telefono||`N/D`}`,n/2,r),r+=10,t.text(`Fecha emisi√≥n: ${new Date(e.fecha.toDate()).toLocaleString()}`,12,r),r+=6,t.text(`Conductor: ${e.conductor.nombre}`,12,r),t.text(`C√©dula: ${e.conductor.cedula}`,n/2,r),r+=6,t.text(`Direcci√≥n: ${e.conductor.direccion||`N/D`}`,12,r),r+=6,t.text(`V√≠nculo: ${e.conductor.vinculo}`,12,r),t.text(`Placa: ${e.conductor.placa}`,n/2,r),r+=6,t.text(`Celular: ${e.conductor.celular||`N/D`}`,12,r),r+=6,_&&(t.text(`Observaciones: ${_}`,12,r),r+=6),S(t,{startY:r+4,head:[[`√çtem`,`Detalle del material`,`Cantidad (Kg)`]],body:e.items.map((e,t)=>[(t+1).toString(),e.nombre,e.cantidad.toLocaleString(`es-CO`)]),styles:{fontSize:10,cellPadding:2},theme:`grid`,headStyles:{fillColor:[26,71,77]},tableWidth:`auto`,columnStyles:{0:{cellWidth:20},1:{cellWidth:120},2:{cellWidth:30,halign:`right`}},margin:{left:12,right:12}});let i=t.lastAutoTable.finalY+10;t.line(12,i,n-12,i),t.text(`Firma y sello quien diligencia`,22,i+8),t.text(`Firma Conductor`,n/2-10,i+8),t.text(`Firma cliente y/or Recibidor`,n-12-50,i+8);let a=t.getNumberOfPages();for(let e=1;e<=a;e+=1){t.setPage(e);let r=t.internal.pageSize.getHeight();t.text(`P√°gina ${e} de ${a}`,n-12,r-8,{align:`right`})}return t};return n?(0,H.jsxs)(`div`,{className:`remisiones-container`,children:[(0,H.jsxs)(`div`,{className:`remisiones-encabezado`,children:[(0,H.jsxs)(`div`,{className:`remisiones-encabezado-textos`,children:[(0,H.jsx)(`h1`,{children:`Remisiones`}),(0,H.jsx)(`p`,{children:`Genera y guarda remisiones con consecutivo y descarga el PDF listo para impresi√≥n.`}),(0,H.jsxs)(`p`,{className:`remisiones-consecutivo`,children:[`Pr√≥ximo consecutivo: `,(0,H.jsx)(`strong`,{children:yt(O)})]})]}),(0,H.jsx)(`img`,{src:`/logo con fondo.png`,alt:`Logo Nasashe`,className:`remisiones-logo`})]}),(0,H.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,H.jsx)(`h2`,{children:`Destino`}),(0,H.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,H.jsxs)(`label`,{children:[`Destino (proveedor)`,(0,H.jsxs)(`select`,{value:s,onChange:k,children:[(0,H.jsx)(`option`,{value:``,children:`Seleccione...`}),r.map(e=>(0,H.jsx)(`option`,{value:e.id,children:e.nombre},e.id))]})]}),(0,H.jsxs)(`label`,{children:[`NIT / CC`,(0,H.jsx)(`input`,{type:`text`,value:l.nit,readOnly:!0})]}),(0,H.jsxs)(`label`,{children:[`Direcci√≥n`,(0,H.jsx)(`input`,{type:`text`,value:l.direccion,readOnly:!0})]}),(0,H.jsxs)(`label`,{children:[`Tel√©fono`,(0,H.jsx)(`input`,{type:`text`,value:l.telefono,readOnly:!0})]})]})]}),(0,H.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,H.jsx)(`h2`,{children:`Datos del conductor`}),(0,H.jsxs)(`div`,{className:`remisiones-grid`,children:[(0,H.jsxs)(`label`,{children:[`Nombre`,(0,H.jsx)(`input`,{name:`nombre`,value:d.nombre,onChange:A})]}),(0,H.jsxs)(`label`,{children:[`C√©dula`,(0,H.jsx)(`input`,{name:`cedula`,value:d.cedula,onChange:A})]}),(0,H.jsxs)(`label`,{children:[`Direcci√≥n de residencia`,(0,H.jsx)(`input`,{name:`direccion`,value:d.direccion,onChange:A})]}),(0,H.jsxs)(`label`,{children:[`Placa veh√≠culo`,(0,H.jsx)(`input`,{name:`placa`,value:d.placa,onChange:A})]}),(0,H.jsxs)(`label`,{children:[`Celular`,(0,H.jsx)(`input`,{name:`celular`,value:d.celular,onChange:A})]}),(0,H.jsxs)(`div`,{className:`remisiones-vinculo`,children:[(0,H.jsx)(`span`,{children:`V√≠nculo con la raz√≥n social`}),(0,H.jsxs)(`label`,{className:`remisiones-check`,children:[(0,H.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`CONTRATISTA DE FLETE`,checked:d.vinculo===`CONTRATISTA DE FLETE`,onChange:A}),`Contr. Flete`]}),(0,H.jsxs)(`label`,{className:`remisiones-check`,children:[(0,H.jsx)(`input`,{type:`radio`,name:`vinculo`,value:`EMPLEADO`,checked:d.vinculo===`EMPLEADO`,onChange:A}),`Empleado`]})]})]})]}),(0,H.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,H.jsx)(`h2`,{children:`Materiales`}),(0,H.jsxs)(`div`,{className:`remisiones-articulos`,children:[(0,H.jsxs)(`label`,{children:[`Material`,(0,H.jsxs)(`select`,{value:p.articuloId,onChange:j,children:[(0,H.jsx)(`option`,{value:``,children:`Seleccione...`}),a.map(e=>(0,H.jsxs)(`option`,{value:e.id,children:[e.nombre,` (stock: `,e.stock||0,` Kg)`]},e.id))]})]}),(0,H.jsxs)(`div`,{className:`remisiones-cantidad-opciones`,children:[(0,H.jsx)(`span`,{children:`Cantidad`}),(0,H.jsxs)(`div`,{className:`remisiones-radios`,children:[(0,H.jsxs)(`label`,{children:[(0,H.jsx)(`input`,{type:`radio`,checked:p.modoCantidad===`stock`,onChange:()=>M(`stock`)}),`Usar stock disponible`]}),(0,H.jsxs)(`label`,{children:[(0,H.jsx)(`input`,{type:`radio`,checked:p.modoCantidad===`manual`,onChange:()=>M(`manual`)}),`Ingresar manualmente`]})]}),p.modoCantidad===`manual`&&(0,H.jsx)(`input`,{type:`number`,min:`0`,value:p.cantidad,onChange:e=>m(t=>({...t,cantidad:e.target.value})),placeholder:`Cantidad en Kg`})]}),(0,H.jsx)(`button`,{type:`button`,className:`remisiones-add`,onClick:P,children:`A√±adir material`})]}),h.length>0&&(0,H.jsxs)(`table`,{className:`remisiones-tabla`,children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{children:`#`}),(0,H.jsx)(`th`,{children:`Material`}),(0,H.jsx)(`th`,{children:`Cantidad (Kg)`}),(0,H.jsx)(`th`,{})]})}),(0,H.jsx)(`tbody`,{children:h.map((e,t)=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:t+1}),(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{children:e.cantidad}),(0,H.jsx)(`td`,{children:(0,H.jsx)(`button`,{type:`button`,className:`remisiones-delete`,onClick:()=>ee(e.localId),children:`Quitar`})})]},e.localId))})]})]}),(0,H.jsxs)(`section`,{className:`remisiones-panel`,children:[(0,H.jsx)(`h2`,{children:`Observaciones`}),(0,H.jsx)(`textarea`,{value:_,onChange:e=>v(e.target.value.toUpperCase()),placeholder:`Datos adicionales, sellos, etc.`,rows:3})]}),(0,H.jsxs)(`div`,{className:`remisiones-acciones`,children:[(0,H.jsx)(`button`,{type:`button`,onClick:async()=>{if(!F())return;b(!0);let t=r.find(e=>e.id===s);try{let n=D(L(G,`remisiones`)),r=null;await N(G,async i=>{let a=D(G,`configuracion`,`consecutivos`),o=await i.get(a);if(!o.exists())throw Error(`No se encontr√≥ la configuraci√≥n de consecutivos.`);let s=h.map(e=>D(G,`articulos`,e.articuloId)),c=await Promise.all(s.map(e=>i.get(e))),l=(o.data().remisiones??0)+1,u=yt(l),f=h.map((e,t)=>{let n=c[t];if(!n.exists())throw Error(`No se encontr√≥ el art√≠culo ${e.nombre} en inventario.`);let r=n.data().stock||0;if(e.cantidad>r)throw Error(`El material ${e.nombre} no tiene stock suficiente.`);let a=r-e.cantidad;return i.update(s[t],{stock:a}),e}),p={consecutivo:u,destino:{id:t.id,nombre:t.nombre,nit:t.nit||``,direccion:t.direccion||``,telefono:t.telefono||``},conductor:d,items:f,observaciones:_,fecha:z.now(),creadoPor:e?.nombre||`SISTEMA`};r=p,i.set(n,p),i.update(a,{remisiones:l})});let i=await I(r);w(i),E(r.consecutivo),g([]),v(``),c(``),u({nombre:``,nit:``,direccion:``,telefono:``}),f({nombre:``,cedula:``,direccion:``,vinculo:`CONTRATISTA DE FLETE`,placa:``,celular:``}),m({articuloId:``,cantidad:``,modoCantidad:`manual`});let a=i.output(`bloburl`);window.open(a,`_blank`)}catch(e){console.error(`Error al guardar la remisi√≥n:`,e),alert(e.message||`No se pudo guardar la remisi√≥n.`)}b(!1)},disabled:y,children:y?`Guardando...`:`Guardar y generar PDF`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{if(C){let e=C.output(`bloburl`),t=document.createElement(`iframe`);t.style.display=`none`,t.src=e,document.body.appendChild(t),t.onload=()=>{t.contentWindow?.print()}}},disabled:!C,children:`Imprimir √∫ltima remisi√≥n`}),(0,H.jsx)(`button`,{type:`button`,onClick:()=>{C&&T&&C.save(`${T}.pdf`)},disabled:!C,children:`Descargar PDF`})]})]}):(0,H.jsxs)(`div`,{className:`remisiones-container`,children:[(0,H.jsx)(`h1`,{children:`Remisiones`}),(0,H.jsx)(`p`,{className:`remisiones-alerta`,children:`Solo los administradores pueden gestionar las remisiones.`})]})}var wt=Ct,Tt=e(y()),Et=e=>{if(!e)return new Date;if(e instanceof Date)return e;if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?new Date:t}return typeof e==`object`&&typeof e.toDate==`function`?e.toDate():new Date};function Dt({compraData:e,usuario:t}){if(!e)return null;let n=Et(e.fecha).toLocaleString(`es-CO`);return e.consecutivo,(0,H.jsxs)(`div`,{className:`ticket-container`,children:[(0,H.jsxs)(`div`,{className:`ticket-header`,children:[(0,H.jsx)(`h3`,{children:`TICKET DE COMPRA`}),(0,H.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,H.jsx)(`p`,{children:`901907763-3`}),(0,H.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,H.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,H.jsx)(`p`,{children:`605-000-0000`})]}),(0,H.jsxs)(`div`,{className:`ticket-info`,children:[(0,H.jsxs)(`p`,{children:[`Factura: `,e.consecutivo]}),(0,H.jsx)(`p`,{children:`Actividad: Compra`}),(0,H.jsxs)(`p`,{children:[`Fecha: `,n]}),(0,H.jsxs)(`p`,{children:[`Facturado por: `,t?.nombre||`USUARIO`]})]}),(0,H.jsx)(`div`,{className:`ticket-barcode`,children:(0,H.jsx)(Tt.default,{value:e.consecutivo.replace(/\D/g,``),format:`CODE128`,displayValue:!1,margin:0})}),(0,H.jsx)(`div`,{className:`ticket-items`,children:(0,H.jsxs)(`table`,{children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,H.jsx)(`th`,{className:`col-cant`,children:`Cant`}),(0,H.jsx)(`th`,{className:`col-prec`,children:`Prec`}),(0,H.jsx)(`th`,{className:`col-tot`,children:`Total`})]})}),(0,H.jsx)(`tbody`,{children:e.items.map((e,t)=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{children:e.nombre}),(0,H.jsx)(`td`,{className:`col-cant`,children:(Number(e.cantidad)||0).toFixed(2)}),(0,H.jsxs)(`td`,{className:`col-prec`,children:[`$`,e.precioCompra]}),(0,H.jsxs)(`td`,{className:`col-tot`,children:[`$`,e.subtotal.toLocaleString(`es-CO`)]})]},t))})]})}),(0,H.jsxs)(`div`,{className:`ticket-totales`,children:[(0,H.jsxs)(`div`,{className:`total-row`,children:[(0,H.jsx)(`span`,{children:`Subtotal:`}),(0,H.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]}),(0,H.jsxs)(`div`,{className:`total-row`,children:[(0,H.jsx)(`span`,{children:`IVA (0%):`}),(0,H.jsx)(`span`,{children:`$0`})]}),(0,H.jsxs)(`div`,{className:`total-row final`,children:[(0,H.jsx)(`span`,{children:`Total:`}),(0,H.jsxs)(`span`,{children:[`$`,e.total.toLocaleString(`es-CO`)]})]})]}),(0,H.jsxs)(`div`,{className:`ticket-footer`,children:[(0,H.jsx)(`p`,{children:`NO SE ACEPTAN RECLAMOS O DEVOLUCIONES UNA VEZ RETIRADO O RECIBIDO SU MATERIAL.`}),(0,H.jsx)(`p`,{children:`¬° Gracias por su venta !`})]})]})}var Ot=Dt;function kt({inventarioData:e,usuario:t}){if(!e||!Array.isArray(e.items)||e.items.length===0)return(0,H.jsx)(`div`,{className:`ticket-container`,children:(0,H.jsxs)(`div`,{className:`ticket-header`,children:[(0,H.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,H.jsx)(`p`,{children:`No hay art√≠culos para mostrar.`})]})});let n=e.fechaGeneracion?new Date(e.fechaGeneracion):new Date,r=e.items.length;return(0,H.jsxs)(`div`,{className:`ticket-container`,children:[(0,H.jsxs)(`div`,{className:`ticket-header`,children:[(0,H.jsx)(`h3`,{children:`REPORTE DE INVENTARIO`}),(0,H.jsx)(`p`,{children:`RECICLADORA NASASHE S.A.S`}),(0,H.jsx)(`p`,{children:`901907763-3`}),(0,H.jsx)(`p`,{children:`Calle 98#9B-35`}),(0,H.jsx)(`p`,{children:`Barranquilla - Atlantico`}),(0,H.jsx)(`p`,{children:`605-000-0000`})]}),(0,H.jsxs)(`div`,{className:`ticket-info`,children:[(0,H.jsxs)(`p`,{children:[`Fecha: `,n.toLocaleString(`es-CO`)]}),(0,H.jsxs)(`p`,{children:[`Generado por: `,t?.nombre||`USUARIO`]})]}),(0,H.jsx)(`div`,{className:`ticket-items`,children:(0,H.jsxs)(`table`,{children:[(0,H.jsx)(`thead`,{children:(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`th`,{className:`col-mat`,children:`Material`}),(0,H.jsx)(`th`,{className:`col-tot`,children:`Stock (kg/und)`})]})}),(0,H.jsx)(`tbody`,{children:e.items.map(e=>(0,H.jsxs)(`tr`,{children:[(0,H.jsx)(`td`,{className:`col-mat`,children:e.nombre}),(0,H.jsx)(`td`,{className:`col-tot`,children:(Number(e.stock)||0).toFixed(2)})]},e.id))})]})}),(0,H.jsx)(`div`,{className:`ticket-totales`,children:(0,H.jsxs)(`div`,{className:`total-row final`,children:[(0,H.jsx)(`span`,{children:`Total de art√≠culos:`}),(0,H.jsx)(`span`,{children:r})]})}),(0,H.jsx)(`div`,{className:`ticket-footer`,children:(0,H.jsx)(`p`,{children:`Inventario generado autom√°ticamente.`})})]})}var At=kt,jt=(e,t)=>typeof t==`object`&&t&&`seconds`in t&&`nanoseconds`in t?new Date(t.seconds*1e3+t.nanoseconds/1e6):e===`fecha`&&typeof t==`string`&&t.includes(`T`)&&t.endsWith(`Z`)?new Date(t):t;function Mt(){let[e,t]=(0,V.useState)(null);if((0,V.useEffect)(()=>{try{let e=localStorage.getItem(`ticketData`),n=localStorage.getItem(`ticketUser`),r=localStorage.getItem(`ticketType`);if(e&&n&&r){let i=JSON.parse(e,jt),a=JSON.parse(n);t({data:i,user:a,type:r}),localStorage.removeItem(`ticketData`),localStorage.removeItem(`ticketUser`),localStorage.removeItem(`ticketType`)}else console.error(`No se encontraron datos de impresi√≥n en localStorage.`)}catch(e){console.error(`Error al leer datos de impresi√≥n:`,e)}},[]),(0,V.useEffect)(()=>{if(e){let e=setTimeout(()=>{let e=()=>{try{window.__TAURI__?se().close():window.close()}catch(e){console.warn(`No se pudo cerrar la ventana de impresi√≥n autom√°ticamente:`,e)}};window.onafterprint=e,window.print(),window.onfocus=()=>setTimeout(e,500)},100);return()=>clearTimeout(e)}},[e]),!e)return(0,H.jsx)(`div`,{style:{fontFamily:`monospace`,padding:`10px`},children:`Cargando ticket...`});switch(e.type){case`compra`:return(0,H.jsx)(Ot,{compraData:e.data,usuario:e.user});case`inventario`:return(0,H.jsx)(At,{inventarioData:e.data,usuario:e.user});default:return(0,H.jsx)(`div`,{children:`Error: Tipo de ticket no reconocido.`})}}var Nt=Mt,Pt=D(G,`configuracion`,`consecutivos`),$=e=>{let t=Number(e);return Number.isNaN(t)||t<0?0:t};function Ft(){let{userProfile:e}=q(),t=e?.rol===`admin`,[n,r]=(0,V.useState)({compras:``,ventas:``,gastos:``,ventasMenores:``,remisiones:``}),[i,a]=(0,V.useState)(!0),[o,s]=(0,V.useState)(!1),[c,l]=(0,V.useState)(``);(0,V.useEffect)(()=>{(async()=>{a(!0);try{let e=await te(Pt);if(e.exists()){let t=e.data();r({compras:(t.compras??0).toString(),ventas:(t.ventas??0).toString(),gastos:(t.gastos??0).toString(),ventasMenores:(t.ventasMenores??0).toString(),remisiones:(t.remisiones??0).toString()})}else l(`No se encontr√≥ el documento de consecutivos en la base de datos.`)}catch(e){console.error(`Error al cargar consecutivos:`,e),l(`No se pudieron cargar los consecutivos. Intenta nuevamente.`)}a(!1)})()},[]);let u=e=>{let{name:t,value:n}=e.target;/^\d*$/.test(n)&&r(e=>({...e,[t]:n}))},d=async e=>{if(e.preventDefault(),!t){alert(`Solo un administrador puede modificar los consecutivos.`);return}let i={compras:$(n.compras),ventas:$(n.ventas),gastos:$(n.gastos),ventasMenores:$(n.ventasMenores),remisiones:$(n.remisiones)};s(!0),l(``);try{await E(Pt,i),r({compras:i.compras.toString(),ventas:i.ventas.toString(),gastos:i.gastos.toString(),ventasMenores:i.ventasMenores.toString(),remisiones:i.remisiones.toString()}),l(`¬°Consecutivos actualizados! El sistema usar√° el n√∫mero siguiente en cada m√≥dulo.`)}catch(e){console.error(`Error al actualizar consecutivos:`,e),l(`No se pudieron actualizar los consecutivos. Int√©ntalo de nuevo.`)}s(!1)},f=(e,t,r)=>{let i=$(n[e]);return(0,H.jsxs)(`div`,{className:`configuracion-campo`,children:[(0,H.jsx)(`label`,{htmlFor:e,children:t}),(0,H.jsxs)(`div`,{className:`configuracion-input-row`,children:[(0,H.jsx)(`div`,{className:`configuracion-prefijo`,children:r}),(0,H.jsx)(`input`,{id:e,name:e,type:`text`,inputMode:`numeric`,pattern:`[0-9]*`,value:n[e],onChange:u,placeholder:`√öltimo consecutivo usado`})]}),(0,H.jsxs)(`p`,{className:`configuracion-hint`,children:[`Pr√≥ximo n√∫mero que generar√° el sistema: `,(0,H.jsx)(`strong`,{children:`${r}-${(i+1).toString().padStart(6,`0`)}`})]})]},e)};return e?t?(0,H.jsxs)(`div`,{className:`configuracion-container`,children:[(0,H.jsx)(`h1`,{children:`Configuraci√≥n de consecutivos`}),(0,H.jsx)(`p`,{className:`configuracion-descripcion`,children:`Define el √∫ltimo n√∫mero emitido para cada m√≥dulo. El sistema usar√° autom√°ticamente el siguiente n√∫mero al guardar una nueva compra, venta o gasto.`}),i?(0,H.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos...`}):(0,H.jsxs)(`form`,{className:`configuracion-form`,onSubmit:d,children:[(0,H.jsxs)(`div`,{className:`configuracion-grid`,children:[f(`ventas`,`Factura de venta a proveedor`,`FAV`),f(`ventasMenores`,`Factura de venta menor`,`FAVMI`),f(`compras`,`Factura de compra`,`FAC`),f(`gastos`,`Comprobante de gasto`,`GAS`),f(`remisiones`,`Remisiones`,`REM`)]}),(0,H.jsx)(`button`,{type:`submit`,className:`configuracion-boton`,disabled:o,children:o?`Guardando...`:`Restablecer consecutivos`}),c&&(0,H.jsx)(`p`,{className:`configuracion-estado`,children:c})]})]}):(0,H.jsxs)(`div`,{className:`configuracion-container`,children:[(0,H.jsx)(`h1`,{children:`Configuraci√≥n de consecutivos`}),(0,H.jsx)(`p`,{className:`configuracion-alerta`,children:`Solo los administradores pueden restablecer los consecutivos de facturaci√≥n.`})]}):(0,H.jsxs)(`div`,{className:`configuracion-container`,children:[(0,H.jsx)(`h1`,{children:`Configuraci√≥n de consecutivos`}),(0,H.jsx)(`p`,{className:`configuracion-estado`,children:`Cargando datos de usuario...`})]})}var It=Ft;function Lt(){return(0,H.jsxs)(v,{children:[(0,H.jsxs)(g,{element:(0,H.jsx)(d,{}),children:[(0,H.jsx)(g,{path:`/login`,element:(0,H.jsx)(dt,{})}),(0,H.jsx)(g,{path:`/imprimir`,element:(0,H.jsx)(Nt,{})})]}),(0,H.jsxs)(g,{element:(0,H.jsx)(Te,{}),children:[(0,H.jsx)(g,{path:`/`,element:(0,H.jsx)(Oe,{})}),(0,H.jsx)(g,{path:`/articulos`,element:(0,H.jsx)(Ne,{})}),(0,H.jsx)(g,{path:`/proveedores`,element:(0,H.jsx)(X,{})}),(0,H.jsx)(g,{path:`/compras`,element:(0,H.jsx)(We,{})}),(0,H.jsx)(g,{path:`/ventas`,element:(0,H.jsx)(Ye,{})}),(0,H.jsx)(g,{path:`/gastos`,element:(0,H.jsx)(et,{})}),(0,H.jsx)(g,{path:`/reportes`,element:(0,H.jsx)(ot,{})}),(0,H.jsx)(g,{path:`/ventas-menores`,element:(0,H.jsx)(gt,{})}),(0,H.jsx)(g,{path:`/usuarios`,element:(0,H.jsx)(vt,{})}),(0,H.jsx)(g,{path:`/remisiones`,element:(0,H.jsx)(wt,{})}),(0,H.jsx)(g,{path:`/configuracion`,element:(0,H.jsx)(It,{})})]})]})}var Rt=Lt,zt=`/NASASHE-SAS/`.replace(/\/$/,``);le.createRoot(document.getElementById(`root`)).render((0,H.jsx)(V.StrictMode,{children:(0,H.jsx)(_e,{children:(0,H.jsx)(h,{basename:zt,children:(0,H.jsx)(Rt,{})})})}));